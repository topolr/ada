{"version":3,"sources":["/modules/lazyimage/index.js"],"names":["Lazyimage","className","template","style","dataset","service","LazyimageService","View","oncreated","context","isBrowser","eventDispatcher","observe","setTimeout","scroll","onready","finder","getElement","innerHTML","getCurrentState","url","height","document","documentElement","clientHeight","top","getBoundingClientRect","loadImage","state","loaded","image","createElement","addEventListener","target","appendChild","unobserve","commit","setAttribute","onrecover"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;;;;;IAUMA,S,WARL,iBAAK;AACFC,EAAAA,SAAS,EAAE,WADT;AAEFC,EAAAA,QAAQ,EAAE,iBAFR;AAGFC,EAAAA,KAAK,EAAE,cAHL;AAIFC,EAAAA,OAAO,EAAE;AACLC,IAAAA,OAAO,EAAEC;AADJ;AAJP,CAAL,C,UAsBI,sBAAU,QAAV,C,2BAtBL,MAQMN,SARN,SAQwBO,WARxB,CAQ6B;AACzBC,EAAAA,SAAS,GAAG;AACR,QAAI,KAAKC,OAAL,CAAaC,SAAjB,EAA4B;AACxBC,0BAAgBC,OAAhB,CAAwB,IAAxB;;AACAC,MAAAA,UAAU,CAAC,MAAM,KAAKC,MAAL,EAAP,CAAV;AACH;AACJ;;AAEDC,EAAAA,OAAO,GAAG;AACN,QAAI,CAAC,KAAKN,OAAL,CAAaC,SAAlB,EAA6B;AACzB,WAAKM,MAAL,CAAY,OAAZ,EAAqBC,UAArB,GAAkCC,SAAlC,GAA+C,aAAY,KAAKC,eAAL,GAAuBC,GAAI,KAAtF;AACH;AACJ;;AAGDN,EAAAA,MADA,GACS;AACL,QAAIO,MAAM,GAAGC,QAAQ,CAACC,eAAT,CAAyBC,YAAtC;AACA,QAAIC,GAAG,GAAG,KAAKR,UAAL,GAAkBS,qBAAlB,GAA0CD,GAApD;;AACA,QAAIA,GAAG,IAAIJ,MAAX,EAAmB;AACf,WAAKM,SAAL;AACH;AACJ;;AAEDA,EAAAA,SAAS,GAAG;AACR,QAAIC,KAAK,GAAG,KAAKT,eAAL,EAAZ;;AACA,QAAIS,KAAK,CAACR,GAAN,IAAa,CAACQ,KAAK,CAACC,MAAxB,EAAgC;AAC5B,UAAIC,KAAK,GAAGR,QAAQ,CAACS,aAAT,CAAuB,KAAvB,CAAZ;AACAD,MAAAA,KAAK,CAACE,gBAAN,CAAuB,MAAvB,EAA+B,MAAM;AACjC,YAAIC,MAAM,GAAG,KAAKjB,MAAL,CAAY,OAAZ,EAAqBC,UAArB,EAAb;AACAgB,QAAAA,MAAM,CAACf,SAAP,GAAmB,EAAnB;AACAe,QAAAA,MAAM,CAACC,WAAP,CAAmBJ,KAAnB;;AACAnB,4BAAgBwB,SAAhB,CAA0B,IAA1B;;AACA,aAAKC,MAAL,CAAY,QAAZ,EAAsB,IAAtB;AACH,OAND;AAOAN,MAAAA,KAAK,CAACO,YAAN,CAAmB,KAAnB,EAA0BT,KAAK,CAACR,GAAhC;AACH;AACJ;;AAEDkB,EAAAA,SAAS,GAAG;AACR3B,wBAAgBC,OAAhB,CAAwB,IAAxB;;AACAC,IAAAA,UAAU,CAAC,MAAM,KAAKC,MAAL,EAAP,CAAV;AACH;;AAzCwB,C;eA4Cdd,S","sourcesContent":["import {subscribe, view, View} from \"adajs\";\nimport LazyimageService from \"./state.js\";\nimport eventDispatcher from \"../dispatcher\";\nimport \"./../style/base.scss\";\n\n@view({\n    className: \"lazyimage\",\n    template: \"./template.html\",\n    style: \"./style.scss\",\n    dataset: {\n        service: LazyimageService\n    }\n})\nclass Lazyimage extends View {\n    oncreated() {\n        if (this.context.isBrowser) {\n            eventDispatcher.observe(this);\n            setTimeout(() => this.scroll());\n        }\n    }\n\n    onready() {\n        if (!this.context.isBrowser) {\n            this.finder(\"image\").getElement().innerHTML = `<img src=\"${this.getCurrentState().url}\"/>`;\n        }\n    }\n\n    @subscribe(\"scroll\")\n    scroll() {\n        let height = document.documentElement.clientHeight;\n        let top = this.getElement().getBoundingClientRect().top;\n        if (top <= height) {\n            this.loadImage();\n        }\n    }\n\n    loadImage() {\n        let state = this.getCurrentState();\n        if (state.url && !state.loaded) {\n            let image = document.createElement(\"img\");\n            image.addEventListener(\"load\", () => {\n                let target = this.finder(\"image\").getElement();\n                target.innerHTML = \"\";\n                target.appendChild(image);\n                eventDispatcher.unobserve(this);\n                this.commit(\"loaded\", true);\n            });\n            image.setAttribute(\"src\", state.url);\n        }\n    }\n\n    onrecover() {\n        eventDispatcher.observe(this);\n        setTimeout(() => this.scroll());\n    }\n}\n\nexport default Lazyimage;\n"]}