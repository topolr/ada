"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _dec,_dec2,_dec3,_dec4,_class,_class2,_adajs=require("adajs"),_state=_interopRequireDefault(require("site/content/state.js")),_pagemenu=_interopRequireDefault(require("site/pagemenu/index.js")),_loading=_interopRequireDefault(require("site/loading/index.js")),_prism=_interopRequireDefault(require("lib/prism.js")),_comment=_interopRequireDefault(require("site/comment/index.js")),_connector=_interopRequireDefault(require("site/connector/index.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _applyDecoratedDescriptor(e,t,r,i,a){var n={};return Object.keys(i).forEach(function(e){n[e]=i[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},n),a&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(a):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(e,t,n),n=null),n}require("lib/prism.css");let Content=(_dec=(0,_adajs.view)({className:"content",template:"site/content/template.html",style:"site/content/style.scss",dataset:{service:_state.default},module:"site/content/index.js"}),_dec2=(0,_adajs.handler)("openreply"),_dec3=(0,_adajs.handler)("closereply"),_dec4=(0,_adajs.handler)("commentdone"),_dec((_applyDecoratedDescriptor((_class2=class extends _adajs.StaticViewGroup{oncreated(){window.document.body.scrollTop=0,this.getElement().style.minHeight=window.innerHeight+"px"}onready(){let e=this.getCurrentState();this.addChild(_loading.default,{name:"loading",container:this.finder("page").getElement()}),this.addChild(_pagemenu.default,{name:"menu",parameter:{menu:e.menu,title:e.title,desc:e.desc,close:e.close,loading:!e.content},container:this.finder("head").getElement()}),this.commit("getpage").then(()=>{if(!this.isRemoved()){let e=[];[...this.getElement().querySelectorAll("h2")].forEach(t=>{e.push({title:t.innerText,id:t.getAttribute("id"),subs:[]})}),[...this.getElement().querySelectorAll("h3")].forEach(t=>{let r=t;for(;r&&(!r.tagName||"h2"!==r.tagName.toLowerCase());)r=r.previousSibling;r&&r.tagName&&"h2"===r.tagName.toLowerCase()&&e.some(e=>{if(e.element===r)return e.subs.push({title:t.innerText,id:t.getAttribute("id")}),!0})}),this.getCurrentState().content&&this.removeChildByName("loading"),this.commit("setmenu",e).then(()=>{this.context.isBrowser&&_prism.default.highlightAllUnder(this.getElement()),this.autoLoadModule().then(()=>{this.context.snapshot()})})}})}tags(){return{pagemenu:_pagemenu.default,loading:_loading.default}}oncommited(){let e=this.getChildByName("menu");if(e){let t=this.getCurrentState();e.update({menu:t.menu,title:t.title,desc:t.desc,close:t.close,loading:!t.content})}this.getCurrentState().commentId&&!this._at&&(this._at=!0,this.addChild(_comment.default,{name:"comment",parameter:{commentId:this.getCurrentState().commentId},container:this.finder("comment").getElement()}))}autoLoadModule(){return[...this.getElement().querySelectorAll(".ada-module")].reduce((e,t)=>e.then(()=>{let e=t.dataset.type,r=t.dataset.option?JSON.parse(t.dataset.option):{};return imports(e).then(e=>this.addChild(e,{parameter:r,container:t}))}),Promise.resolve())}openReply(){this.addChild(_connector.default,{name:"reply",parameter:{commentId:this.getCurrentState().commentId}})}closeReply(){this.removeChildByName("reply")}commentDone(){this.getChildByName("comment").commit("get")}onrecover(){_prism.default.highlightAllUnder(this.getElement())}}).prototype,"openReply",[_dec2],Object.getOwnPropertyDescriptor(_class2.prototype,"openReply"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"closeReply",[_dec3],Object.getOwnPropertyDescriptor(_class2.prototype,"closeReply"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"commentDone",[_dec4],Object.getOwnPropertyDescriptor(_class2.prototype,"commentDone"),_class2.prototype),_class=_class2))||_class);var _default=Content;exports.default=_default;