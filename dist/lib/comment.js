"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class Session{constructor(t){this.context=t,this.client_id="4b5042acc1e0f611dcbb",this.client_secret="4e8d2f4341b5a5e29e7b4b4b04d8b2ab03e837b8",this.scope="public_repo",this.resp="topolr/ada",this.token=void 0,this.userinfo=void 0;try{let e=t.window.localStorage.getItem("gitoken");this.token=e&&"undefined"!==e?e:void 0,e=t.window.localStorage.getItem("gituser"),this.userinfo=e?JSON.parse(e):void 0,e=t.window.location.href.split("?");let s={};e.length>1&&e[1].split("#")[0].split("&").forEach(t=>{let e=t.split("=");s[e[0]]=e[1]}),this.code=s.code}catch(t){}}getLoginInfo(){return{client_id:this.client_id,client_secret:this.client_secret,scope:this.scope}}isLogin(){return void 0!==this.token}}class Comment{constructor(t){this.context=t,this._session=new Session(t)}get session(){return this._session}get(t,e){return this.context.request.fetch({url:`https://api.github.com${t}`,method:"get",headers:{Accept:"application/vnd.github.squirrel-girl-preview, application/vnd.github.html+json",Authorization:`token ${this.session.token}`,"Content-Type":"application/json"},body:JSON.stringify(e)})}post(t,e){return this.context.request.fetch({url:`https://api.github.com${t}`,method:"post",body:JSON.stringify(e),headers:{Accept:"application/vnd.github.squirrel-girl-preview, application/vnd.github.html+json",Authorization:`token ${this.session.token}`,"Content-Type":"application/json"}})}getLoginURL(t){let e=Object.assign({},this.session.getLoginInfo(),{redirect_uri:t||"http://adajs.io/dist/"});return`https://github.com/login/oauth/authorize?${Reflect.ownKeys(e).map(t=>`${t}=${e[t]}`).join("&")}`}login(){return this.session.token?Promise.resolve(this.session.token):this.context.request.fetch({url:"https://cors-anywhere.herokuapp.com/https://github.com/login/oauth/access_token",method:"post",data:Object.assign({},this.session.getLoginInfo(),{code:this.session.code}),dataType:"text"}).then(t=>{if(t.split){let e={};t.split("&").forEach(t=>{let s=t.split("=");e[s[0]]=s[1]}),this.session.token=e.access_token;try{this.context.window.localStorage.setItem("gitoken",this.session.token)}catch(t){}return this.get("/user").then(t=>{try{this.context.window.localStorage.setItem("gituser",t),this.session.userinfo=t}catch(t){}})}})}getIssueCommentsById(t){return this.context.request.get(`https://api.github.com/repos/${this.session.resp}/issues/${t}/comments?client_id=4b5042acc1e0f611dcbb&client_secret=4e8d2f4341b5a5e29e7b4b4b04d8b2ab03e837b8&t=${(new Date).getTime()}`)}getMarkdownContent(t){return this.context.request.fetch({url:"https://api.github.com/markdown?client_id=4b5042acc1e0f611dcbb&client_secret=4e8d2f4341b5a5e29e7b4b4b04d8b2ab03e837b8",method:"post",body:JSON.stringify({text:t||"",mode:"gfm",context:"github/gollum"}),headers:{"Content-Type":"application/json"}})}comment(t,e){return this.post(`/repos/${this.session.resp}/issues/${t}/comments`,{body:e})}}var _default=Comment;exports.default=_default;