/*! adajs 3.0.7 https://github.com/topolr/ada | https://github.com/topolr/ada/blob/master/LICENSE */(function (map,moduleName) {var Installed={};var requireModule = function (index) {if (Installed[index]) {return Installed[index].exports;}var module = Installed[index] = {exports: {}};map[index].call(module.exports, module, module.exports, requireModule);return module.exports;};var mod=requireModule(map.length-1);Ada.installModule(moduleName,mod);})([function(module,exports,require){module.exports={}},function(module,exports,require){"use strict";let Metadata=require(10),{DDM:DDM,MapDom:MapDom}=require(11),{getDataSetFromParent:getDataSetFromParent,isFunction:isFunction,isPropsChange:isPropsChange,isPropsChangeEqual:isPropsChangeEqual,protectData:protectData,randomid:randomid,setProp:setProp}=require(7),{BINDERS:BINDERS,CHANGEPROPS:CHANGEPROPS,CHILDRENTAG:CHILDRENTAG,CLASSNAME:CLASSNAME,CONNECTS:CONNECTS,CONNECTSTATE:CONNECTSTATE,DATASET:DATASET,DDMCONTAINER:DDMCONTAINER,DDMTAG:DDMTAG,ELEMENTTAG:ELEMENTTAG,HANDLERS:HANDLERS,IDNAME:IDNAME,ISREMOVED:ISREMOVED,OUTERVIEW:OUTERVIEW,PARENTVIEWTAG:PARENTVIEWTAG,PREREMOVED:PREREMOVED,SUBSCRIBE:SUBSCRIBE,USEPROPS:USEPROPS,VIEWINFO:VIEWINFO,VIEWNAME:VIEWNAME,MODULEPATH:MODULEPATH,VIEWTAG:VIEWTAG,CONTEXT:CONTEXT,OBSERVERS:OBSERVERS}=require(12),factory=require(3),{DataSet:DataSet,DataSetHelper:DataSetHelper}=require(2),Collector=require(13),{ViewHadRemovedError:ViewHadRemovedError}=require(14);const macros={module({bodyStr:e,props:t,events:s,attrs:r}){let i=['data-module=""'];return Reflect.ownKeys(r).forEach(e=>i.push(`${e}="${e}"`)),{template:`<div ${i.join(" ")}>${e}</div>`,data:t}}},tags={module:{template({bodyStr:e,props:t,events:s,attrs:r}){let i=['data-module=""'];return Reflect.ownKeys(r).forEach(e=>i.push(`${e}="${e}"`)),`<div ${i.join(" ")}>${e}</div>`},selfClose:!1}};function addChild(e=null,{name:t="",parameter:s={},container:r=null,attrs:i={}}={},n,o=!1){if(n.isRemoved())return Promise.reject(new ViewHadRemovedError("view had removed,can not add child"));{r?r instanceof MapDom&&(r=r.getElement()):r=n.context.document.body;let h=n.context.document.createElement("div");if(h.setAttribute("data-module",`out:${n.getId()}`),Reflect.ownKeys(i).forEach(e=>h.setAttribute(e,i[e])),o&&n.getDDMContainer().contains(r))throw Error("[ada] BondViewGroup can not append child in the DDM container element");return r.appendChild(h),factory.getViewInstance({viewClass:e,parent:n,name:t,dom:h,useProps:[],context:n.context}).then(e=>{if(!e.isRemoved())return setProp(e,OUTERVIEW,!0),Promise.resolve().then(()=>e.oncreated()).then(()=>e.update(s).then(()=>{n.getChildren().push(e)}).then(()=>n.onchildadded(e)).then(()=>e.onready()).then(()=>e))})}}class ViewEvent{constructor(e,t,s){this.target=e,this.data=s,this.type=t,this._goon=!0,this.currentTarget=null}stopPropagation(){this._goon=!1}}class ClassNames{static getClassName(e,t){return e?`${e}-${t}`:t}constructor(e){this._view=e,this._className=e.getAnnotationInfo().className||""}add(e){return this._view.getElement().classList.add(ClassNames.getClassName(this._className,e)),this}remove(e){return this._view.getElement().classList.remove(ClassNames.getClassName(this._className,e)),this}has(e){return this._view.getElement().classList.contains(ClassNames.getClassName(this._className,e))}toggle(e){return this._view.getElement().classList.toggle(ClassNames.getClassName(this._className,e)),this}}class BaseView{constructor({parent:e=null,dom:t=null,info:s={},name:r="",useProps:i=[],context:n=null,id:o}){t||(t=n.document.body),setProp(this,CONTEXT,n),setProp(this,IDNAME,o||randomid(10)),setProp(this,PARENTVIEWTAG,e),setProp(this,ELEMENTTAG,t),setProp(this,ISREMOVED,!1),setProp(this,PREREMOVED,!1),setProp(this,VIEWINFO,s),setProp(this,VIEWNAME,r),setProp(this,USEPROPS,i),setProp(this,OBSERVERS,{}),s.className&&setProp(this,CLASSNAME,s.className),setProp(this,DDMTAG,new DDM({id:this.getId(),container:this.getDDMContainer(),templateStr:s.template||"",binders:({method:e,parameters:t})=>{let s=(this[BINDERS]||{})[e];s&&this[s]&&this[s](t)},option:{tags:this._getTags()},fns:this.fns(),macro:this._macros(),directives:this.directives(),className:s.className||"",context:n})),this.className=new ClassNames(this),this.getElement().setAttribute("data-module-id",this[IDNAME])}get context(){return this[CONTEXT]}oncreated(){}onready(){}onupdated(){}oneffected(){}onunload(){}onrecover(){}getId(){return this[IDNAME]}getName(){return this[VIEWNAME]}getElement(){return this[ELEMENTTAG]}getParent(){return this[PARENTVIEWTAG]}getAnnotationInfo(){return this[VIEWINFO]}getDDMContainer(){return this[ELEMENTTAG]}isRemoved(){return!0===this[ISREMOVED]}isOuterView(){return!0===this[OUTERVIEW]}finder(e){return this.isRemoved()?[]:this.getDDM().finder(e)}finders(e){return this.isRemoved()?[]:this.getDDM().finders(e)}group(e){return this.isRemoved()?null:this.getDDM().group(e)}groups(e){return this.isRemoved()?[]:this.getDDM().groups(e)}getElementClassName(e=""){if(this.isRemoved())return null;{let t=this[CLASSNAME];return t?e?`${t}-${e}`:t:e}}tags(){return{}}macros(){return{}}fns(){return{}}directives(){return{}}getDDM(){return this[DDMTAG]}getDataSet(){return null}isRendered(){return this.getDDM().isRendered()}getClassName(){let e="";if(e=this[VIEWINFO].module?this[VIEWINFO].module:this.constructor[MODULEPATH]){let t=e.split(".");return t.pop(),t.join(".").replace(/\//g,".")+"."+this.constructor.name}return this.constructor.name}getCurrentState(){return{}}getSnapshot(){return{}}dispatchEvent(e,t){if(!this.isRemoved()){let s=new ViewEvent(this,e,t),r=this;for(;r&&(r._triggerEvent(s),s._goon);)r=r.getParent()}}rerender(){}getAssetURL(e){let t=this.getAnnotationInfo().asset;return t?(this.context.config.basePath+"/"+t+"/"+e).replace(/[\/]+/g,"/"):""}excuteAssetScript(e){let t=this.getAssetURL(e);return new Promise((e,s)=>{this.context.request.origin({url:t,method:"get"}).promise.then(({data:t})=>{new Function("window",t).call(this.context.window,this.context.window),e()})})}excuteAssetStyle(e){let t=this.getAssetURL(e);return new Promise((e,s)=>{if(!this.context.document.querySelector('script[src="'+t+'"]')){let e=this.context.document.createElement("style");e.setAttribute("media","screen"),e.setAttribute("type","text/css"),this.context.document.head.appendChild(e)}e()})}on(e,t){this[OBSERVERS][e]||(this[OBSERVERS][e]=[]),-1===this[OBSERVERS][e].indexOf(t)&&this[OBSERVERS][e].push(t)}emit(e,t){return(this[OBSERVERS][e]||[]).reduce((e,s)=>e.then(()=>new Promise(e=>{Promise.resolve().then(()=>s(t)).then(t=>e(t),t=>{console.error(t),e()})})),Promise.resolve())}_triggerEvent(e){if(!this.isRemoved()){e.currentTarget=this;let t=this[HANDLERS];t&&t[e.type]&&this[t[e.type]](e)}}_getParentUseProps(){return this[USEPROPS]}_getChangedProps(){return[]}_getUsedProps(){return this.getDDM().getUseProps()}_getTags(){let e=this.tags(),t={};return Reflect.ownKeys(this.tags()).forEach(s=>{let r=e[s];isFunction(r)?t[s]={option:{type:r},template({bodyStr:e,props:t,events:s,attrs:r,generateOption:i}){let n=['data-module=""'];return t.type=i.type,Reflect.ownKeys(r).forEach(e=>n.push(`${e}="${e}"`)),`<div ${n.join(" ")}>${e}</div>`},selfClose:!1}:t[s]=r}),Object.assign(t,this.context.tags.get(),this._tags())}_refresh(e=!1){return this.isRemoved()?Promise.resolve():this.getDDM().modules().reduce((t,s)=>t.then(()=>{let t=s.element()[VIEWTAG],r=s.getAttributes(),i=r.type,n=r.parameter,o=r.name||null,h=r.id,a=r.useProps?[...r.useProps]:[];if(!t||t.constructor!==i||t.isRemoved()||t.getName()!==o||r.hasOwnProperty("id")&&t.getId()!==h){let e=Promise.resolve();return t&&!t.isRemoved()&&(e=e.then(()=>t._remove())),e=e.then(()=>factory.getViewInstance({viewClass:i,parent:this,dom:s.element(),name:o,useProps:a,context:this.context,id:h}).then(e=>{if(!e.isRemoved())return Promise.resolve().then(()=>e.oncreated()).then(()=>e.update(n).then(()=>{if(this.onchildadded)return this.onchildadded(e)}).then(()=>e.onready()).then(()=>e))}))}return t&&r.hasOwnProperty("parameter")&&(e||isPropsChange(this._getChangedProps(),t._getParentUseProps()))?t.update(n).then(()=>t.oneffected()).then(()=>t):Promise.resolve(void 0)}),Promise.resolve()).then(()=>{if(!this.isRemoved())return this[CHILDRENTAG]=this.getDDM().modules().map(e=>{let t=e.getAttributes(),s=e.element()[VIEWTAG];return s[USEPROPS]=t.useProps?[...t.useProps]:[],s}).concat(this[CHILDRENTAG].filter(e=>e.isOuterView())),this.onupdated()})}_macros(){return Object.assign(this.macros(),{})}_tags(){return{}}_remove(){if(!this.isRemoved()){let e=Promise.resolve(),t=this.getParent();if(t&&!t.isRemoved()){let s=t[CHILDRENTAG].indexOf(this);-1!==s&&t[CHILDRENTAG].splice(s,1),!0!==this[PREREMOVED]&&t.onchildremoved&&(e=e.then(()=>t.onchildremoved(this)))}return e=e.then(()=>(this.removeAllChild&&this.removeAllChild(),this.onunload())).then(()=>{this.getElementClassName()&&this.getElement().classList.remove(this.getElementClassName()),this.getElement().innerHTML="",this[DATASET]&&this[DATASET]._remove(),Reflect.deleteProperty(this.getElement(),VIEWTAG),Reflect.ownKeys(this).forEach(e=>{this[e]=null}),this[ISREMOVED]=!0})}return Promise.resolve()}_clean(){if(this[ISREMOVED]=!0,this.getParent()){let e=this.getParent().getChildren(),t=e.indexOf(this);-1!==t&&e.splice(t,1)}this.onunload&&this.onunload(),Reflect.ownKeys(this).forEach(e=>{e!==ISREMOVED&&(this[e]=null)})}}class ViewConnector extends BaseView{constructor(e){super(e),setProp(this,CHILDRENTAG,[]),setProp(this,CONNECTS,[]),setProp(this,CHANGEPROPS,[]),setProp(this,CONNECTSTATE,this.setContextDataSets((e,t,s)=>{let r={};isFunction(e)&&(e={service:e,dataset:DataSet});let i=getDataSetFromParent(this,e);return i&&(this[CONNECTS].push(i),r=i._addListener(this,t,s)),r})||{})}setContextDataSets(e){}onupdate(e,t){return e}getCurrentState(){return this[CONNECTSTATE]}update(e){return this.isRemoved()?Promise.reject(new ViewHadRemovedError("view had removed,can not add child")):this._updateFromParent(protectData(e))}onchildremoved(){}onchildadded(){}getChildAt(e=0){return this.isRemoved()?null:this[CHILDRENTAG][e]}getChildrenByType(e){return!this.isRemoved()&&e?this.getChildren().filter(t=>t instanceof e):[]}getChildByName(e){return!this.isRemoved()&&e&&this.getChildren().filter(t=>t.getName()===e)[0]||null}getChildren(){return this.isRemoved()?[]:this[CHILDRENTAG]}getSnapshot(){return{state:this.getCurrentState(),id:this.getId(),name:this.getName(),connector:!0}}rerender(){return this.getElement().innerHTML="",this.getDDM().render(this.getCurrentState(),!1),this._refresh()}_updateFromParent(e){let t=new Collector({data:this.getCurrentState(),fn:this.onupdate});return this[CONNECTSTATE]=t.invoke(e,this),this[CHANGEPROPS]=t.getChangedProps(),isPropsChange(this._getChangedProps(),this._getUsedProps())?this._render():this.isRendered()?Promise.resolve():this._render()}_updateFromConnect({data:e={},setter:t}){let s=new Collector({data:this.getCurrentState(),fn:t});return this[CONNECTSTATE]=s.invoke(e,this),this[CHANGEPROPS]=s.getChangedProps(),isPropsChange(this._getChangedProps(),this._getUsedProps())?this._render():Promise.resolve()}_render(e){let t=!0;return!e&&this.isRendered()&&(0!==this.getDDM().getPureUseProps().length&&isPropsChangeEqual(this._getChangedProps(),this.getDDM().getPureUseProps())||(t=!1,this.getDDM().resetState(this.getCurrentState()))),t&&this.getDDM().render(this.getCurrentState()),this._refresh(e)}_macros(){return Object.assign(this.macros(),macros)}_tags(){return tags}_remove(){return this[CONNECTS].forEach(e=>e._removeListener(this)),super._remove()}_getChangedProps(){return this[CHANGEPROPS]}}class View extends BaseView{constructor(e){super(e),setProp(this,BINDERS,Metadata.getMetadataExtends("binder",this.constructor.prototype)),setProp(this,SUBSCRIBE,Metadata.getMetadataExtends("subscribe",this.constructor.prototype)),setProp(this,HANDLERS,Metadata.getMetadataExtends("handler",this.constructor.prototype)),this[VIEWINFO].dataset&&setProp(this,DATASET,DataSetHelper.getDataSet(this[VIEWINFO].dataset,this))}onbeforecommit(){}oncommited(){}getDataSet(){return this[DATASET]}getCurrentState(){return this[DATASET]?this[DATASET].getData():{}}update(e){return this.isRemoved()?Promise.reject(new ViewHadRemovedError("view had removed,can not add child")):this._updateFromParent(e)}commit(e,t){return this[DATASET]?this[DATASET].commit(e,t):null}getSnapshot(){return{state:this.getCurrentState(),id:this.getId(),name:this.getName(),useProps:this[USEPROPS],out:this.isOuterView(),module:this[VIEWINFO].module,connector:!1}}rerender(){return this.getElement().innerHTML="",this.getDDM().render(this.getCurrentState(),!1),this.context.config.develop&&this.getDDM().modules().length>0&&console.warn("[ada] view typeof View can not has any child [",this.getClassName(),"]"),Promise.resolve().then(()=>this.onupdated())}_updateFromParent(e){return this[DATASET]&&e?this.commit("update",e):this.isRendered()?Promise.resolve():this._render()}_updateFromDataSet(){return this.isRendered()?isPropsChangeEqual(this._getChangedProps(),this._getUsedProps())?this._render():Promise.resolve():this._render()}_updateForceFromDataSet(){return this._render(!0)}_render(e=!1){return this.getDDM().render(this.getCurrentState()),this.context.config.develop&&this.getDDM().modules().length>0&&console.warn("[ada] view typeof View can not has any child [",this.getClassName(),"]"),Promise.resolve().then(()=>this.onupdated())}_getChangedProps(){return this[DATASET]?this[DATASET].getChangedProps():[]}}class ViewGroup extends View{constructor(e={}){super(e),setProp(this,CHILDRENTAG,[])}onchildremoved(){}onchildadded(){}getChildAt(e=0){return this.isRemoved()?null:this[CHILDRENTAG][e]}getChildrenByType(e){return!this.isRemoved()&&e?this.getChildren().filter(t=>t instanceof e):[]}getChildByName(e){return!this.isRemoved()&&e&&this.getChildren().filter(t=>t.getName()===e)[0]||null}getChildren(){return this.isRemoved()?[]:this[CHILDRENTAG]}getSnapshot(){return{state:this.getCurrentState(),id:this.getId(),name:this.getName(),useProps:this[USEPROPS],out:this.isOuterView(),module:this[VIEWINFO].module,connector:!1,children:this.getChildren().map(e=>e.getSnapshot())}}tags(){return{}}rerender(){return this.getElement().innerHTML="",this.getDDM().render(this.getCurrentState(),!1),this._refresh(!0)}_macros(){return Object.assign(this.macros(),macros)}_updateFromDataSet(){return this.isRendered()?isPropsChange(this._getChangedProps(),this._getUsedProps())?this._render():Promise.resolve():this._render()}_render(e=!1){let t=!0;return!e&&this.isRendered()&&(0!==this.getDDM().getPureUseProps().length&&isPropsChangeEqual(this._getChangedProps(),this.getDDM().getPureUseProps())||(t=!1,this.getDDM().resetState(this.getCurrentState()))),t&&this.getDDM().render(this.getCurrentState()),this._refresh(e)}_tags(){return tags}}class StaticViewGroup extends ViewGroup{constructor(e={}){super(e)}addChild(e=null,{name:t="",parameter:s={},container:r=null,attrs:i={}}={}){return addChild(e,arguments[1],this,!1)}removeChild(e){if(!this.isRemoved()){let t=this.getChildren().indexOf(e);-1!==t&&(this[CHILDRENTAG].splice(t,1),e.isRemoved()||e.getElement().parentNode.removeChild(e.getElement()))}return this}removeChildAt(e=0){if(!this.isRemoved()){let t=this.getChildren()[e];t&&this.removeChild(t)}return this}removeChildByName(e){if(!this.isRemoved()&&e){let t=this.getChildByName(e);t&&this.removeChild(t)}return this}removeAllChild(){if(!this.isRemoved()){let e=this.getChildren();for(;e&&e.length>0;){let t=e.shift();t.isRemoved()||t.getElement().parentNode.removeChild(t.getElement())}}return this}removeChildByType(e){if(!this.isRemoved()&&e){let t=this.getChildrenByType(e);for(;t&&t.length>0;){let e=t.shift();e.isRemoved()||e.getElement().parentNode.removeChild(e.getElement())}}return this}_macros(){return Object.assign(this.macros(),{})}_tags(){return{}}_refresh(){return this.context.config.develop&&this.getDDM().modules().length>0&&console.warn("[ada] view typeof StaticViewGroup can not has any child defined in DDM [",this.getClassName(),"]"),Promise.resolve().then(()=>this.onupdated())}rerender(){console.warn("[ada] StaticViewGroup UnSupport rerender()")}}class BondViewGroup extends ViewGroup{getDDMContainer(){if(!this[DDMCONTAINER]){let e=this.getElement().querySelector("."+this.getElementClassName("ddmcontainer"));e||((e=this.context.document.createElement("div")).setAttribute("class",this.getElementClassName("ddmcontainer")),this.getElement().appendChild(e)),setProp(this,DDMCONTAINER,e)}return this[DDMCONTAINER]}addChild(e=null,{name:t="",parameter:s={},container:r=null,attrs:i={}}={}){return addChild(e,arguments[1],this,!0)}removeChild(e){if(!this.isRemoved()){let t=this.getChildren().indexOf(e);if(-1!==t&&(this[CHILDRENTAG].splice(t,1),!e.isRemoved())){if(this.getDDMContainer().contains(e.getElement()))throw Error("[ada] BondViewGroup can not remove child in the DDM container");e.getElement().parentNode.removeChild(e.getElement())}}return this}removeAllChild(){let e=this.getChildren().filter(e=>{if(!e.isRemoved()&&!this.getDDMContainer().contains(e.getElement()))return e});for(;e&&e.length>0;){let t=e.shift();t.isRemoved()||t.getElement().parentNode.removeChild(t.getElement())}}removeChildByType(e){if(!this.isRemoved()&&e){let t=this.getChildrenByType(e);for(;t.length>0;){let e=t.shift();e.isRemoved()||e.getElement().parentNode.removeChild(e.getElement())}}return this}removeChildByName(e){if(!this.isRemoved()&&e){let t=this.getChildByName(e);t&&this.removeChild(t)}return this}rerender(){return this.getDDMContainer().innerHTML="",this.getDDM().render(this.getCurrentState(),!1),this._refresh(!0)}}module.exports={View:View,ViewGroup:ViewGroup,StaticViewGroup:StaticViewGroup,BondViewGroup:BondViewGroup,ViewConnector:ViewConnector};},function(module,exports,require){"use strict";let Metadata=require(10),{DATASETACTION:DATASETACTION,DATASETCOMMITCOUNT:DATASETCOMMITCOUNT,DATASETCOMPUTE:DATASETCOMPUTE,DATASETDATA:DATASETDATA,DATASETEDITS:DATASETEDITS,DATASETISCOMMIT:DATASETISCOMMIT,DATASETLISTENER:DATASETLISTENER,DATASETOWNER:DATASETOWNER,DATASETRANSACTION:DATASETRANSACTION,DATASETRANSACTIONSTATE:DATASETRANSACTIONSTATE,DATASETRANSACTIONSTEP:DATASETRANSACTIONSTEP,DATASETSERVICE:DATASETSERVICE,CONTEXT:CONTEXT,PRIMEKEY:PRIMEKEY}=require(12),Collector=require(13),{isPropsChange:isPropsChange,protectData:protectData,setProp:setProp}=require(7);class Service{get context(){return this[CONTEXT]}get request(){return this[CONTEXT].request}defaultData(){return{}}assign(t,...T){let e=this[PRIMEKEY];if(e.length>0){let A=T.filter(t=>"object"==typeof t).map(t=>{let T={};return Reflect.ownKeys(t||{}).filter(t=>-1!==e.indexOf(t)).forEach(e=>{void 0!==t[e]&&(T[e]=t[e])}),T});Object.assign(t,...A)}else Object.assign(t,...T)}onupdate(t,T){this.assign(t,T)}}class DataSet{constructor(){setProp(this,DATASETOWNER,null),setProp(this,DATASETDATA,null),setProp(this,DATASETSERVICE,null),setProp(this,DATASETLISTENER,[]),setProp(this,DATASETEDITS,[]),setProp(this,DATASETISCOMMIT,null),setProp(this,DATASETCOMMITCOUNT,0)}get context(){return this[DATASETOWNER].context}commit(t,T){return this[DATASETCOMMITCOUNT]++,this[DATASETISCOMMIT]?this[DATASETISCOMMIT]=this[DATASETISCOMMIT].then(()=>DataSetHelper.commit(this,t,T)):this[DATASETISCOMMIT]=DataSetHelper.commit(this,t,T),this[DATASETISCOMMIT].then(t=>t)}getData(){return this[DATASETDATA]||(this[DATASETDATA]=this[DATASETSERVICE].defaultData(),this[DATASETSERVICE][PRIMEKEY]=Reflect.ownKeys(this[DATASETDATA]||{}).filter(t=>!t.startsWith("_"))),this[DATASETDATA]}getComputeData(t,T){let e=this[DATASETSERVICE][DATASETCOMPUTE][t];if(e&&this[DATASETSERVICE][e])return this[DATASETSERVICE][e](this.getData(),T);throw Error("[ada] servie")}toggleService(t){if(!(t.prototype instanceof this.defaultService()))throw Error("[ada] toggle service must be a subclass of this dataset default service class");this[DATASETSERVICE]=new t}getChangedProps(){return this[DATASETEDITS]}_addListener(t,T,e){let A={};if(-1!==this[DATASETLISTENER].findIndex(T=>T.view===t))throw Error("ViewConnector can only invoke connect once with the same DataSet filter");{let S=new Collector({data:this[DATASETDATA],fn:T});A=S.invoke(),setTimeout(()=>{this[DATASETLISTENER].push({useprops:S.getUsedProps(),view:t,getter:T,setter:e})})}return A}_removeListener(t){let T=this[DATASETLISTENER].findIndex(T=>T.view===t);-1!==T&&this[DATASETLISTENER].splice(T,1)}_remove(){this[DATASETDATA]=null,this[DATASETOWNER]=null,this[DATASETSERVICE]=null,this[DATASETLISTENER]=[]}_setState(t){this[DATASETDATA]=t}}class TransactDataSet extends DataSet{constructor(){super(),setProp(this,DATASETRANSACTION,[]),setProp(this,DATASETRANSACTIONSTATE,[]),setProp(this,DATASETRANSACTIONSTEP,0)}commit(t,T){return this[DATASETRANSACTION].unshift({type:t,data:T}),super.commit(t,T)}getTransactionSize(){return 1/0}getCommitSize(){return this[DATASETRANSACTIONSTATE].length}getCurrentStep(){return this[DATASETRANSACTIONSTEP]}getCurrentCommit(){return this[DATASETRANSACTION][this.getCurrentStep()]}getTransactionList(){return this[DATASETRANSACTION]}rollback(t=1){return this[DATASETRANSACTIONSTATE].length>0?(this[DATASETRANSACTION].splice(0,t),this[DATASETRANSACTIONSTATE].splice(0,t),this[DATASETRANSACTIONSTEP]=this[DATASETRANSACTIONSTATE].length,this[DATASETDATA]=this[DATASETRANSACTIONSTATE][0],this[DATASETOWNER]._updateForceFromDataSet().then(()=>DataSetHelper.dispatchForce(this).then(()=>(this[DATASETEDITS]=[],this[DATASETDATA])))):Promise.resolve(this.getData())}travel(t=0){return t=this[DATASETRANSACTIONSTATE].length-t,this[DATASETRANSACTIONSTATE].length>0&&this[DATASETRANSACTIONSTATE][t]?(this[DATASETRANSACTIONSTEP]=t,this[DATASETDATA]=this[DATASETRANSACTIONSTATE][t],this[DATASETOWNER]._updateForceFromDataSet().then(()=>DataSetHelper.dispatchForce(this).then(()=>(this[DATASETEDITS]=[],this[DATASETDATA])))):Promise.resolve(this.getData())}resetHistory(){setProp(this,DATASETRANSACTION,[]),setProp(this,DATASETRANSACTIONSTATE,[]),setProp(this,DATASETRANSACTIONSTEP,0)}_setState(t){this[DATASETRANSACTIONSTATE].length>this.getTransactionSize()&&this[DATASETRANSACTIONSTATE].shift(),this[DATASETRANSACTIONSTATE].unshift(t),this[DATASETRANSACTIONSTEP]=this[DATASETRANSACTIONSTATE].length-1,this[DATASETDATA]=t}}class DataSetHelper{static getDataSet({type:t=DataSet,service:T=Service},e){let A=new t;if(A[DATASETOWNER]=e,!(T.prototype instanceof Service))throw Error("[ada] must be a Service class");return A[DATASETSERVICE]=new T,A[DATASETSERVICE][DATASETACTION]=Object.assign({update:"onupdate"},Metadata.getMetadataExtends("action",A[DATASETSERVICE].constructor.prototype)||{}),A[DATASETSERVICE][DATASETCOMPUTE]=Metadata.getMetadataExtends("compute",A[DATASETSERVICE].constructor.prototype)||{},A[DATASETSERVICE][CONTEXT]=e.context,A}static commit(t,T,e){return Promise.resolve().then(()=>t[DATASETOWNER].onbeforecommit(T)).then(()=>DataSetHelper.trigger(t,T,e).then(e=>(t[DATASETCOMMITCOUNT]--,0===t[DATASETCOMMITCOUNT]&&(t[DATASETISCOMMIT]=null),Promise.resolve().then(()=>t[DATASETOWNER]&&t[DATASETOWNER].oncommited(T)).then(()=>e)),e=>(console.error(e),t[DATASETCOMMITCOUNT]--,0===t[DATASETCOMMITCOUNT]&&(t[DATASETISCOMMIT]=null),Promise.resolve().then(()=>t[DATASETOWNER]&&t[DATASETOWNER].oncommited(T)).then(()=>e))))}static trigger(t,T,e){let A=t[DATASETSERVICE][DATASETACTION][T];if(A&&t[DATASETSERVICE][A]){let T=new Collector({data:t.getData(),fn:t[DATASETSERVICE][A]});return Promise.resolve().then(()=>T.invoke(protectData(e),t[DATASETSERVICE])).then(e=>{if(t[DATASETOWNER])return t._setState(e||{}),t[DATASETEDITS]=T.getChangedProps(),t[DATASETOWNER]._updateFromDataSet().then(()=>DataSetHelper.dispatch(t).then(()=>(t[DATASETEDITS]=[],e)))})}return Promise.reject(`[ada] service action is undefined name is ${T}`)}static dispatch(t){return DataSetHelper.dispatchDatasetListeners(t,t[DATASETLISTENER].filter(T=>isPropsChange(t.getChangedProps(),T.useprops,t[DATASETOWNER])))}static dispatchForce(t){return DataSetHelper.dispatchDatasetListeners(t,t[DATASETLISTENER])}static dispatchDatasetListeners(t,T){return T.reduce((T,e)=>T.then(()=>{if(e.view.isRemoved())return Promise.resolve();{let T=new Collector({data:t.getData(),fn:e.getter}),A=T.invoke();return e.useprops=T.getUsedProps(),e.view._updateFromConnect({data:A,setter:e.setter})}}),Promise.resolve())}}module.exports={Service:Service,DataSet:DataSet,TransactDataSet:TransactDataSet,DataSetHelper:DataSetHelper};},function(module,exports,require){"use strict";let Metadata=require(10),{ROOTELEMENTNAME:ROOTELEMENTNAME,VIEWTAG:VIEWTAG,DATASET:DATASET,DATASETDATA:DATASETDATA,DDMTAG:DDMTAG,CHILDRENTAG:CHILDRENTAG}=require(12),{parseTemplate:parseTemplate,parseStyle:parseStyle,excuteStyle:excuteStyle,setProp:setProp}=require(7),env=require(9),factory={cleanView:e=>e.querySelectorAll&&!e.parentNode?[e,...e.querySelectorAll("[data-module]")].reverse().reduce((e,t)=>e.then(()=>t[VIEWTAG]&&t[VIEWTAG]._remove&&!t._sorted?t[VIEWTAG]._remove():Promise.resolve()),Promise.resolve()):Promise.resolve(),getViewInstance({viewClass:e,parent:t,dom:o,name:r="",tag:n="view",useProps:a=[],context:l=null,id:s}){let d=Metadata.getMetadataExtends(n,e.prototype);d.scope||(d.scope="local");let i=Promise.resolve();return d.template&&(i=i.then(()=>l.loader.loadSource(d.template).then(e=>{d.template="local"===d.scope?parseTemplate(e,d.className):e}))),d.style&&(i=i.then(()=>l.loader.loadSource(d.style).then(e=>{excuteStyle("local"===d.scope?parseStyle(e,d.className):e,`${d.style.replace(/\//g,"-")}:${d.className}`,l)}))),i.then(()=>{d.className&&o.classList.add(d.className);let n=new e({parent:t,info:d,name:r,dom:o,useProps:a,context:l,id:s});return setProp(o,VIEWTAG,n),n})},getRootView(e,t={},o=null){let r=()=>{if(o.document.getElementById("ada-root"))return Promise.resolve(null);{let r=o.document.createElement("div");r.setAttribute("id",ROOTELEMENTNAME),r.setAttribute("class",ROOTELEMENTNAME),r.setAttribute("data-module","ada-root"),o.document.body.appendChild(r);let n=r[VIEWTAG];return n?Promise.resolve(n):factory.getViewInstance({viewClass:e,parent:null,dom:r,tag:"root",name:"root",useProps:[],context:o}).then(e=>(e.oncreated(),e.update(t).then(()=>(e.onready(),e))))}};return new Promise((e,t)=>{/complete|loaded|interactive/.test(o.document.readyState)?r().then(t=>e(t)):o.document.addEventListener("DOMContentLoaded",()=>r().then(t=>e(t)),!1)})},init(e,t){e._steps.push("init"),t&&(e._bootFlow=e._bootFlow.then(()=>t.call({context:e})).then(t=>e._invokeHook("initdone",t)))},boot({root:e="",basePath:t="",parameter:o={},map:r={},develop:n=!0,context:a,name:l=""}={}){a._steps.push("boot"),a.config={root:e,basePath:t,develop:n,parameter:o,sourceMap:r,name:l},env.develop=n,0===e.indexOf("./")&&(e=e.substring(2)),0===e.indexOf("/")&&(e=e.substring(1)),a._bootFlow=a._bootFlow.then(()=>a.loader.loadModule(e).then(()=>{let e=null;return a.loader.moduleLoader.scanClass((t,o)=>{if(Metadata.getMetadata("root",o.prototype))return e=o,!1}),e?factory.getRootView(e,o,a).then(e=>{let t=a.window.MutationObserver||a.window.WebKitMutationObserver||a.window.MozMutationObserver;return t?new t(e=>{e.forEach(e=>[...e.removedNodes].reduce((e,t)=>e.then(()=>factory.cleanView(t)),Promise.resolve()))}).observe(a.document,{childList:!0,subtree:!0}):a.document.addEventListener("DOMNodeRemoved",e=>factory.cleanView(e.target)),e}):(console.error("root class can not find"),Promise.reject())})).then(()=>a._invokeHook("bootdone"))},recover(e,t){let o=(t,r)=>{let{id:n,module:a,name:l,useProps:s}=t;return e.loader.loadModule(a).then(a=>this.getViewInstance({viewClass:a,parent:r,dom:e.document.querySelectorAll("[data-module-id='"+n+"']")[0],name:l,tag:r?"view":"root",useProps:s,context:e,id:n}).then(e=>{let r=Promise.resolve();if(e[DATASET]&&(e[DATASET][DATASETDATA]=t.state),e[DDMTAG]&&e[DDMTAG].render(t.state),e.oncreated){let t=e.oncreated();t&&t.then&&(r=r.then(()=>t))}if(e.onrecover){let t=e.onrecover();t&&t.then&&(r=r.then(()=>t))}return t.children&&(r=r.then(()=>t.children.reduce((t,r)=>t.then(()=>o(r,e).then(t=>{e[CHILDRENTAG].push(t)})),Promise.resolve()).then(()=>e))),r.then(()=>e)}))};e._steps.push("recover"),e._bootFlow=e._bootFlow.then(()=>new Promise(r=>{/complete|loaded|interactive/.test(e.document.readyState)?o(t,null).then(r):e.document.addEventListener("DOMContentLoaded",()=>{o(t,null).then(r)})})).then(()=>e._invokeHook("recoverdone"))}};module.exports=factory;},function(module,exports,require){"use strict";let{View:View}=require(1),{SUBSCRIBE:SUBSCRIBE}=require(12);class Dispatcher{constructor(){this._listener=[]}observe(e){return e instanceof View&&-1===this._listener.indexOf(e)&&this._listener.push(e),this}unobserve(e){let i=this._listener.indexOf(e);return-1!==i&&this._listener.splice(i,1),this}dispatch(e,i){this._listener.forEach(s=>{if(!s.isRemoved()){let t=s[SUBSCRIBE][e];try{t&&s[t]&&s[t](i)}catch(e){console.error("[ada] dispatcher subscriber call error ",e)}}}),this._listener=this._listener.filter(e=>!e.isRemoved())}}module.exports={Dispatcher:Dispatcher};},function(module,exports,require){"use strict";let Collector=require(13),{BASEDATA:BASEDATA}=require(12);class Passable{constructor(e){Reflect.defineProperty(this,BASEDATA,{enumerable:!1,configurable:!1,writable:!0,value:e})}pass(e,t={},l={}){return e||(e=(e=>e)),new Collector({data:this[BASEDATA],fn:e,collect:!1}).invoke(t,l)}static get(e){return new Passable(e)}}module.exports=Passable;},function(module,exports,require){"use strict";let{isObject:isObject,isFunction:isFunction}=require(7),Metadata=require(10),{DataSet:DataSet,Service:Service}=require(2),{setSourcePaths:setSourcePaths}=require(16);function checkDataSetMetaInfo(t){isFunction(t)&&(t={service:t});let e=!0,n="",a=Object.assign({type:DataSet,service:null},t);return isFunction(a.type)&&a.type.prototype instanceof DataSet||a.type===DataSet||(e=!1,n="[ada] dataset must be a class or subclass of  DataSet"),isFunction(a.service)&&(a.service.prototype instanceof Service||a.service===Service)||(e=!1,n="[ada] service must be a class or subclass of  Service"),{checked:e,errorInfo:n,info:a}}function setViewAnnotation(t,e){if(null===e||isObject(e))return function(n){let a=e||{};if(a.dataset){let{checked:t,errorInfo:e,info:n}=checkDataSetMetaInfo(a.dataset);if(!t)throw Error(`[data] view dataset error ${e}`);a.dataset=n}setSourcePaths(a),Metadata.defineMetadata(t,a,n.prototype)};Metadata.defineMetadata(t,{},e.prototype)}function setMethodAnnotation(t,e){if(e)return function(n,a){let o=Metadata.getMetadata(t,n)||{};e.split(",").forEach(t=>o[t]=a),Metadata.defineMetadata(t,o,n)};throw Error(`[ada] annotation ${e} name can not be empty`)}exports.view=function(t=null){return setViewAnnotation("view",t)},exports.root=function(t=null){return setViewAnnotation("root",t)},exports.action=function(t){return setMethodAnnotation("action",t)},exports.compute=function(t){return setMethodAnnotation("compute",t)},exports.handler=function(t){return setMethodAnnotation("handler",t)},exports.binder=function(t){return setMethodAnnotation("binder",t)},exports.subscribe=function(t){return setMethodAnnotation("subscribe",t)};},function(module,exports,require){"use strict";let{DATASET:DATASET,DATASETSERVICE:DATASETSERVICE}=require(12),Passable=require(5),env=require(9);const QUREYREG=/(^|&).*=([^&]*)(&|$)/,TEMPLATEREG=/class=(["'])(?:(?=(\\?))\2.)*?\1/g,STYLEREG=/\{|\}/,STYLEREG_B=/\.[0-9a-zA-Z-]+/g,ISHTMLREG=/^\s*<(\w+|!)[^>]*>/;function isString(e){return"string"==typeof e&&e.constructor===String}function isFunction(e){return"function"==typeof e&&e.constructor===Function}function isEqual(e,t){if(null===e||void 0===e||null===t||void 0===t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;let n=Object.keys(e);return Object.keys(t).every(function(e){return-1!==n.indexOf(e)})&&n.every(function(n){return isEqual(e[n],t[n])})}function isObject(e){return"object"==typeof e&&"[object object]"===Object.prototype.toString.call(e).toLowerCase()&&!e.length}function isPlainObject(e){return isObject(e)&&e.constructor.prototype===Object.prototype}function isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}function isQueryString(e){return isString(e)&&QUREYREG.test(e)}function queue(e){let t=null,n=[];return e.forEach(e=>{t=t?t.then(t=>(n.push(t),e())):e()}),t?t.then(e=>(n.push(e),n)):Promise.resolve([])}function randomid(e=7){return e<=2&&(e=7),Math.random().toString(36).slice(2,e+2)}function setProp(e,t,n){Reflect.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!0,value:n})}function queryString(e){let t=[];if(e){for(let n in e){let r=e[n];isString(r)?t.push(`${n}=${encodeURIComponent(r)}`):isObject(r)||isArray(r)?t.push(`${n}=${encodeURIComponent(JSON.stringify(r))}`):t.push(`${n}=${void 0!==r&&null!==r?encodeURIComponent(r.toString()):""}`)}return t.join("&")}return""}function postData(e,t){if(e){if(e instanceof FormData||e instanceof Blob||e instanceof ArrayBuffer)return e;if(isObject(e)){let n=!1;for(let t in e)if(e[t]instanceof Blob||e[t]instanceof ArrayBuffer||e[t]instanceof File){n=!0;break}if(n){let t=new FormData;for(let n in e)e[n]instanceof Blob?t.append(n,e[n]):e[n]instanceof File?t.append(n,e[n]):isArray(e[n])||isObject(e[n])?t.append(n,encodeURIComponent(JSON.stringify(e[n]))):e[n]instanceof FormData||t.append(n,encodeURIComponent(e[n].toString()));return t}return t?queryString(e):JSON.stringify(e)}return isArray(e)?encodeURIComponent(JSON.stringify(e)):e}return null}function parseTemplate(e,t){return t?e.replace(TEMPLATEREG,function(e){if(-1===e.indexOf("{{")){let n=e.substring(7,e.length-1).trim().split(" ").map(e=>":"===e[0]?e.substring(1):t+"-"+e),r=e.substr(6,1);return`class=${r}${n.join(" ")}${r}`}return`class="{{(${e.substring(9,e.length-3).trim()}).split(' ').map(key=>key?(key[0]!==':'?('${t}-'+key):key.substring(1)):'').join(' ')}}"`}):e}function parseStyle(e,t){let n="",r=[],i=[];return e.split(STYLEREG).forEach(e=>{let t=e.trim();-1!==t.indexOf("@")&&(i.push([].concat(r)),r=[]),r.push(t)}),i.push(r),i.forEach(e=>{let r=!1,i=[];-1!==e[0].indexOf("@")&&(r=!0,n+=e[0]+"{",e.shift()),e.forEach((e,n)=>{e=e.trim(),(n+1)%2!=0?i.push(e.replace(STYLEREG_B,e=>e.substring(1).trim()!==t?`.${t}-${e.substring(1)}`:e)):e&&i.push("{"+e+"}")}),n+=r?i.join("")+"}":i.join("")}),n}function excuteStyle(e,t,n){if(!n.document.getElementById(t)){let r=n.document.createElement("style");r.setAttribute("media","screen"),r.setAttribute("type","text/css"),r.setAttribute("id",t),r.appendChild(n.document.createTextNode(e)),n.document.getElementsByTagName("head")[0].appendChild(r)}}function hashCode(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return t}function encodeHTML(e,t){if(ISHTMLREG.test(e)){let n=t.document.createElement("div");return void 0!=n.textContent?n.textContent=e:n.innerText=e,n.innerHTML}return e}function getMappedPath(e){return`P${Math.abs(hashCode(e))}`}function extend(){let e,t,n,r,i,o,s=arguments[0]||{},a=1,u=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||isFunction(s)||(s={}),a===u&&(s=this,a--);a<u;a++)if(null!=(e=arguments[a]))for(t in e)n=s[t],s!==(r=e[t])&&(c&&r&&(isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,o=n&&Array.isArray(n)?n:[]):o=n&&isPlainObject(n)?n:{},s[t]=extend(c,o,r)):void 0!==r&&(s[t]=r));return s}function clone(e){return isArray(e)?extend(!0,[],e):isObject(e)?extend(!0,{},e):e}function isTargetDataSet(e,t){let n=!0;return e[DATASETSERVICE]instanceof t.service||(n=!1),n&&t.type&&(e instanceof t.type||(n=!1)),n}function getDataSetFromParent(e,t){let n=null,r=e.getParent();for(;r;){let e=r[DATASET];if(e&&isTargetDataSet(e,t)){n=e;break}r=r.getParent()}return n}function isPropsChange(e,t){return e&&t&&e.length>0&&t.length>0?e.some(e=>t.some(t=>0===t.indexOf(e)||0===e.indexOf(t)||e===t)):!(0===e.length||0===t.length)}function isPropsChangeEqual(e,t){return e&&t&&e.length>0&&t.length>0?e.some(e=>-1!==t.indexOf(e)):!(0===e.length||0===t.length)}function protectData(e){let t=e;return!Object.isFrozen(e)&&env.develop&&(t=Passable.get(e).pass()),t}function isBrowser(){return"undefined"!=typeof window}module.exports={isString:isString,isFunction:isFunction,isEqual:isEqual,isObject:isObject,isPlainObject:isPlainObject,isArray:isArray,isQueryString:isQueryString,queue:queue,randomid:randomid,setProp:setProp,queryString:queryString,postData:postData,parseTemplate:parseTemplate,parseStyle:parseStyle,hashCode:hashCode,encodeHTML:encodeHTML,getMappedPath:getMappedPath,extend:extend,clone:clone,excuteStyle:excuteStyle,isTargetDataSet:isTargetDataSet,getDataSetFromParent:getDataSetFromParent,isPropsChange:isPropsChange,isPropsChangeEqual:isPropsChangeEqual,protectData:protectData,isBrowser:isBrowser};},function(module,exports,require){"use strict";let BaseContext=require(19),{isBrowser:isBrowser}=require(7),Loader=require(20),BrowserLogger=require(21),BrowserRequest=require(22),RequestManager=require(23);class BrowserContext extends BaseContext{constructor(){super(),this._window={},isBrowser()&&(this._window=window),this._loader=new Loader(this),this._logger=new BrowserLogger(this),this._request=new RequestManager(this,BrowserRequest)}get window(){return this._window}get document(){return this._window.document}get logger(){return this._logger}get request(){return this._request}}module.exports=BrowserContext;},function(module,exports,require){"use strict";let env={develop:!1};module.exports=env;},function(module,exports,require){"use strict";const METADATAKEY="[[metadata]]",Metadata={defineMetadata(e,t,a){-1===Reflect.ownKeys(a).indexOf(METADATAKEY)&&Reflect.defineProperty(a,METADATAKEY,{enumerable:!1,configurable:!1,writable:!1,value:{}}),a[METADATAKEY][e]=t},getMetadata(e,t){let a=t,A=void 0;for(;a;){if(-1!==Reflect.ownKeys(a).indexOf(METADATAKEY)){A=a[METADATAKEY][e];break}a=Reflect.getPrototypeOf(a)}return A},getMetadataExtends(e,t){let a=t,A=[];for(;a;)-1!==Reflect.ownKeys(a).indexOf(METADATAKEY)&&A.push(a[METADATAKEY][e]),a=Reflect.getPrototypeOf(a);return Object.assign({},...A.reverse())}};module.exports=Metadata;},function(module,exports,require){"use strict";let eventHelper=require(15),Collector=require(13),{encodeHTML:encodeHTML,isFunction:isFunction,isPlainObject:isPlainObject,randomid:randomid,isString:isString,hashCode:hashCode}=require(7),{PROXYSTATE:PROXYSTATE}=require(12);const REGS={k:/\r/g,l:/\n/g,a:/&lt;/g,b:/&gt;/g,d:/<%|%>/g,e:/^=.*;$/,i:/\r\n/g,f:/>[\s]+</g,g:/<%[\s\S]*%>/,h:/\<\!\-\-[\s\S]*?\-\-\>/g,startdot:/&lt;/g,enddot:/&gt;/g,isDoctype:/\<\!DOCTYPE[\s\S]*?\>/g,isNote:/\<\!\-\-[\s\S]*?\-\-\>/g,isXmlTag:/\<\?[\s\S]*?\?\>/g,propcode:/\@\[\[[0-9]+\]\]\@/g,eventcode:/\$\[\[[0-9]+\]\]\$/g,assigncode:/\(\(\[[0-9]+\]\)\)/g,assigncodex:/\(\(\[[0-9]+\]\)\)/,assigncodeonly:/^\(\(\[[0-9]+\]\)\)$/,expresscode:/\[\[[0-9]+\]\]/g,nodecode:/\{\{node\}\}/g,prop:/[0-9a-zA-Z_]+((\.)([0-9a-zA-Z_]+))+/g,customA:/<[\s\S]+?>/g,customB:/<[0-9a-z_-]+?>/,customC:/<[0-9a-z_-]+ .*?>/,customD:/<\/[0-9a-z_-]+?>/,customE:/<[0-9a-z_-]+?\/>/,macro:/this\._macro\(\{[\s\S]+?\}\);/g,macroTag:/tag:"[\s\S]+?"/,syntaxs:/\{\{[\s\S]+?\}\}/g,threeIf:/[\s\S]+\?[\s\S]+?:/},SINGLETAG=["br","hr","img","input","param","link","meta","area","base","basefont","param","col","frame","embed","keygen","source"],IDNAME="$$ID";let SelfCloseTags=[...SINGLETAG],TemplateCache={map:{},set(e,t){this.map[e]=Object.assign(this.map[e]||{},t)},get(e){return this.map[e]},has(e){return void 0!==this.map[e]}},TemplateParseCache={map:{},has(e){return void 0!==this.map[e]},set(e,t){this.map[e]=t},get(e){return this.map[e]}},Parser={beautySyntax:{syntaxs:{defaults:e=>`<%=${e.substring(2,e.length-2)};%>`,log:e=>`<%window.Ada.log?window.Ada.log(${e.join(" ")}):console.log(${e.join(" ")});%>`,html:e=>`<%=assign(html,${e.filter(e=>!!e).join(",")});%>`,map(e){let t=e.shift();e.shift();let s=e.shift()||"$value",r=e.shift()||"$key",n="_"+randomid(8);return`<%for(var ${n} in ${t}){var ${s}=${t}[${n}];var ${r}=${n};%>`},"/map":()=>"<%}%>",list(e){var t=e.shift();e.shift();let s=e.shift()||"$item",r=e.shift()||"$index",n="_"+randomid(8),a="_"+randomid(6);return`<%if(${t}&&${t}.length>=0)for(var ${n}=0,${r}=0,${a}=${t}.length;${n}<${a};${n}++){var ${s}=${t}[${n}];${r}=${n};%>`},"/list":e=>"<%}%>",if:(e,t)=>`<%if(${e.join(" ")}){%>`,elseif:(e,t)=>`<%}else if(${e.join(" ")}){%>`,else:(e,t)=>"<%}else{%>","/if":()=>"<%}%>",break:()=>"<%break;%>",set:e=>`<%var ${e.join(" ")};%>`},parse:(e="",t)=>e.replace(REGS.syntaxs,e=>{let s=e.substring(2,e.length-2).split(" "),r=s.shift();try{let n={};Reflect.ownKeys(t||{}).forEach(e=>{n[e]=(t=>`<%=assign(${e},${t.filter(e=>!!e).join(",")});%>`)});let a=Object.assign(Parser.beautySyntax.syntaxs,n);return a[r]?a[r](s):a.defaults(e)}catch(e){console.log(e)}})},nodeParser:{getNodeStr(e){let t={},s={},r={},n=[];return Reflect.ownKeys(e.props).forEach(function(a){if(a.startsWith("on")){let s=a.substring(2);t[s]=e.props[a],n.push(s)}else if(a.startsWith("@")){let t=a.substring(1);r[t]=e.props[a]}else"data-find"===a?s["data-find"]=`${IDNAME}+":${e.props["data-find"]}"`:"data-group"===a?s["data-group"]=`${IDNAME}+":${e.props["data-group"]}"`:"data-module"===a?s["data-module"]=`${IDNAME}`:s[a]=`"${e.props[a]}"`}),n.length>0&&(s["data-bind"]=`${IDNAME}+":${n.join(",")}"`),`{tag:"${e.tag}",attrs:{${Reflect.ownKeys(s).map(e=>`"${e}":${s[e]}`).join(",")}},events:{${Reflect.ownKeys(t).map(e=>`${e}:$${t[e]}$`).join(",")}},props:{${Reflect.ownKeys(r).map(e=>'"'===r[e][0]?`${e}:${r[e]}`:`${e}:@${r[e]}@`).join(",")}},children:[]}`},code(e,t){if(e.isTextNode){let t="";return t=/\(\[[0-9]+\]\)/.test(e.content)?e.content:`{content:"${e.content||""}"}`}{let s="",r="",n=Parser.nodeParser.getNodeStr(e);return e.parent?(s="$$NODE"+t,r=n?`${n};$$CURRENT=${s};`:`$$CURRENT=${s};`):r=`var ${s="$$NODE"+t}=${n};$$CURRENT=${s};`,e.children.forEach(e=>{if(e.isTextNode&&/\(\[[0-9]+\]\)/.test(e.content))r+=e.content;else{let n=t.split("_"),a=`$$NODE${t=`${n[0]}_${n[1]/1+1}`}`,i=Parser.nodeParser.code(e,t);";"===i[i.length-1]?r+=`var ${a}=${i} ${s}.children.push(${a}); $$CURRENT=${s};`:r+=`var ${a}=${i}; ${s}.children.push(${a}); $$CURRENT=${s};`}}),r}}},getHTMLString(e,t,s){let r="",n=t=>{let r="",a=-1!==SINGLETAG.indexOf(t.tag);if(void 0!==t.content)if(void 0===t.type)r=encodeHTML(t.content,e)||"";else{let n=t.type,a=t.content,i=Object.assign({},e.ddm.defaultAssignDirectives,s);i[n]&&(a=i[n](t.content)),r='<div class="ada-assign-directive" data-assign-directive-type="'+n+'">'+(a||"")+"</div>"}else{let e=[];if(t.attrs&&Reflect.ownKeys(t.attrs).forEach(function(s,r){t.attrs[s]&&e.push(s+'="'+t.attrs[s]+'"')}),a)r="<"+t.tag+" "+e.join(" ")+"/>";else{let s=[];t.children.forEach(function(e){e&&s.push(n(e))}),r="<"+t.tag+" "+e.join(" ")+">"+s.join("")+"</"+t.tag+">"}}return r};return t.forEach(function(e){r+=n(e)}),r},preparse(e,t="",s={}){return t=this.parseCustomTag(e,t.trim(),s).replace(REGS.isNote,"").replace(REGS.isDoctype,"").replace(REGS.isXmlTag,"").replace(REGS.a,"<").replace(REGS.b,">").replace(REGS.h,"").replace(REGS.f,"><").replace(REGS.i,"").replace(REGS.k,"").replace(REGS.l,""),[...SelfCloseTags,...Reflect.ownKeys(s).filter(e=>{let t=s[e];if(!isFunction(t))return!0===t.selfClose})].forEach(e=>{let s=new RegExp(`<${e} .*?>`,"g");t=t.replace(s,function(e){return e.substring(0,e.length-1)+"/>"})}),t},parseCustomTag:(e,t,s={})=>t.replace(REGS.customA,t=>t.replace(REGS.customB,t=>{let r=t.substring(1,t.length-1);return e.tags.has(r)||void 0!==s[r]?`<@custom @customTagName="${r}">`:(e.tags.isRegularTag(r)||console.warn(`[ada] tag [${r}] seemed not supported`),t)}).replace(REGS.customE,t=>{let r=t.substring(1,t.length-2);return e.tags.has(r)||void 0!==s[r]?`<@custom @customTagName="${r}"/>`:(e.tags.isRegularTag(r)||console.warn(`[ada] tag [${r}] seemed not supported`),t)}).replace(REGS.customC,t=>{let r=t.split(" "),n=r.shift().substring(1);return e.tags.has(n)||void 0!==s[n]?(r.unshift(`<@custom @customTagName="${n}"`),r.join(" ")):(e.tags.isRegularTag(n)||console.warn(`[ada] tag [${n}] seemed not supported`),t)}).replace(REGS.customD,t=>{let r=t.substring(2,t.length-1);return e.tags.has(r)||void 0!==s[r]?"</@custom>":(e.tags.isRegularTag(r)||console.warn(`[ada] tag [${r}] seemed not supported`),t)})),parseMacro(e=""){if(-1!==e.indexOf("<@")){let t,s=-1,r="",n="start",a="",i="",o="",l=!0,p="",h={},c=0,d=0,u=0,f=0,m=[];for(;s<e.length;)r=e[++s],"start"!==n||"<"!==r||"@"!==e[s+1]?"tagstart"!==n||"@"!==r?"start"!==n||"<"!==r||"/"!==e[s+1]||"@"!==e[s+2]?"endtag"!==n||">"!==r?"tagname"!==n||" "!==r?"tagname"!==n||"/"!==r&&">"!==r?"propname"!==n||"="!==r?"propvalue"!==n||"'"!==r&&'"'!==r?"propvalueing"!==n||r!==t?("endtag"===n&&(p+=r),"tagname"===n&&(a+=r),"propname"===n&&(i+=r),"propvalueing"===n&&(o+=r)):(n="tagname",h[i]=o):(n="propvalueing",t=r,o=""):n="propvalue":(">"===r?(d=s+1,n="start",l=!0):"/"===r&&(d=s+2,n="start",l=!1),""!==a&&m.push({type:"tag",tagname:a,props:h,body:l,start:c,end:d})):(n="propname",i=""):(n="start",f=s+1,m.push({type:"endtag",tagname:p,start:u,end:f})):(u=s,n="endtag",p="",s+=2):(n="tagname",a="",h={}):(n="tagstart",c=s);let g=0,$=0,E=0,_=!1,S=null,b=[],R="",v=0;return Reflect.ownKeys(m).forEach(t=>{let s=m[t];"tag"===s.type&&!1===s.body&&!1===_&&(s.bodystr="",s.from=s.start,s.to=s.end,b.push(s)),"tag"===s.type&&!0===s.body&&(_=!0,null===S&&((S=s).from=s.start),0===g&&($=s.start,E=s.end),g++),"endtag"===s.type&&0===--g&&(S.to=s.end,S.bodystr=e.substring(E,s.start),b.push(S),S=null,_=!1)}),b.forEach(t=>{let s=t.props,r=[],n=[],a=[],i=[],o=[];Reflect.ownKeys(s).forEach(e=>{let t=s[e],l="";if(REGS.g.test(t)){let e="";t.split(REGS.d).forEach((t,s)=>{(s+1)%2==0?""!==t&&(e+=`${t}+`):e+=""!==t?`'${t}'+`:t});let s=e.length>0?e.substring(0,e.length-1):"''";l=s.substring(1,s.length-1)}else l=`"${t}"`;if(e.startsWith("on")){let t=e.substring(2);r.push({name:t,value:l})}else if(e.startsWith("@")){if(n.push(`"${e.substring(1)}":${l}`),"parameter"===e.substring(1).trim()){let e=l.match(REGS.prop);e&&e.forEach(e=>{i.push(e);let t=e.split(".");t.pop(),o.push(`"${e}":${e}`),o.push(`"${t.join(".")}":${t.join(".")}`)})}}else a.push(`"${e}":${l}`)});let l=r.map(e=>{let t=e.value.split(/\(|\)/),s=t.shift();t.pop();let r=[],n=t.map(e=>{if(-1!==e.indexOf(" as ")){let t=e.split("as");return r.push(`${t[1].trim()}`),t[0].trim()}return r.push(`${e.split(".").pop()}`),e});return`"${e.name}":{method:"${s}",parameters:[${n.join(",")}],paranames:"${r.join(",")}"}`});R+=`${e.substring(v,t.from)}<%var $$MACRORESULT=this._macro({tag:"${t.tagname}",props:{${n.join(",")}},attrs:{${a.join(",")}},events:{${l.join(",")}},bodyStr:"${t.bodystr}",uses:[${i.map(e=>"'"+e+"'").join(",")}],usesmap:{${o.join(",")}}});if({{node}}){if($$MACRORESULT&&$$MACRORESULT.length){for(var $$INDEX=0;$$INDEX<$$MACRORESULT.length;$$INDEX++){{{node}}.children.push($$MACRORESULT[$$INDEX]);}}else{{{node}}.children.push({content:$$MACRORESULT||''});}}else{if($$MACRORESULT&&$$MACRORESULT.length){$$RESULT=$$RESULT.concat($$MACRORESULT);}else{$$RESULT.push({content:$$MACRORESULT||''});}}%>`,v=t.to}),R+=e.substring(v,e.length)}return e},parseNode(e=""){if(e&&""!==e){let t=[],s=[],r=null,n="",a="",i="",o="",l="",p=!1,h=!1,c=!1,d=!1,u=!1;for(let f=0,m=e.length;f<m;f++){let m=e[f];if("\r"!==m&&"\n"!==m){if("<"===m){u=!0,""!==l.trim()&&(r={content:l.trim()||"",parent:t[t.length-1]||null,isTextNode:!0},t[t.length-1]?t[t.length-1].children.push(r):s.push(r),l=""),e[f+1]&&"/"===e[f+1]?d=!0:(r={tag:"",props:{},children:[],parent:null,hasProp:!1,isTextNode:!1},t.push(r),t.length-2>=0&&(t[t.length-2].children.push(r),r.parent=t[t.length-2]),p=!0);continue}if(" "===m){if(u&&(p&&(p=!1,r.tag=n.trim(),n=""),!h&&!c)){h=!0;continue}}else if("="===m)u&&(h=!1);else if("'"===m||'"'===m){if(!c&&u){c=m;continue}c===m&&(c=!1,r.hasProp=!0,r.props[i.trim()]=o.trim(),i="",o="")}else{if(">"===m){u=!1,h=!1,c=!1,p=!1,d&&(d=!1,a="",1===t.length&&s.push(t[0]),t.pop()),r.hasProp||(""===r.tag&&(r.tag=n.trim()),n=""),!u&&l&&(l+=m);continue}if("/"===m){e[f+1]&&">"===e[f+1]?(u=!1,c=!1,h=!1,d=!1,p=!1,a="",1===t.length&&s.push(t[0]),r.hasProp||(""===r.tag&&(r.tag=n.trim()),n=""),t.pop()):u?c&&(o+=m):l+=m;continue}}p&&(n+=m),h&&(i+=m),c&&(o+=m),d&&(a+=m),!u&&(l+=m)}}return l&&s.push({content:l||"",parent:null,isTextNode:!0}),s}return[]},reparseNode(e){return e.forEach(e=>{if(e.isTextNode){if(e.parent&&REGS.assigncodex.test(e.content)&&!REGS.assigncodeonly.test(e.content)){let t=[],s=[];e.content.replace(REGS.assigncode,s=>(t.push({content:s,isTextNode:!0,parent:e.parent}),s)).split(REGS.assigncodex).forEach(r=>{r.trim()&&s.push({content:r,isTextNode:!0,parent:e.parent});let n=t.shift();n&&s.push(n)});let r=e.parent.children.indexOf(e);-1!==r&&e.parent.children.splice(r,1,...s)}}else this.reparseNode(e.children)}),e},code(e=""){let t="",s=[],r=[],n='"use strict";\nvar $$RESULT=[],$$CURRENT=null;\n';return e.split(REGS.d).forEach((e,n)=>{n%2!=0?REGS.e.test(e)?(t+=""+`[[${s.length}]]`,s.push(e)):(t+=`(([${r.length}]))`,r.push(e)):t+=""+e}),Parser.reparseNode(Parser.parseNode(t)).forEach((e,t)=>{let s=t+"_0",r=Parser.nodeParser.code(e,s);n+=r+"\r\n",-1!==r.indexOf("$$NODE"+s)&&-1===r.indexOf("$$RESULT.push($$NODE"+s+")")&&(n+="$$RESULT.push($$NODE"+s+");$$CURRENT=null;\r\n")}),n=n.replace(REGS.assigncode,(e,t,s)=>r[e.substring(3,e.length-3)]).replace(REGS.propcode,(e,t,r)=>{let n=s[e.substring(3,e.length-3)];return n&&"="===n[0]?n.substring(1,n.length-1):n}).replace(REGS.eventcode,(e,t,r)=>{let n=s[e.substring(3,e.length-3)];if(n&&"="===n[0]){let e=n.substring(1,n.length-1).split(/\(|\)/),t=[],s=[];return e[1]&&(t=e[1].split(",").map(e=>-1!==e.indexOf(" as ")?e.split("as").pop().trim():-1!==e.indexOf(".")?e.split(".").pop():e),s=e[1].split(",").map(e=>-1!==e.indexOf(" as ")?e.split("as").shift().trim():e)),`{method:"${e[0].trim()}",parameters:[${s.join(",")||""}],paranames:"${t.join(",")}"}`}return n}).replace(REGS.expresscode,(e,t,r)=>{let n=s[e.substring(2,e.length-2)];if(n&&"="===n[0]){let e=n.substring(1,n.length-1);if(0===e.indexOf("assign(")){let t=(e=e.substring(7,e.length-1)).split(","),s=t.shift(),r=t.join(",");return`"+((${r})!==undefined?(${r}):''),"type":"${s}`}return`"+((${e})!==undefined?(${e}):'')+"`}return n}).replace(REGS.nodecode,(e,t,s)=>"$$CURRENT"),n+="return $$RESULT;"},parse(e,t="",s={},r){let n=0,a="";return t.replace(REGS.syntaxs,e=>{let t=e.substring(2,e.length-2).split(" "),s=t.shift();REGS.threeIf.test(t.join(" "))&&n++,-1!==["if","else","elseif"].indexOf(s)&&n++}),a=Parser.code(Parser.parseMacro(Parser.beautySyntax.parse(Parser.preparse(e,t,s),r))),{coverageCount:n,code:a}}},Differ={childrenEvents(e=[]){let t=new Set,s={};return e.forEach(e=>(function e(r){r.events&&(Reflect.ownKeys(r.events).forEach(e=>{if(eventHelper.canBubbleUp(e))t.add(e);else{let t=r.attrs["data-bind"];s[t]||(s[t]=[]),-1===s[t].indexOf(e)&&s[t].push(e)}}),r.attrs&&r.attrs["data-module"]||r.children&&r.children.forEach(t=>e(t)))})(e)),{bubbleEvents:Array.from(t),unBubbleEvents:s}},diffNode(e,t,s,r){if(e&&t){let n=e.length;if(0===e.length)0!==t.length&&r.removeAll.push({path:s.join(",")});else{if(e[0].attrs&&e[0].attrs.uid&&t[0]&&t[0].attrs&&t[0].attrs.uid){let n=[],a=[],i=[],o=[],l=[];o=e.map(e=>e.attrs.uid),t=t.filter((e,t)=>{if(l.push(e.attrs.uid),-1!==o.indexOf(e.attrs.uid))return!0;n.push(t)}),e.forEach((e,s)=>{let r=e.attrs.uid;-1===l.indexOf(r)&&(a.push({node:e,index:s}),t.push(e))});let p=[];t.forEach((e,t)=>{let s=e.attrs.uid,r=o.indexOf(s);-1!==r&&r!==t?(i.push({node:e,from:t,to:r}),p[r]=e):p[t]=e}),t=p,n.forEach(e=>{r.bremove.push({path:s.join(",")+(s.length>0?",":"")+e})}),a.forEach(e=>{r.badd.push({path:s.join(","),node:e.node})}),i.map(e=>{r.sort.push({path:s.join(",")+(s.length>0?",":"")+e.from,to:e.to,from:e.from});let n=t[e.from];t[e.from]=t[e.to],t[e.to]=n})}else e.length<t.length&&(n=t.length);t.length>e.length&&(n=t.length);for(let a=0;a<n;a++){if(s.push(a),e[a])if(t[a])if(e[a].attrs&&void 0!==e[a].attrs["data-module"]){if(void 0!==e[a].attrs["data-module"]){let n=Differ.checkNode(e[a],t[a]);"replace"===n?r.replace.push({path:s.join(","),node:e[a]}):!0!==n&&r.edit.push({path:s.join(","),attrs:n})}}else{let n=Differ.checkNode(e[a],t[a]);t[a].attrs&&void 0!==t[a].attrs["data-module"]?r.replace.push({path:s.join(","),node:e[a]}):!0===n?Differ.diffNode(e[a].children,t[a].children,s,r):"replace"===n?r.replace.push({path:s.join(","),node:e[a]}):(r.edit.push({path:s.join(","),attrs:n}),Differ.diffNode(e[a].children,t[a].children,s,r))}else r.add.push({path:s.join(","),node:e[a]});else r.remove.push({path:s.join(","),node:t[a]});s.pop()}}}},checkNode(e,t){let s=!0;if(void 0!==e.content)s=e.content===t.content||"replace";else{if(e.tag===t.tag){return(e.attrs&&e.attrs["data-module"])!==(t.attrs&&t.attrs["data-module"])?"replace":Differ.checkProps(e.attrs,t.attrs)}s="replace"}return s},checkProps(e,t){let s=Object.keys(e),r=Object.keys(t),n={final:e},a=s.length,i=!1;s.length<r.length&&(a=r.length);for(let r=0;r<a;r++){let n=s[r];if(!n){i=!0;break}if(void 0===t[n]){i=!0;break}if(e[n]!==t[n]){i=!0;break}}return!i||n},diff(e,t){let s={add:[],replace:[],remove:[],edit:[],removeAll:[],bremove:[],badd:[],sort:[]};Differ.diffNode(e,t,[],s);return t=[],s}},Effecter={element(e,t,s,r){if("svg"===t.tag&&!s&&(s=!0),void 0!==t.content){if(s)return e.document.createElementNS("http://www.w3.org/2000/svg","text");if(void 0===t.type)return e.document.createTextNode(t.content);{let s=t.type,n=t.content,a=Object.assign({},e.ddm.defaultAssignDirectives,r);a[s]&&(n=a[s](t.content));let i=e.document.createElement("div");return i.setAttribute("class","ada-assign-directive"),i.setAttribute("data-assign-directive",s),i.innerHTML=n||"",i}}{let r=null;r=s?e.document.createElementNS("http://www.w3.org/2000/svg",t.tag):e.document.createElement(t.tag);for(let e in t.attrs)if(s){let s=e.split(":");s.length>1?r.setAttributeNS("http://www.w3.org/1999/"+s[0],s[1],t.attrs[e]):r.setAttributeNS(null,s[0],t.attrs[e])}else r.setAttribute(e,t.attrs[e]);for(let n=0;n<t.children.length;n++)r.appendChild(Effecter.element(e,t.children[n],s));return r}},effect(e,t,s,r){let n={};if(s.badd.forEach(s=>{let n=t;s.path.trim()&&s.path.split(",").forEach(e=>{n=n.childNodes[e/1]}),n.appendChild(Effecter.element(e,s.node,!1,r))}),s.bremove.map(e=>{let s=t;return e.path.trim()&&e.path.split(",").forEach(e=>{s=s.childNodes[e/1]}),s}).forEach(e=>e.parentNode.removeChild(e)),s.sort.length>0){let r=s.sort.map(e=>{let s=t;return e.path.trim()&&e.path.split(",").forEach(e=>{s=s.childNodes[e/1]}),{node:s,to:e.to,from:e.from}}),n=[...r[0].node.parentNode.childNodes];r.forEach(e=>{n[e.to];n[e.to]=e.node});let a=n[0].parentNode,i=e.document.createDocumentFragment();for(let e=0;e<n.length;e++)i.appendChild(n[e]);a.appendChild(i)}s.replace.forEach(s=>{let n=t,a=!1;s.path.trim()&&s.path.split(",").forEach(t=>{let i=n.childNodes[t/1];i?(n=i,a=!0):(a=!1,n.appendChild(Effecter.element(e,s.node,!1,r)))}),a&&n.parentNode.replaceChild(Effecter.element(e,s.node,!1,r),n)}),s.add.forEach(e=>{let s=t,r=e.path.split(",");r.pop();let a=r.join("");r.forEach(e=>{s=s.childNodes[e/1]}),n[a]?n[a].push({p:s,n:e.node}):n[a]=[{p:s,n:e.node}]}),s.edit.forEach(e=>{let s=t;e.path.trim()&&e.path.split(",").forEach(e=>s=s.childNodes[e/1]);let r=e.attrs,n=[];if(s.attributes.getNamedItem)n=[...s.attributes].map(e=>e.nodeName);else for(let e in s.attributes)n.push(e);Reflect.ownKeys(r.final).forEach(e=>{if(-1===e.indexOf(":")){if(s.getAttribute(e)!==r.final[e]){s.setAttribute(e,r.final[e]);try{s[e]=r.final[e]}catch(e){}}let t=n.indexOf(e);-1!==t&&n.splice(t,1)}else{let t=e.split(":"),a=t[1],i=t[0];s.getAttributeNS("http://www.w3.org/1999/"+i,a)!==r.final[e]&&s.setAttributeNS("http://www.w3.org/1999/"+i,a,r.final[e]);let o=n.indexOf(a);-1!==o&&n.splice(o,1),-1!==(o=n.indexOf(e))&&n.splice(o,1)}}),n.forEach(e=>{if(-1===e.indexOf(":"))s.removeAttribute(e);else{let t=e.split(":"),n=t[1],a=t[0];s.removeAttributeNS("http://www.w3.org/1999/"+a,n,r.final[tp])}})}),s.remove.map(e=>{let s=t,r=e.path.split(","),n=r.pop();return r.forEach(e=>s=s.childNodes[e/1]),s.childNodes[n]}).forEach(e=>e.parentNode.removeChild(e)),s.removeAll.forEach(e=>{let s=t;e.path.trim()&&e.path.split(",").forEach(e=>{s&&(s=s.childNodes[e/1])}),s&&(s.innerHTML="")}),Reflect.ownKeys(n).forEach(t=>{let s=n[t];if(s.length>0){let t=e.document.createDocumentFragment();s.forEach(s=>t.appendChild(Effecter.element(e,s.n,!1,r))),s[0].p.appendChild(t)}else s.p.appendChild(Effecter.element(e,s.n,!1,r))})}};class ClassList{static getClassName(e,t){return e?`${e}-${t}`:t}constructor(e,t){this._mapDom=e,this._className=t}add(e){return this._mapDom._dom.classList.add(ClassList.getClassName(this._className,e)),this}remove(e){return this._mapDom._dom.classList.remove(ClassList.getClassName(this._className,e)),this}has(e){return this._mapDom._dom.classList.contains(ClassList.getClassName(this._className,e))}toggle(e){return this._mapDom._dom.classList.toggle(ClassList.getClassName(this._className,e)),this}}class MapDom{static getElementPath(e=null,t=null){let s=[],r=t;for(;r&&r!==e;)s.push([...r.parentNode.childNodes].indexOf(r)),r=r.parentNode;return s.reverse()}constructor(e=null,t=null,s=""){this._container=e,this._dom=t,this.classList=new ClassList(this,s)}getAttributes(){return this._container._cross.getAttributeByPath(MapDom.getElementPath(this._container._container,this._dom))}getAttribute(e){return this.getAttributes()[e]}getEventInfo(){return this._container._cross.getEventsByPath(MapDom.getElementPath(this._container._container,this._dom))}isListenedEvent(e){return void 0!==this.getEventInfo()[e]}element(){return this._dom}getElement(){return this._dom}groupi(e=""){return[...this._dom.querySelectorAll(`[data-groupi="${e}"]`)].map(e=>new MapDom(this._container,e))}}class Template{constructor({context:e,template:t="",className:s="",macro:r={},id:n,option:a={},fns:i={},directives:o={}}){if(this._id=n,this._currentState=null,this._macrofn=Object.assign({},e.ddm.defaultMacros,r),this._option=a,this._context=e,this._isRendered=!1,this._useprops=[],this._usepureprops=[],this._className=s,this._key=hashCode(`${s}${t}`),this._fns=i,this._fnNames=[],this._fnFns=Reflect.ownKeys(i||{}).map(e=>(this._fnNames.push(e),i[e])),!TemplateCache.has(this._key)){TemplateParseCache.has(this._key)||TemplateParseCache.set(this._key,Parser.parse(e,t,a&&a.tags||{},o));let{coverageCount:s,code:r}=TemplateParseCache.get(this._key);TemplateCache.set(this._key,{template:t,macros:{custom:"",module:""},pureCode:"",pureFn:null,code:r,coverageCount:s,isCollectPure:!1,done:!1,fn:new Function(IDNAME,"data",...this._context.ddm.defaultFunctionNames,...this._fnNames,r)})}}_macro({tag:e,bodyStr:t,props:s,events:r,attrs:n,uses:a,usesmap:i}){if(this._macrofn[e]){let o=new Set;if(s.parameter){let e=s.parameter[PROXYSTATE];e?e._parent&&o.add(e._prop):Array.isArray(e)?e.forEach(e=>{e[PROXYSTATE]&&e[PROXYSTATE]._parent&&o.add(e[PROXYSTATE]._prop)}):isPlainObject(e)&&Reflect.ownKeys(e).forEach(t=>{let s=e[t];s[PROXYSTATE]&&s[PROXYSTATE]._parent&&o.add(s[PROXYSTATE]._prop)})}a.map(e=>{let t=i[e];if(t&&t[PROXYSTATE]&&t[PROXYSTATE]._prop)o.add(t[PROXYSTATE]._prop);else{let t=e.split("."),s=t.pop(),r=t.join("."),n=i[r];n&&n[PROXYSTATE]&&o.add(n[PROXYSTATE]._prop+"."+s)}}),s.useProps=[...o];let l=this._macrofn[e]({attrs:n,events:r,props:s,bodyStr:t,parseBody:function(e){return""!==t?new Template({context:this._context,template:t,className:this._className,macro:this._macrofn,id:this._id,option:null,fns:this._fns}).render(e):""}.bind(this),context:this,id:this._id,option:this._option,env:this._context});if(l&&l.template){let t=new Template({context:this._context,template:l.template,className:this._className,macro:this._macrofn,id:this._id,option:null,fns:this._fns}).getCurrentState(l.data);if(1===t.length){let a=t[0],i=Reflect.ownKeys(r);if(i.length>0&&(a.attrs["data-bind"]=`${this._id}:${i.map(e=>e).join(",")}`),Object.assign(a.props,s),Object.assign(a.events,r),Object.assign(a.attrs,n),a.attrs["data-module"]){let{macros:t}=TemplateCache.get(this._key);!t[e]&&s.useProps.length>0&&this._setPureFn()}return[a]}throw new Error("[ada] macro must return only one node")}return l||""}return console.error("[ada] macro can not found ["+e+"] template is "+TemplateCache.get(this._key)),""}_setPureFn(){let{macros:e}=TemplateCache.get(this._key),t=Reflect.ownKeys(e).filter(t=>""===e[t]);if(t.length>0){t.forEach(t=>e[t]=!0);let s=TemplateCache.get(this._key).code.replace(REGS.macro,e=>{let s=e.match(REGS.macroTag);if(s){let e=s[0].substring(5,s[0].length-1);if(-1!==t.indexOf(e))return"'';"}return e}),r=[IDNAME,"data",...this._context.ddm.defaultFunctionNames,...this._fnNames,s];TemplateCache.set(this._key,{isCollectPure:!0,pureCode:s,pureFn:new Function(...r)})}}getTemplateStr(){return TemplateCache.get(this._key).template}getTemplateInfo(){return TemplateCache.get(this._key)}getAttributeByPath(e=[]){let t={children:this._currentState};return e.forEach(e=>t=t.children[e]),t.props||null}getEventsByPath(e=[]){let t={children:this._currentState};return e.forEach(e=>t=t.children[e]),t.events||null}getAllInfoByPath(e=[]){let t={children:this._currentState};return e.forEach(e=>t=t.children[e]),{events:t.events,props:t.props}}getCurrentEventMap(){return this._currentState?Differ.childrenEvents(this._currentState):{bubbleEvents:[],unBubbleEvents:{}}}getCurrentState(e){let{fn:t}=TemplateCache.get(this._key);return t.call(this,this._id,e,...this._context.ddm.defaultFunctionFns,...this._fnFns)}getCurrentStateWithoutMacros(e){let{pureFn:t}=TemplateCache.get(this._key);return t.call(this,this._id,e,...this._context.ddm.defaultFunctionFns,...this._fnFns)}render(e={},t=!0,s){let r=null;this._currentState&&(r=this._currentState);let n=new Collector({data:e,fn:this.getCurrentState,freeze:!1});if(this._currentState=n.invoke({},this),this._useprops=n.getUsedProps(),TemplateCache.get(this._key).isCollectPure){let t=new Collector({data:e,fn:this.getCurrentStateWithoutMacros,freeze:!1});t.invoke({},this),this._usepureprops=t.getUsedProps(),0===this._usepureprops.length&&0===TemplateCache.get(this._key).coverageCount&&TemplateCache.set(this._key,{isCollectPure:!1,pureFn:null,pureCode:"",done:!0})}else TemplateCache.get(this._key).done||(this._usepureprops=this._useprops);return this._isRendered=!0,t&&r?Differ.diff(this._currentState,r):Parser.getHTMLString(this._context,this._currentState,s)}resetState(e){let t=new Collector({data:e,fn:this.getCurrentState,freeze:!1});this._currentState=t.invoke({},this),this._useprops=t.getUsedProps()}isRendered(){return!TemplateCache.get(this._key).template||this._isRendered}}class DDM{constructor({id:e,container:t=null,templateStr:s="",binders:r={},macro:n={},option:a={},context:i=null,className:o,fns:l={},directives:p={}}){this._context=i,this._id=e,this._container=t,this._cross=new Template({context:i,template:s,className:o,macro:n,id:e,option:a,directives:p,fns:l}),this._directives=p,this._binders=r,this._isrender=!1,this._className=o||""}_agentEvent({bubbleEvents:e,unBubbleEvents:t}){let s=this._container;eventHelper.unbind(s),e.forEach(e=>{eventHelper.bind(s,e,e=>{let t=e.target,s=e.type,r=t,n=[];for(;r&&r!==this._container&&r!==this._context.document;){let t=r.dataset.bind;if(t){let a=t.split(":"),i=a[0],o=a[1]?a[1].split(","):[];if(i===this.getId()&&-1!==o.indexOf(s)){let{events:t,props:s}=this._cross.getAllInfoByPath(MapDom.getElementPath(this._container,r)),a=t[e.type];a&&n.push({info:a,props:s})}}r=r.parentNode}let a=!1;n.find(({info:t,props:s})=>{let{method:r,parameters:n,paranames:i}=t;if(this._binders){let t={e:e,props:s,stopPropagation(){a=!0,e.stopPropagation()}};i.split(",").forEach((e,s)=>t[e]=n[s]),this._binders({method:r,parameters:t})}return a})})}),Reflect.ownKeys(t).forEach(e=>{[...s.querySelectorAll('[data-bind="'+e+'"]')].forEach(s=>{t[e].forEach(e=>{eventHelper.unbind(s,e),eventHelper.bind(s,e,e=>{let t=e.target,s=e.type,r=t.dataset.bind;if(r){let n=r.split(":"),a=n[0],i=n[1]?n[1].split(","):[];if(a===this.getId()&&-1!==i.indexOf(s)){let{events:s,props:r}=this._cross.getAllInfoByPath(MapDom.getElementPath(this._container,t)),n=s[e.type];if(n){let{method:t,parameters:s,paranames:a}=n;if(this._binders){let t={e:e,props:r};a.split(",").forEach((e,r)=>t[e]=s[r]),this._binders({method:n.method,parameters:t})}}}}})})})})}getId(){return this._id}finder(e){return this.finders(e)[0]}finders(e){let t=`[data-find="${`${this._id}:${e}`}"]`;return[...this._container.querySelectorAll(t)].map(e=>new MapDom(this,e,this._className))}group(e){return this.groups(e)}groups(e){let t=`[data-group="${`${this._id}:${e}`}"]`;return[...this._container.querySelectorAll(t)].map(e=>new MapDom(this,e))}modules(){let e=`[data-module="${this._id}"]`;return[...this._container.querySelectorAll(e)].map(e=>new MapDom(this,e))}render(e,t=!0){let s=this._cross.render(e,t,this._directives);return s&&(t&&!isString(s)?Effecter.effect(this._context,this._container,s,this._directives):!this._container.innerHTML&&(this._container.innerHTML=s)),this._agentEvent(this._cross.getCurrentEventMap()),this._isrender=!0,this}resetState(e){this.isRendered()?this._cross.resetState(e):this.render()}getUseProps(){return this._cross._useprops}getPureUseProps(){return this._cross._usepureprops}isRendered(){return this._isrender}}module.exports={Parser:Parser,DDM:DDM,MapDom:MapDom};},function(module,exports,require){"use strict";exports.DDMTAG=Symbol("ddm"),exports.CONTEXT=Symbol("context"),exports.VIEWTAG=Symbol("view"),exports.PARENTVIEWTAG=Symbol("parent"),exports.ELEMENTTAG=Symbol("node"),exports.CHILDRENTAG=Symbol("children"),exports.IDNAME=Symbol("viewid"),exports.DDMCONTAINER=Symbol("ddmbody"),exports.CLASSNAME=Symbol("class"),exports.ISREMOVED=Symbol("isremove"),exports.PREREMOVED=Symbol("preremoved"),exports.ROOTELEMENTNAME="ada-root",exports.OUTERVIEW=Symbol("outview"),exports.DATASET=Symbol("dataset"),exports.BINDERS=Symbol("binders"),exports.SUBSCRIBE=Symbol("subscribe"),exports.HANDLERS=Symbol("handler"),exports.VIEWINFO=Symbol("viewinfo"),exports.CONNECTS=Symbol("connects"),exports.VIEWNAME=Symbol("name"),exports.DATASETOWNER=Symbol("owner"),exports.DATASETDATA=Symbol("data"),exports.DATASETSERVICE=Symbol("service"),exports.DATASETLISTENER=Symbol("listener"),exports.DATASETRANSACTION=Symbol("transaction"),exports.DATASETRANSACTIONSTATE=Symbol("transactionstate"),exports.DATASETRANSACTIONSTEP=Symbol("transactionstep"),exports.DATASETISCOMMIT=Symbol("commits"),exports.DATASETCOMMITCOUNT=Symbol("commitcount"),exports.PROXYSTATE=Symbol("proxy"),exports.DATASETEDITS=Symbol("setprops"),exports.USEPROPS=Symbol("useprops"),exports.CHANGEPROPS=Symbol("changeprops"),exports.DATASETACTION=Symbol("action"),exports.DATASETCOMPUTE=Symbol("compute"),exports.CONNECTSTATE=Symbol("connectstate"),exports.BASEDATA=Symbol("data"),exports.MODULEPATH=Symbol("[[path]]"),exports.OBSERVERS=Symbol("observers"),exports.PRIMEKEY=Symbol("primekey");},function(module,exports,require){"use strict";let{PROXYSTATE:PROXYSTATE}=require(12),issupportproxy="undefined"!=typeof Proxy,env=require(9);const util={is:(e,t)=>e===t?0!==e||1/e==1/t:e!=e&&t!=t,isProxy:e=>!!e&&!!e[PROXYSTATE],isProxyable(e){if(!e)return!1;if("object"!=typeof e)return!1;if(Array.isArray(e))return!0;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype},isProxyProp:e=>"string"==typeof e||"number"==typeof e,has:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),shallowCopy(e){if(Array.isArray(e))return e.slice();{let t=void 0===e.__proto__?Object.create(null):{};return Object.assign(t,e)}},setPropName(e,t){e._parent?e._prop=[e._parent._prop,t].join("."):e._prop=t},finalize(e){if(this.isProxy(e)){let t=e[PROXYSTATE];return!0===t._modified?!0===t._finalized?t._copy:(t._finalized=!0,Array.isArray(t._copy)&&t._copy.forEach((e,r)=>{e!==t._data[r]&&(t._copy[r]=this.finalize(e))}),Reflect.ownKeys(t._copy).forEach(e=>{let r=t._copy[e];r!==t._data[e]&&(t._copy[e]=this.finalize(r))}),this.freeze(t._copy)):this.finalize(t._data)}return this.finalizeNonProxiedObject(e),e},finalizeNonProxiedObject(e){this.isProxyable(e)&&(Object.isFrozen(e)||(this.each(e,(t,r)=>{this.isProxy(r)?e[t]=this.finalize(r):this.finalizeNonProxiedObject(r)}),this.freeze(e)))},freeze:e=>(env.develop&&Object.freeze(e),e),cleanCollector(e){if(e._revokes.forEach(e=>e()),e._getprops=[...e._getprops],e._setprops=[...e._setprops],e._states.length>0){this.each(e._states,(e,t)=>{t.finalizing=!0});for(let t=e._states.length-1;t>=0;t--){const r=e._states[t];!1===r._modified&&(Array.isArray(r._data)?esprop.hasArrayChanges(r)&&esprop.markChanged(r):esprop.hasObjectChanges(r)&&esprop.markChanged(r))}}},each(e,t){if(Array.isArray(e))for(let r=0;r<e.length;r++)t(r,e[r]);else for(let r in e)t(r,e[r])}};class State{constructor(e,t,r){this._data=t,this._parent=e,this._children={},this._modified=!1,this._copy=null,this._prop="",this._finalized=!1,this._collector=r}}class Esstate{constructor(e,t,r,o){this._modified=!1,this._hasCopy=!1,this._parent=e,this._data=r,this._proxy=t,this._copy=void 0,this._collector=o,this._finished=!1,this._finalizing=!1,this._finalized=!1,this._prop=""}}const proxy={markChanged(e){e._modified||(e._modified=!0,e._copy=util.shallowCopy(e._data),Object.assign(e._copy,e._children),e._parent&&this.markChanged(e._parent))},createProxy(e,t,r){const{proxy:o,revoke:i}=Proxy.revocable(new State(t,r,e),handler);return e._revokes.push(i),o}},esprop={createProxy(e,t,r){const o=util.shallowCopy(r);util.each(r,e=>{Object.defineProperty(o,""+e,this.createPropertyProxy(""+e))});const i=new Esstate(t,o,r,e);return this.createHiddenProperty(o,PROXYSTATE,i),e._states.push(i),o},createPropertyProxy:e=>({configurable:!0,enumerable:!0,get(){return eshandler.get(this[PROXYSTATE],e)},set(t){eshandler.set(this[PROXYSTATE],e,t)}}),createHiddenProperty(e,t,r){e&&Object.defineProperty(e,t,{value:r,enumerable:!1,writable:!0})},hasObjectChanges(e){const t=Object.keys(e._data),r=Object.keys(e._proxy);return!this.shallowEqual(t,r)},hasArrayChanges(e){const{_proxy:t}=e;if(t.length!==e._data.length)return!0;const r=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!r||r.get)},prepareCopy(e){e._hasCopy||(e._hasCopy=!0,e._copy=util.shallowCopy(e._data))},shallowEqual(e,t){if(util.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(let o=0;o<r.length;o++)if(!hasOwnProperty.call(t,r[o])||!util.is(e[r[o]],t[r[o]]))return!1;return!0},source:e=>e._hasCopy?e._copy:e._data,markChanged(e){e._modified||(e._modified=!0,e._parent&&this.markChanged(e._parent))}},handler={get(e,t){if(t===PROXYSTATE)return e;{let r=e._data[t],o=!1;if(e._modified)(r=e._copy[t])===e._data[t]&&util.isProxyable(r)&&(r=e._copy[t]=proxy.createProxy(e._collector,e,r),util.setPropName(r[PROXYSTATE],t),e._collector._addUseProp(r[PROXYSTATE]._prop),o=!0);else if(e._children[t])r=e._children[t],o=!0;else{let i=e._data[t];!util.isProxy(i)&&util.isProxyable(i)&&(r=e._children[t]=proxy.createProxy(e._collector,e,i),util.setPropName(r[PROXYSTATE],t),e._collector._addUseProp(r[PROXYSTATE]._prop),o=!0)}return o||util.isProxyProp(t)&&e._collector._addUseProp(e._prop+"."+t),r}},set(e,t,r){if(e._data[t]!==r?e._collector._addSetProp(e._prop+"."+t):e._collector._removeSetProp(e._prop+"."+t),!e._modified){if(t in e._data&&util.is(e._data[t],r)||util.has(e._children,t)&&e._children[t]===r)return!0;e._collector._immutable&&proxy.markChanged(e)}return e._collector._immutable?e._copy[t]=r:e._data[t]=r,!0},has:(e,t)=>t in e._data,ownKeys:e=>Reflect.ownKeys(e._data),deleteProperty:(e,t)=>!0,getOwnPropertyDescriptor(e,t){const r=e._modified?e._copy:util.has(e._children,t)?e._children:e._data,o=Reflect.getOwnPropertyDescriptor(r,t);return o&&(o.configurable=!0),o},defineProperty(){throw new Error("[ada] can not define property on this object")}},eshandler={get(e,t){if(!0===e._finished)throw new Error("Cannot use a proxy that has been revoked."+JSON.stringify(e._copy||e._data));const r=esprop.source(e)[t],o=!1;return!e._finalizing&&r===e._data[t]&&util.isProxyable(r)?(esprop.prepareCopy(e),e._copy[t]=esprop.createProxy(e._collector,e,r)):(o||util.isProxyProp(t)&&e._collector._addUseProp(e._prop+"."+t),r)},set(e,t,r){if(!0===e._finished)throw new Error("Cannot use a proxy that has been revoked."+JSON.stringify(e._copy||e._data));if(e._data[t]!==r?e._collector._addSetProp(e._prop+"."+t):target._collector._removeSetProp(target._prop+"."+t),!e._modified){if(util.is(esprop.source(e)[t],r))return void e._collector._removeSetProp(e._prop+"."+t);esprop.markChanged(e),esprop.prepareCopy(e)}e._collector._immutable?e._copy[t]=r:e._data[t]=r}};class Collector{constructor({data:e,fn:t,immutable:r=!0,collect:o=!0}){this.fn=t,this._revokes=[],this._states=[],this._root=issupportproxy?proxy.createProxy(this,null,e):esprop.createProxy(this,null,e),this._getprops=new Set,this._setprops=new Set,this._immutable=r,this._collect=o}getUsedProps(){return this._getprops}getChangedProps(){return this._setprops}invoke(e,t){let r=null,o=null,i=!1;return e instanceof Collector?(i=!0,r=this.fn.call(t||{},this._root,e._root)):r=this.fn.call(t||{},this._root,e),void 0!==r&&r!==this._root?r.then?r.then(t=>(o=util.finalize(t||this._root),util.cleanCollector(this),i&&(util.finalize(e._root),util.cleanCollector(e)),o)):(o=util.finalize(r),util.cleanCollector(this),i&&(util.finalize(e._root),util.cleanCollector(e)),o):(o=util.finalize(this._root),util.cleanCollector(this),i&&(util.finalize(e._root),util.cleanCollector(e)),o)}_addUseProp(e){this._collect&&this._getprops.add(e)}_addSetProp(e){this._collect&&this._setprops.add(e)}_removeSetProp(e){this._collect&&this._setprops.delete(e)}}module.exports=Collector;},function(module,exports,require){"use strict";class ViewHadRemovedError extends Error{constructor(r){super(r),this.name="ViewHadRemovedError"}}module.exports={ViewHadRemovedError:ViewHadRemovedError};},function(module,exports,require){"use strict";const EVENTTYPES={HTMLEvents:"load,unload,abort,error,select,change,submit,reset,focus,blur,resize,scroll",MouseEvent:"click,mousedown,mouseup,mouseover,mousemove,mouseout",UIEvent:"DOMFocusIn,DOMFocusOut,DOMActivate",MutationEvent:"DOMSubtreeModified,DOMNodeInserted,DOMNodeRemoved,DOMNodeRemovedFromDocument,DOMNodeInsertedIntoDocument,DOMAttrModified,DOMCharacterDataModified"},UNBUBBLINGEVENT=["load","unload","focus","blur","pointerenter","pointerleave","beforeunload","stop","start","finish","bounce","beforeprint","afterprint","propertychange","filterchange","readystatechange","losecapture","dragenter","dragexit","draggesture","dragover","CheckboxStateChange","RadioStateChange","close","command","contextmenu","overflow","overflowchanged","popuphidden","popuphiding","popupshowing","popupshown","broadcast","commandupdate"];function eventHandler(e){let t=e.currentTarget.events[e.type];for(let n in t)t[n].call(e.currentTarget,e)}let helper={isEvent(e){let t={type:e,interfaceName:null};for(let n in EVENTTYPES)if(-1!==EVENTTYPES[n].indexOf(e)){t.interfaceName=n;break}return t},trigger(e,t,n){let o=this.isEvent(t);if(o.interfaceName){let n=document.createEvent(o.interfaceName);switch(o.interfaceName){case"MouseEvent":n.initMouseEvent(t,!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null);break;case"HTMLEvents":n.initEvent(t,!0,!1,window);break;case"UIEvents":n.initUIEvents(t,!0,!1,window,null);break;case"MutationEvent ":n.initMutationEvent(t,!0,!1,window,null,null,null,null)}e.dispatchEvent(n)}else{let o=document.createEvent("CustomEvent");o.initCustomEvent(t,!0,!0,n),e.dispatchEvent(o)}return e},canBubbleUp:e=>-1===UNBUBBLINGEVENT.indexOf(e),bind:(e,t,n,o=!1)=>(e.events||(e.events={}),e.events[t]?e.events[t].push(n):(e.events[t]=[],e.events[t].push(n)),e.addEventListener(t,eventHandler,o),e),unbind(e,t,n){if(e.events)if(t&&""!==t){let o=e.events[t];if(o)if(e.removeEventListener(t,eventHandler,!1),n){-1!==o.indexOf(n)&&o.splice(o.indexOf(n),1)}else o.length=0}else{e.events;Reflect.ownKeys(e.events).forEach(t=>{e.removeEventListener(t,eventHandler,!1),e.events[t].length=0})}return e}};module.exports=helper;},function(module,exports,require){"use strict";let serverUtil=require(17),browserUtil=require(18),{isBrowser:isBrowser}=require(7);module.exports=isBrowser()?browserUtil:serverUtil;},function(module,exports,require){module.exports={}},function(module,exports,require){"use strict";let{isBrowser:isBrowser}=require(7),util={isServer:!1,setSourcePaths(e){},isRegularTag(e){if(isBrowser()){let r=window.document.createElement(e);return r instanceof window.HTMLElement||r instanceof window.SVGElement}return!0}};module.exports=util;},function(module,exports,require){"use strict";let Tag=require(24),DDMVariables=require(25);class BaseContext{constructor(){this._tags=new Tag,this._ddm=new DDMVariables,this._config={root:"",basePath:"",parameter:{},sourceMap:{}},this._loader=null,this._onsnapshoot=null,this._snapshootalways=null,this._hooks={initdone:[],bootdone:[],recoverdone:[],sourceexcute:[],sourceready:[],sourcepersistence:[]},this._bootFlow=Promise.resolve(),this._steps=[]}_invokeHook(s,o){let e=this._hooks[s];if(e)return e.reduce((s,e)=>s.then(s=>new Promise(t=>{e(o,s=>t(s),s)})),Promise.resolve(o))}_invokeSyncHook(s,o){let e=this._hooks[s];if(e)return e.reduce((s,e)=>e(o,s),o)}hook(s,o){let e=this._hooks[s];e&&-1===e.indexOf(o)&&e.push(o)}unhook(s,o){let e=this._hooks[s],t=e.indexOf(o);-1!==t&&e.splice(t,1)}get loader(){return this._loader}get config(){return this._config}set config(s){Object.assign(this._config,s)}get tags(){return this._tags}get ddm(){return this._ddm}get window(){}get document(){}set onsnapshoot(s){this._onsnapshoot=s}get isBrowser(){return!0}snapshot(){this._snapshootalways&&this._snapshootalways(),this._onsnapshoot&&this._onsnapshoot()}}module.exports=BaseContext;},function(module,exports,require){"use strict";let{getMappedPath:getMappedPath,isFunction:isFunction,setProp:setProp}=require(7),{MODULEPATH:MODULEPATH}=require(12);class EmptyPersistence{constructor(e){this.context=e}getAll(){return Promise.resolve({}).then(e=>(this.context._invokeHook("sourceready",e),e))}saveAll(e){return this.context._invokeHook("sourcepersistence",e),Promise.resolve()}clean(){return Promise.resolve()}}class StoragePersistence{constructor(e){this.context=e}getAll(){let e={};try{e=this.context.window.localStorage.getItem("ada-local-source")}catch(e){}return this.context._invokeHook("sourceready",e),Promise.resolve(e)}saveAll(e){try{this.context._invokeHook("sourcepersistence",e),this.context.window.localStorage.setItem("ada-local-source",JSON.stringify(e))}catch(e){}return Promise.resolve()}clean(){try{this.context.window.localStorage.removeItem("ada-local-source")}catch(e){}return Promise.resolve()}}class DatabasePersistence{constructor(e){this.context=e,this.db=null,this.info={name:"ada",version:1,store:"ada-local-source",key:"name",value:"local"}}ready(){return this.db?Promise.resolve():(this.context.window.indexedDB||(this.context.window.indexedDB=this.context.window.mozIndexedDB||this.context.window.webkitIndexedDB),new Promise(e=>{let t=this.context.window.indexedDB.open(this.info.name,this.info.version);t.onupgradeneeded=(()=>{let e=t.result;e.objectStoreNames.contains(this.info.store)&&e.deleteObjectStore(this.info.store),e.createObjectStore(this.info.store,{keyPath:this.info.key}).put({name:this.info.value,data:{}})}),t.onsuccess=(()=>{this.db=t.result,e()}),t.onerror=(()=>{e()})}))}getAll(){return new Promise(e=>{this.ready().then(()=>{let t=this.db.transaction([this.info.store],"readwrite");t.onerror=function(t){e({})};let s=t.objectStore(this.info.store).get(this.info.value);s.onerror=(()=>{e({})}),s.onsuccess=(()=>{e(s.result?s.result.data:{})})})}).then(e=>(this.context._invokeHook("sourceready",e),e))}saveAll(e){return new Promise(t=>{this.ready().then(()=>{let s=this.db.transaction([this.info.store],"readwrite");s.oncomplete=(()=>{t()}),s.onerror=(()=>{t()}),this.context._invokeHook("sourcepersistence",e),s.objectStore(this.info.store).put({name:this.info.value,data:e})})})}clean(){return new Promise(e=>{this.ready().then(()=>{let t=this.db.transaction([this.info.store],"readwrite");t.oncomplete=(()=>{e()}),t.onerror=(()=>{e()}),t.objectStore(this.info.store).delete(this.info.value)})})}}class ModuleLoader{constructor(e,t){this.installed={},this.moduleFnsLoaded={},this._loader=t,this._context=e}getExcutor(e,t){let s=e.split("/").pop().split(".").pop(),o=t,r={path:e,code:o="js"===s?t:"css"===s||"scss"===s||"less"===s?`var styles={_linkElement:null,active:function(){var et=document.getElementById("${e}");if(!et){var _a = document.createElement("style");_a.setAttribute("media", "screen");_a.setAttribute("type", "text/css");_a.setAttribute("id","${e.replace(/\//g,"-")}");_a.appendChild(document.createTextNode(${JSON.stringify(t)}));styles._linkElement=_a;document.getElementsByTagName("head")[0].appendChild(_a);}else{et.innerText="";et.appendChild(document.createTextNode(${JSON.stringify(t)}));}}};if (/complete|loaded|interactive/.test(window.document.readyState)) {styles.active();} else {window.document.addEventListener('DOMContentLoaded', function () {styles.active();}, false);}module.exports={isReady:function(){return styles._linkElement!==null;},getElement:function(){return styles._linkElement;},remove:function(){if(styles._linkElement){styles._linkElement.parentNode.removeChild(styles._linkElement);}}};`:"json"===s?`module.exports=${t}`:"html"===s||"text"===s?`module.exports=JSON.stringify(${t})`:t};return this._context._invokeSyncHook("sourceexcute",r),new Function("module","exports","require","imports","babelHelpers","window","document",r.code)}getModuleDependenceInfo(e,t){let s=[];return{code:t=t.replace(/require\(.*?\)/g,e=>{let t=e.substring(8,e.length-1).replace(/['|"|`]/g,"").trim();return s.push(t),`require("${t}")`}),paths:s}}getModuleDependenceMap(e){return this._loader.get(e).then(t=>{let{paths:s,code:o}=this.getModuleDependenceInfo(e,t),r={[e]:o},i=[];return s.map(e=>{this.installed[e]||i.push(this.getModuleDependenceMap(e))}),Promise.all(i).then(e=>(Object.assign(r,...e),r))})}excute(e){if(this.installed[e])return this.installed[e].exports;let t=this.installed[e]={path:e,exports:{}};return this.moduleFnsLoaded[e].call(t.exports,t,t.exports,e=>this.excute(e),e=>this.load(e).then(e=>e.__esModule?e.default:e).then(t=>(isFunction(t)&&setProp(t,MODULEPATH,e),t)),this._loader._context.window.babelHelpers||{},this._loader._context.window,this._loader._context.document),t.exports}load(e){let t=this.installed[e];return t?Promise.resolve(t.exports):this.getModuleDependenceMap(e).then(t=>{for(let e in t)this.moduleFnsLoaded[e]=this.getExcutor(e,t[e]);return this.excute(e)})}excuteScript(e){return this.load(e)}scan(e){if(e)for(let t in this.installed){if(!1===e(t,this.installed[t].exports))break}}scanClass(e){if(e)for(let t in this.installed){let s=this.installed[t];if(!s.exports.__esModule&&isFunction(s.exports)&&!1===e(t,s.exports))break;for(let o in s.exports){let r=s.exports[o];if(isFunction(r)&&!1===e(t,r))break}}}filter(e){let t=[];if(e)for(let s in this.installed){let o=this.installed[s],r=e(s,o.exports.__esModule?o.exports.default:o.exports);void 0!==r&&t.push(r)}return t}get(e){let t=this.installed[e];return t?t.exports.__esModule?t.exports.default:t.exports:null}has(e){return void 0!==this.installed[e]}set(e,t){return this.installed[e]={exports:t},this}}class SourceQueue{constructor(e){this.tasks=[],this.isRunning=!1,this._loader=e}add(e,t,s){this.tasks.push({path:e,fn:t,error:s}),this.run()}run(){if(!this.isRunning){let e=this.tasks.shift();e&&(this.isRunning=!0,this._loader.getSource(e.path).then(t=>{this.isRunning=!1,e.fn(t),this.run()},t=>{this.isRunning=!1,e.error(t),this.run()}))}}}class ActiveSource{constructor(e){this.cache=[],this._loader=e}excute(e){return this.cache[e]?Promise.resolve(this.cache[e]):this._loader.get(e).then(t=>(this.cache[e]=t,t))}has(e){return void 0!==this.cache[e]}}class Loader{constructor(e){this._moduleLoader=new ModuleLoader(e,this),this._sourceQueue=new SourceQueue(this),this._activeSource=new ActiveSource(this),this._source={},this._context=e,this._isinit=!1;let t=null;t=e.window.indexedDB||e.window.mozIndexedDB||e.window.webkitIndexedDB?new DatabasePersistence(e):e.window.localStorage?new StoragePersistence(e):new EmptyPersistence(e),this.persistence=t}get source(){return this._source}get moduleLoader(){return this._moduleLoader}get sourceQueue(){return this._sourceQueue}get activeSource(){return this._activeSource}get context(){return this._context}ready(){return this._isinit?Promise.resolve():this.persistence.getAll().then(e=>(this._isinit=!0,this._source=Object.assign({},e,this.source),this.persistence.saveAll(this.source)))}get(e){return new Promise((t,s)=>{this.sourceQueue.add(e,e=>{t(e)},e=>{s(e)})})}getSourceCode(e){return this.context.request.origin({url:e,method:"get"}).promise.then(e=>e.data)}getRealPath(e,t=!1){let s=e,o="",r=this.context.config;if(o=t?r.sourceMap[e.split(".").shift()]:r.sourceMap[getMappedPath(e)],r.develop)s=`${e}?h=${(new Date).getTime()}`;else{let t=e.split("/"),r=t.pop().split(".");t.push(`${o}.${r[1]}`),s=t.join("/")}return`${"/"===r.basePath[r.basePath.length-1]?r.basePath:r.basePath+"/"}${s}`}getSourceByHash(e,t,s){let o=0,r=this.context.config,i=Reflect.ownKeys(r.sourceMap.packages).filter(e=>-1!==r.sourceMap.packages[e].indexOf(s))[0];return i?(r.sourceMap.packages[i].split("|").forEach(e=>{let t=Reflect.ownKeys(r.sourceMap).filter(t=>r.sourceMap[t]===e)[0];this.source[t]&&this.source[t].hash===e||(o+=1)}),o>1?this.getSourceCode(`${this.getRealPath(i+".js",!0)}`).then(e=>{let s=JSON.parse(e.substring(11,e.length-1));return Object.assign(this.source,s),this.persistence.saveAll(this.source).then(()=>this.source[t].code)}):this.getSourceCode(`${this.getRealPath(e)}`).then(e=>(this.source[t]={code:e,hash:s},this.persistence.saveAll(this.source).then(()=>e)))):s?this.getSourceCode(`${this.getRealPath(e)}`).then(e=>(this.source[t]={code:e,hash:s},this.persistence.saveAll(this.source).then(()=>e))):this.getSourceCode(`${this.getRealPath(e)}`)}getSource(e){return this.ready().then(()=>{let t=getMappedPath(e),s=this.context.config;if(this.source[t]){let o=this.source[t].hash,r=s.sourceMap[t];return o&&r?r===o?this.source[t].code:this.getSourceByHash(e,t,r):this.getSourceCode(`${this.getRealPath(e)}`)}return s.sourceMap?this.getSourceByHash(e,t,s.sourceMap[t]):this.getSourceCode(`${this.getRealPath(e)}`)})}loadModule(e){return this.moduleLoader.excuteScript(e).then(e=>{if(!0===e.__esModule)return e.default})}loadSource(e){return this.activeSource.excute(e)}decompress(e={}){this.source||(this.source={}),Object.assign(this.source,e)}}module.exports=Loader;},function(module,exports,require){"use strict";let BaseLogger=require(26);class BrowserLogger extends BaseLogger{log(...o){this.isOn()&&console.log(...o)}error(...o){this.isOn()&&console.error(...o)}warn(...o){console.warn(...o)}info(...o){console.info(...o)}group(o){this.isOn()&&console.group(o)}groupEnd(){this.isOn()&&console.groupEnd()}}module.exports=BrowserLogger;},function(module,exports,require){"use strict";let{postData:postData,queryString:queryString}=require(7),util={parseHeaders(e){let t={};return e.split("\n").forEach(e=>{let s=e.split(":");s[0]&&(t[s[0]]=s[1])}),t}};const CONTENTYPE={json:"application/json",uri:"application/x-www-form-urlencoded"};module.exports=function(e,t){let s=null,r=null;return{promise:new Promise((e,o)=>{s=o,r=new XMLHttpRequest,t.mimeType&&r.overrideMimeType(t.mimeType);let n=t.url,a=t.data;if(!t.body)if("get"===t.method){let e=queryString(t.data);n+=-1!==n.indexOf("?")?""===e?"":"&"+e:""===e?"":"?"+e}else a=postData(a,"uri"===t.contentType);r.open(t.method,n),r.responseType=t.responseType,r.timeout=t.timeout,null!==t.credentials&&(r.withCredentials=t.credentials),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),Reflect.ownKeys(t.headers).forEach(e=>{r.setRequestHeader(e,t.headers[e])}),"get"!==t.method&&!1!==t.contentType&&r.setRequestHeader("Content-Type",CONTENTYPE[t.contentType]||t.contentType),r.addEventListener("readystatechange",s=>{if(4===r.readyState){let n=r.status,a="getAllResponseHeaders"in r?r.getAllResponseHeaders():null;if(n>=200&&n<300||304===n||0===n){let s=t.responseType&&"text"!==t.responseType?r.response:r.responseText,o=r.statusText||"";e({status:n,statusText:o,data:s,headers:util.parseHeaders(a),option:t})}else r=null,o({status:n,headers:util.parseHeaders(a),option:t,error:s})}}),r.addEventListener("onabort",e=>o({status:r.status,option:t,error:e})),r.addEventListener("onerror",e=>o({status:r.status,option:t,error:e})),r.addEventListener("ontimeout",e=>o({status:r.status,option:t,error:e})),t.ondownloadprogress&&r.addEventListener("progress",t.ondownloadprogress),t.onuploadprogress&&r.upload.addEventListener("progress",t.onuploadprogress),r.send(t.body?t.body:a)}),cancel:()=>{r&&(r.abort(),r=null,s("[ada] request abort"))}}};},function(module,exports,require){"use strict";let{randomid:randomid}=require(7);class RequestMananger{constructor(e,r){this._context=e,this._worker=r,this._requestTransformer=[],this._responseTransformer=[],this._responseDataFilter=[],this.addResponseDataFilter(e=>{if("["===e[0]||"{"===e[0])try{e=JSON.parse(e)}catch(e){}return e})}static getOption(e){return Object.assign({url:"",id:randomid(),method:"post",responseType:"text",timeout:3e6,headers:{},events:{},mimeType:"",data:{},body:"",credentials:null,contentType:"json",ondownloadprogress:null,onuploadprogress:null},e)}addRequestTransformer(e){-1===this._requestTransformer.indexOf(e)&&this._requestTransformer.push(e)}addResponseTransformer(e){-1===this._responseTransformer.indexOf(e)&&this._responseTransformer.push(e)}removeRequestTransformer(e){let r=this._requestTransformer.indexOf(e);-1!==r&&this._requestTransformer.splice(r,1)}removeResponseTransformer(e){let r=this._responseTransformer.indexOf(e);-1!==r&&this._responseTransformer.splice(r,1)}addResponseDataFilter(e){-1===this._responseDataFilter.indexOf(e)&&this._responseDataFilter.push(e)}removeResponseDataFilter(e){let r=this._responseDataFilter.indexOf(e);-1!==r&&this._responseDataFilter.splice(r,1)}cleanResponseDataFilter(){this._responseDataFilter=[]}cleanRequestTransformer(){this._requestTransformer=[]}cleanResponseTransformer(){this._responseTransformer=[]}fetch(e){return this.invoke(e)}origin(e){return this._worker(this._context,RequestMananger.getOption(e))}invoke(e){return Promise.resolve().then(()=>this._requestTransformer.reduce((e,r)=>e.then(e=>Promise.resolve().then(()=>r(e))),Promise.resolve(RequestMananger.getOption(e)))).then(e=>{let{promise:r}=this._worker(this._context,e);return r.then(e=>this._responseTransformer.reduce((e,r)=>e.then(e=>Promise.resolve().then(()=>r(e))),Promise.resolve(e)),e=>this._responseTransformer.reduce((e,r)=>e.then(e=>Promise.resolve().then(()=>r(e))),Promise.resolve(e))).then(e=>this._responseDataFilter.reduce((e,r)=>r(e),e.data))})}get(e,r={}){return this.fetch(Object.assign({url:e,data:r},{method:"get"}))}post(e,r={}){return this.fetch(Object.assign({url:e,data:r},{method:"post"}))}put(e,r={}){return this.fetch(Object.assign({url:e,data:r},{method:"put"}))}patch(e,r={}){return this.fetch(Object.assign({url:e,data:r},{method:"patch"}))}head(e,r={}){return this.fetch(Object.assign({url:e,data:r},{method:"head"}))}options(e,r={}){return this.fetch(Object.assign({url:e,data:r},{method:"options"}))}upload(e,r={},s=null){return this.origin(Object.assign({url:e,data:r,contentType:!1,onuploadprogress:s},{method:"post"}))}}module.exports=RequestMananger;},function(module,exports,require){"use strict";let{isFunction:isFunction}=require(7),{isRegularTag:isRegularTag}=require(16);class Tag{constructor(){this.regularTags=[],this.selfCloseTags=["br","hr","img","input","param","link","meta","area","base","basefont","param","col","frame","embed","keygen","source"],this.tags={icon:{template:({attrs:s,props:e})=>`<svg class="${s.class||"ada-icon"}"><use xlink:href="#${e.id}"></use></svg>`,selfClose:!0}}}get(s){return this.tags[s]}set(s,e){this.tags[s]=e,isFunction(e)||e.selfClose&&this.selfCloseTags.push(s)}has(s){return void 0!==this.get(s)}remove(s){Reflect.ownKeys(this.tags).filter(e=>this.tags[e]===s).forEach(s=>delete this.tags[s])}isRegularTag(s){let e=!0;return-1===this.regularTags.indexOf(s)&&(isRegularTag(s)?this.regularTags.push(s):e=!1),e}}module.exports=Tag;},function(module,exports,require){"use strict";let{Parser:Parser}=require(11);class DDMVariables{constructor(){this._defaultMacros={self:({props:t,context:e})=>({template:e.getTemplateStr(),data:t.parameter}),custom({bodyStr:t,props:e,events:s,attrs:a,option:n,env:r}){let i="",u=e.customTagName,o=n&&n.tags?n.tags[u]:null;if(o||(o=r.tags.get(u)),!o.template)throw Error(`[ada] tag [${u}] can not defined with function of generate template`);return{template:i=o.template({bodyStr:t,props:e,events:s,attrs:a,option:n,generateOption:o.option}),data:e}}},this._defaultAssignDirectives={html:t=>t},this._defaultFunctionNames=["classname"],this._defaultFunctionFns=[(t,e)=>{if(Array.isArray(e)){let s=[e.shift()];return e.forEach(e=>{!0===t[e]&&s.push(e)}),s.join(" ")}{let s=[];return e.def&&s.push(e.def),Reflect.ownKeys(e).forEach(e=>{!0===t[e]&&s.push(e)}),s.join(" ")}}]}get defaultMacros(){return this._defaultMacros}get defaultAssignDirectives(){return this._defaultAssignDirectives}get defaultFunctionNames(){return this._defaultFunctionNames}get defaultFunctionFns(){return this._defaultFunctionFns}setDefaultMacro(t,e){return this._defaultMacros[t]=e,null}setDefaultAssignDirective(t,e){return this._defaultAssignDirectives[t]=e,function(t){Parser.beautySyntax.syntaxs[t]=function(e){return`<%=assign(${t},${e.filter(t=>!!t).join(",")});%>`}}(t),null}setDefaultFunctions(t,e){let s=this._defaultFunctionNames.indexOf(t);-1===s?(this._defaultFunctionNames.push(t),this._defaultFunctionFns.push(e)):this._defaultFunctionFns[s]=e}}module.exports=DDMVariables;},function(module,exports,require){"use strict";class BaseLogger{constructor(o){this._context=o,this._on="on"===o.window.localStorage["ada-logger-on"]}get on(){return this._on}set on(o){this._on=o,this._context.window.localStorage["ada-logger-on"]=o?"on":"off"}log(){}error(){}warn(){}info(){}isOn(){return!0===this._on}group(){}groupEnd(){}}module.exports=BaseLogger;},function(module,exports,require){"use strict";let{BondViewGroup:BondViewGroup,StaticViewGroup:StaticViewGroup,View:View,ViewConnector:ViewConnector,ViewGroup:ViewGroup}=require(1),{DataSet:DataSet,Service:Service,TransactDataSet:TransactDataSet}=require(2),factory=require(3),{Dispatcher:Dispatcher}=require(4),Passable=require(5),{view:view,root:root,action:action,handler:handler,subscribe:subscribe,compute:compute,binder:binder}=require(6),{clone:clone,encodeHTML:encodeHTML,excuteStyle:excuteStyle,extend:extend,hashCode:hashCode,isArray:isArray,isEqual:isEqual,isFunction:isFunction,isObject:isObject,isPlainObject:isPlainObject,isQueryString:isQueryString,isString:isString,randomid:randomid,isBrowser:isBrowser}=require(7),BrowserContext=require(8),env=require(9);if(isBrowser()){let e=new BrowserContext;e.window.Ada={modules:e.loader.moduleLoader,init(r){factory.init(e,r)},boot:function(r){r.context=e,factory.boot(r)},unpack(r){e.loader.decompress(r)},installModule(r,i){e.loader.moduleLoader.set(r,i)},recover(r){factory.recover(e,r)}},Dispatcher.request=e.request}module.exports={View:View,ViewGroup:ViewGroup,StaticViewGroup:StaticViewGroup,BondViewGroup:BondViewGroup,ViewConnector:ViewConnector,Service:Service,DataSet:DataSet,TransactDataSet:TransactDataSet,Dispatcher:Dispatcher,Passable:Passable,util:{randomid:randomid,hashCode:hashCode,isString:isString,isFunction:isFunction,isEqual:isEqual,isObject:isObject,isPlainObject:isPlainObject,isArray:isArray,isQueryString:isQueryString,excuteStyle:excuteStyle,encodeHTML:encodeHTML,extend:extend,clone:clone},view:view,root:root,action:action,handler:handler,subscribe:subscribe,compute:compute,binder:binder,env:env};}],"adajs");