{"version":3,"sources":["/site/content/index.js"],"names":["Content","className","template","style","dataset","service","ContentService","StaticViewGroup","oncreated","window","document","body","scrollTop","getElement","minHeight","innerHeight","onready","data","getCurrentState","addChild","Loading","name","container","finder","PageMenu","parameter","menu","title","desc","close","loading","content","commit","then","isRemoved","h2s","querySelectorAll","forEach","element","push","innerText","id","getAttribute","subs","a","tagName","toLowerCase","previousSibling","some","info","removeChildByName","context","isBrowser","prism","highlightAllUnder","autoLoadModule","snapshot","tags","pagemenu","oncommited","getChildByName","update","commentId","_at","Comment","reduce","type","option","JSON","parse","_import","module","Promise","resolve","openReply","Connector","closeReply","commentDone","onrecover"],"mappings":"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","sourcesContent":["import {handler, StaticViewGroup, view} from \"adajs\";\nimport ContentService from \"./state.js\";\nimport PageMenu from \"./../pagemenu\";\nimport Loading from \"./../loading\";\nimport prism from \"./../../lib/prism\";\nimport Comment from \"./../comment\";\nimport Connector from \"./../connector\";\nimport \"./../../lib/prism.css\";\n\n@view({\n    className: \"content\",\n    template: \"./template.html\",\n    style: \"./style.scss\",\n    dataset: {\n        service: ContentService\n    }\n})\nclass Content extends StaticViewGroup {\n    oncreated() {\n        window.document.body.scrollTop = 0;\n        this.getElement().style.minHeight = window.innerHeight + \"px\";\n    }\n\n    onready() {\n        let data = this.getCurrentState();\n        this.addChild(Loading, {\n            name: \"loading\",\n            container: this.finder(\"page\").getElement()\n        });\n        this.addChild(PageMenu, {\n            name: \"menu\",\n            parameter: {\n                menu: data.menu,\n                title: data.title,\n                desc: data.desc,\n                close: data.close,\n                loading: !data.content\n            },\n            container: this.finder(\"head\").getElement()\n        });\n        this.commit(\"getpage\").then(() => {\n            if (!this.isRemoved()) {\n                let h2s = [];\n                [...this.getElement().querySelectorAll(\"h2\")].forEach(element => {\n                    h2s.push({title: element.innerText, id: element.getAttribute(\"id\"), subs: []});\n                });\n                [...this.getElement().querySelectorAll(\"h3\")].forEach(element => {\n                    let a = element;\n                    while (a) {\n                        if (a.tagName && a.tagName.toLowerCase() === \"h2\") {\n                            break;\n                        } else {\n                            a = a.previousSibling;\n                        }\n                    }\n                    if (a && a.tagName && a.tagName.toLowerCase() === \"h2\") {\n                        h2s.some(info => {\n                            if (info.element === a) {\n                                info.subs.push({\n                                    title: element.innerText,\n                                    id: element.getAttribute(\"id\")\n                                });\n                                return true;\n                            }\n                        });\n                    }\n                });\n                if (this.getCurrentState().content) {\n                    this.removeChildByName(\"loading\");\n                }\n                this.commit(\"setmenu\", h2s).then(() => {\n                    if (this.context.isBrowser) {\n                        prism.highlightAllUnder(this.getElement());\n                    }\n                    this.autoLoadModule().then(() => {\n                        this.context.snapshot();\n                    });\n                });\n            }\n        });\n    }\n\n    tags() {\n        return {\n            pagemenu: PageMenu,\n            loading: Loading\n        }\n    }\n\n    oncommited() {\n        let menu = this.getChildByName(\"menu\");\n        if (menu) {\n            let data = this.getCurrentState();\n            menu.update({\n                menu: data.menu,\n                title: data.title,\n                desc: data.desc,\n                close: data.close,\n                loading: !data.content\n            });\n        }\n        if (this.getCurrentState().commentId && !this._at) {\n            this._at = true;\n            this.addChild(Comment, {\n                name: \"comment\",\n                parameter: {\n                    commentId: this.getCurrentState().commentId\n                },\n                container: this.finder(\"comment\").getElement()\n            });\n        }\n    }\n\n    autoLoadModule() {\n        return [...this.getElement().querySelectorAll(\".ada-module\")].reduce((a, element) => {\n            return a.then(() => {\n                let type = element.dataset.type,\n                    option = element.dataset.option ? JSON.parse(element.dataset.option) : {};\n                return _import(type).then(module => {\n                    return this.addChild(module, {\n                        parameter: option,\n                        container: element\n                    });\n                });\n            });\n        }, Promise.resolve());\n    }\n\n    @handler(\"openreply\")\n    openReply() {\n        this.addChild(Connector, {\n            name: \"reply\",\n            parameter: {\n                commentId: this.getCurrentState().commentId\n            }\n        });\n    }\n\n    @handler(\"closereply\")\n    closeReply() {\n        this.removeChildByName(\"reply\");\n    }\n\n    @handler(\"commentdone\")\n    commentDone() {\n        this.getChildByName(\"comment\").commit(\"get\");\n    }\n\n    onrecover() {\n        prism.highlightAllUnder(this.getElement());\n    }\n}\n\nexport default Content;\n"]}