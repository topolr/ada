/*! adajs 3.0.0-beta.25 https://github.com/topolr/ada | https://github.com/topolr/ada/blob/master/LICENSE */(function (map,moduleName) {var Installed={};var requireModule = function (index) {if (Installed[index]) {return Installed[index].exports;}var module = Installed[index] = {exports: {}};map[index].call(module.exports, module, module.exports, requireModule);return module.exports;};var mod=requireModule(map.length-1);Ada.installModule(moduleName,mod);})([function(module,exports,require){module.exports={}},function(module,exports,require){"use strict";let Metadata=require(10),{DDM:DDM,MapDom:MapDom}=require(11),{getDataSetFromParent:getDataSetFromParent,isFunction:isFunction,isSubModuleChange:isSubModuleChange,protectData:protectData,randomid:randomid,setProp:setProp}=require(7),{BINDERS:BINDERS,CHANGEPROPS:CHANGEPROPS,CHILDRENTAG:CHILDRENTAG,CLASSNAME:CLASSNAME,CONNECTS:CONNECTS,CONNECTSTATE:CONNECTSTATE,DATASET:DATASET,DDMCONTAINER:DDMCONTAINER,DDMTAG:DDMTAG,ELEMENTTAG:ELEMENTTAG,HANDLERS:HANDLERS,IDNAME:IDNAME,ISREMOVED:ISREMOVED,OUTERVIEW:OUTERVIEW,PARENTVIEWTAG:PARENTVIEWTAG,PREREMOVED:PREREMOVED,SUBSCRIBE:SUBSCRIBE,USEPROPS:USEPROPS,VIEWINFO:VIEWINFO,VIEWNAME:VIEWNAME,MODULEPATH:MODULEPATH,VIEWTAG:VIEWTAG,CONTEXT:CONTEXT}=require(12),factory=require(3),{DataSet:DataSet,DataSetHelper:DataSetHelper}=require(2),Collector=require(13);const macros={module({bodyStr:e,props:t,events:s,attrs:r}){let i=['data-module=""'];return Reflect.ownKeys(r).forEach(e=>i.push(`${e}="${e}"`)),{template:`<div ${i.join(" ")}>${e}</div>`,data:t}}},tags={module:{template({bodyStr:e,props:t,events:s,attrs:r}){let i=['data-module=""'];return Reflect.ownKeys(r).forEach(e=>i.push(`${e}="${e}"`)),`<div ${i.join(" ")}>${e}</div>`},selfClose:!1}};function addChild(e=null,{name:t="",parameter:s={},container:r=null,attrs:i={}}={},n,o=!1){if(!n.isRemoved()){r?r instanceof MapDom&&(r=r.getElement()):r=n.context.document.body;let a=n.context.document.createElement("div");if(a.setAttribute("data-module",`out:${n.getId()}`),Reflect.ownKeys(i).forEach(e=>a.setAttribute(e,i[e])),o&&n.getDDMContainer().contains(r))throw Error("[ada] BondViewGroup can not append child in the DDM container element");return r.appendChild(a),factory.getViewInstance({viewClass:e,parent:n,name:t,dom:a,useProps:[],context:n.context}).then(e=>{if(!e.isRemoved())return setProp(e,OUTERVIEW,!0),Promise.resolve().then(()=>e.oncreated()).then(()=>e.update(s).then(()=>{n.getChildren().push(e)}).then(()=>n.onchildadded(e)).then(()=>e.onready()).then(()=>e))})}}class ViewEvent{constructor(e,t,s){this.target=e,this.data=s,this.type=t,this._goon=!0,this.currentTarget=null}stopPropagation(){this._goon=!1}}class ClassNames{static getClassName(e,t){return e?`${e}-${t}`:t}constructor(e){this._view=e,this._className=e.getAnnotationInfo().className||""}add(e){return this._view.getElement().classList.add(ClassNames.getClassName(this._className,e)),this}remove(e){return this._view.getElement().classList.remove(ClassNames.getClassName(this._className,e)),this}has(e){return this._view.getElement().classList.contains(ClassNames.getClassName(this._className,e))}toggle(e){return this._view.getElement().classList.toggle(ClassNames.getClassName(this._className,e)),this}}class BaseView{constructor({parent:e=null,dom:t=null,info:s={},name:r="",useProps:i=[],context:n=null,id:o}){t||(t=n.document.body),setProp(this,CONTEXT,n),setProp(this,IDNAME,o||randomid(10)),setProp(this,PARENTVIEWTAG,e),setProp(this,ELEMENTTAG,t),setProp(this,ISREMOVED,!1),setProp(this,PREREMOVED,!1),setProp(this,VIEWINFO,s),setProp(this,VIEWNAME,r),setProp(this,USEPROPS,i),s.className&&setProp(this,CLASSNAME,s.className),setProp(this,DDMTAG,new DDM({id:this.getId(),container:this.getDDMContainer(),templateStr:s.template||"",binders:({method:e,parameters:t})=>{let s=(this[BINDERS]||{})[e];s&&this[s]&&this[s](t)},option:{tags:this._getTags()},macro:this._macros(),precise:this[VIEWINFO].precise,className:s.className||"",context:n})),this.className=new ClassNames(this),this.getElement().setAttribute("data-module-id",this[IDNAME])}get context(){return this[CONTEXT]}oncreated(){}onready(){}onupdated(){}onunload(){}onrecover(){}getId(){return this[IDNAME]}getName(){return this[VIEWNAME]}getElement(){return this[ELEMENTTAG]}getParent(){return this[PARENTVIEWTAG]}getAnnotationInfo(){return this[VIEWINFO]}getDDMContainer(){return this[ELEMENTTAG]}isRemoved(){return!0===this[ISREMOVED]}isOuterView(){return!0===this[OUTERVIEW]}finder(e){return this.isRemoved()?[]:this.getDDM().finder(e)}finders(e){return this.isRemoved()?[]:this.getDDM().finders(e)}group(e){return this.isRemoved()?null:this.getDDM().group(e)}groups(e){return this.isRemoved()?[]:this.getDDM().groups(e)}getElementClassName(e=""){if(this.isRemoved())return null;{let t=this[CLASSNAME];return t?e?`${t}-${e}`:t:e}}tags(){return{}}macros(){return{}}getDDM(){return this[DDMTAG]}getDataSet(){return null}isRendered(){return this.getDDM().isRendered()}getClassName(){let e="";if(e=this[VIEWINFO].module?this[VIEWINFO].module:this.constructor[MODULEPATH]){let t=e.split(".");return t.pop(),t.join(".").replace(/\//g,".")+"."+this.constructor.name}return this.constructor.name}getCurrentState(){return{}}getSnapshot(){return{}}dispatchEvent(e,t){if(!this.isRemoved()){let s=new ViewEvent(this,e,t),r=this;for(;r&&(r._triggerEvent(s),s._goon);)r=r.getParent()}}rerender(){}_triggerEvent(e){if(!this.isRemoved()){e.currentTarget=this;let t=this[HANDLERS];t&&t[e.type]&&this[t[e.type]](e)}}_getParentUseProps(){return this[USEPROPS]}_getChangedProps(){return[]}_getUsedProps(){return this.getDDM().getUseProps()}_getTags(){let e=this.tags(),t={};return Reflect.ownKeys(this.tags()).forEach(s=>{let r=e[s];isFunction(r)?t[s]={option:{type:r},template({bodyStr:e,props:t,events:s,attrs:r,generateOption:i}){let n=['data-module=""'];return t.type=i.type,Reflect.ownKeys(r).forEach(e=>n.push(`${e}="${e}"`)),`<div ${n.join(" ")}>${e}</div>`},selfClose:!1}:t[s]=r}),Object.assign(t,this.context.tags.get(),this._tags())}_refresh(e=!1){return this.isRemoved()?Promise.resolve():this.getDDM().modules().reduce((t,s)=>t.then(()=>{let t=s.element()[VIEWTAG],r=s.getAttributes(),i=r.type,n=r.parameter,o=r.name||"",a=r.useProps?[...r.useProps]:[];if(!t||t.constructor!==i||t.isRemoved()||t.getName()!==o){let e=Promise.resolve();return t&&!t.isRemoved()&&(e=e.then(()=>t._remove())),e=e.then(()=>factory.getViewInstance({viewClass:i,parent:this,dom:s.element(),name:o,useProps:a,context:this.context}).then(e=>{if(!e.isRemoved())return Promise.resolve().then(()=>e.oncreated()).then(()=>e.update(n).then(()=>{if(this.onchildadded)return this.onchildadded(e)}).then(()=>e.onready()).then(()=>e))}))}return t&&r.hasOwnProperty("parameter")&&(e||isSubModuleChange(this._getChangedProps(),t._getParentUseProps()))?t.update(n).then(()=>t):Promise.resolve(void 0)}),Promise.resolve()).then(()=>{if(!this.isRemoved())return this[CHILDRENTAG]=this.getDDM().modules().map(e=>{let t=e.getAttributes(),s=e.element()[VIEWTAG];return s[USEPROPS]=t.useProps?[...t.useProps]:[],s}).concat(this[CHILDRENTAG].filter(e=>e.isOuterView())),this.onupdated()})}_macros(){return Object.assign(this.macros(),{})}_tags(){return{}}_remove(){if(!this.isRemoved()){let e=Promise.resolve(),t=this.getParent();return t&&!t.isRemoved()&&!0!==this[PREREMOVED]&&t.onchildremoved&&(e=e.then(()=>t.onchildremoved(this))),e=e.then(()=>(this.removeAllChild&&this.removeAllChild(),this.onunload())).then(()=>{this.getElementClassName()&&this.getElement().classList.remove(this.getElementClassName()),this.getElement().innerHTML="",this[DATASET]&&this[DATASET]._remove(),Reflect.deleteProperty(this.getElement(),VIEWTAG),Reflect.ownKeys(this).forEach(e=>{this[e]=null}),this[ISREMOVED]=!0})}return Promise.resolve()}_clean(){if(this[ISREMOVED]=!0,this.getParent()){let e=this.getParent().getChildren(),t=e.indexOf(this);-1!==t&&e.splice(t,1)}this.onunload&&this.onunload(),Reflect.ownKeys(this).forEach(e=>{e!==ISREMOVED&&(this[e]=null)})}}class ViewConnector extends BaseView{constructor(e){super(e),setProp(this,CHILDRENTAG,[]),setProp(this,CONNECTS,[]),setProp(this,CHANGEPROPS,[]),setProp(this,CONNECTSTATE,this.setContextDataSets((e,t,s)=>{let r={};isFunction(e)&&(e={service:e,dataset:DataSet});let i=getDataSetFromParent(this,e);return i&&(this[CONNECTS].push(i),r=i._addListener(this,t,s)),r})||{})}setContextDataSets(e){}onupdate(e,t){return e}getCurrentState(){return this[CONNECTSTATE]}update(e){return this.isRemoved()?Promise.reject("view is removed"):this._updateFromParent(protectData(e))}onchildremoved(){}onchildadded(){}getChildAt(e=0){return this.isRemoved()?null:this[CHILDRENTAG][e]}getChildrenByType(e){return!this.isRemoved()&&e?this.getChildren().filter(t=>t instanceof e):[]}getChildByName(e){return!this.isRemoved()&&e&&this.getChildren().filter(t=>t.getName()===e)[0]||null}getChildren(){return this.isRemoved()?[]:this[CHILDRENTAG]}getSnapshot(){return{state:this.getCurrentState(),id:this.getId(),name:this.getName(),connector:!0}}rerender(){return this.getElement().innerHTML="",this.getDDM().render(this.getCurrentState(),!1),this._refresh()}_updateFromParent(e){let t=new Collector({data:this.getCurrentState(),fn:this.onupdate});return this[CONNECTSTATE]=t.invoke(e,this),this[CHANGEPROPS]=t.getChangedProps(),isSubModuleChange(this._getChangedProps(),this._getUsedProps())?(this.context.logger.log(`RENDER FROM PARENT  -> [${this.getClassName()}]${this.getName()?" of ["+this.getName()+"]":""} changes [${this._getChangedProps().join(",")}]`),this._render()):this.isRendered()?Promise.resolve():(this.context.logger.log(`RENDER FROM PARENT  -> [${this.getClassName()}]${this.getName()?" of ["+this.getName()+"]":""}`),this._render())}_updateFromConnect({data:e={},setter:t}){let s=new Collector({data:this.getCurrentState(),fn:t});return this[CONNECTSTATE]=s.invoke(e,this),this[CHANGEPROPS]=s.getChangedProps(),isSubModuleChange(this._getChangedProps(),this._getUsedProps())?(this.context.logger.log(`RENDER FROM CONNECT -> [${this.getClassName()}]${this.getName()?" of ["+this.getName()+"]":""} changes [${this._getChangedProps().join(",")}]`),this._render()):Promise.resolve()}_render(){return this.getDDM().render(this.getCurrentState()),this._refresh()}_macros(){return Object.assign(this.macros(),macros)}_tags(){return tags}_remove(){return this[CONNECTS].forEach(e=>e._removeListener(this)),super._remove()}_getChangedProps(){return this[CHANGEPROPS]}}class View extends BaseView{constructor(e){super(e),setProp(this,BINDERS,Metadata.getMetadataExtends("binder",this.constructor.prototype)),setProp(this,SUBSCRIBE,Metadata.getMetadataExtends("subscribe",this.constructor.prototype)),setProp(this,HANDLERS,Metadata.getMetadataExtends("handler",this.constructor.prototype)),this[VIEWINFO].dataset&&setProp(this,DATASET,DataSetHelper.getDataSet(this[VIEWINFO].dataset,this))}onbeforecommit(){}oncommited(){}getDataSet(){return this[DATASET]}getCurrentState(){return this[DATASET]?this[DATASET].getData():{}}update(e){return this.isRemoved()?Promise.reject("view is removed"):this._updateFromParent(e)}commit(e,t){return this[DATASET]?this[DATASET].commit(e,t):null}getSnapshot(){return{state:this.getCurrentState(),id:this.getId(),name:this.getName(),useProps:this[USEPROPS],out:this.isOuterView(),module:this[VIEWINFO].module,connector:!1}}rerender(){return this.getElement().innerHTML="",this.getDDM().render(this.getCurrentState(),!1),this.context.config.develop&&this.getDDM().modules().length>0&&console.warn("[ada] view typeof View can not has any child [",this.getClassName(),"]"),Promise.resolve().then(()=>this.onupdated())}_updateFromParent(e){return this[DATASET]&&e?this.commit("update",e):this.isRendered()?Promise.resolve():(this.context.logger.log(`RENDER FROM PARENT  -> [${this.getClassName()}]${this.getName()?" of ["+this.getName()+"]":""}`),this._render())}_updateFromDataSet(){return this.isRendered()?isSubModuleChange(this._getChangedProps(),this._getUsedProps())?(this.context.logger.log(`RENDER FROM DATASET -> [${this.getClassName()}]${this.getName()?" of ["+this.getName()+"]":""} changes [${this._getChangedProps().join(",")}]`),this._render()):Promise.resolve():(this.context.logger.log(`RENDER FROM DATASET -> [${this.getClassName()}]${this.getName()?" of ["+this.getName()+"]":""}`),this._render())}_updateForceFromDataSet(){return this.context.logger.log(`RENDER FROM DATASET FORCE -> [${this.getClassName()}]${this.getName()?" of ["+this.getName()+"]":""}`),this._render(!0)}_render(e=!1){return this.getDDM().render(this.getCurrentState()),this.context.config.develop&&this.getDDM().modules().length>0&&console.warn("[ada] view typeof View can not has any child [",this.getClassName(),"]"),Promise.resolve().then(()=>this.onupdated())}_getChangedProps(){return this[DATASET]?this[DATASET].getChangedProps():[]}}class ViewGroup extends View{constructor(e={}){super(e),setProp(this,CHILDRENTAG,[])}onchildremoved(){}onchildadded(){}getChildAt(e=0){return this.isRemoved()?null:this[CHILDRENTAG][e]}getChildrenByType(e){return!this.isRemoved()&&e?this.getChildren().filter(t=>t instanceof e):[]}getChildByName(e){return!this.isRemoved()&&e&&this.getChildren().filter(t=>t.getName()===e)[0]||null}getChildren(){return this.isRemoved()?[]:this[CHILDRENTAG]}getSnapshot(){return{state:this.getCurrentState(),id:this.getId(),name:this.getName(),useProps:this[USEPROPS],out:this.isOuterView(),module:this[VIEWINFO].module,connector:!1,children:this.getChildren().map(e=>e.getSnapshot())}}tags(){return{}}rerender(){return this.getElement().innerHTML="",this.getDDM().render(this.getCurrentState(),!1),this._refresh()}_macros(){return Object.assign(this.macros(),macros)}_render(e=!1){return this.getDDM().render(this.getCurrentState()),this._refresh(e)}_tags(){return tags}}class StaticViewGroup extends ViewGroup{constructor(e={}){super(e)}addChild(e=null,{name:t="",parameter:s={},container:r=null,attrs:i={}}={}){return addChild(e,arguments[1],this,!1)}removeChild(e){if(!this.isRemoved()){let t=this.getChildren().indexOf(e);-1!==t&&(this[CHILDRENTAG].splice(t,1),e.isRemoved()||e.getElement().parentNode.removeChild(e.getElement()))}return this}removeChildAt(e=0){if(!this.isRemoved()){let t=this.getChildren()[e];t&&this.removeChild(t)}return this}removeChildByName(e){if(!this.isRemoved()&&e){let t=this.getChildByName(e);t&&this.removeChild(t)}return this}removeAllChild(){if(!this.isRemoved()){let e=this.getChildren();for(;e&&e.length>0;){let t=e.shift();t.isRemoved()||t.getElement().parentNode.removeChild(t.getElement())}}return this}removeChildByType(e){if(!this.isRemoved()&&e){let t=this.getChildrenByType(e);for(;t&&t.length>0;){let e=t.shift();e.isRemoved()||e.getElement().parentNode.removeChild(e.getElement())}}return this}_macros(){return Object.assign(this.macros(),{})}_tags(){return{}}_refresh(){return this.context.config.develop&&this.getDDM().modules().length>0&&console.warn("[ada] view typeof StaticViewGroup can not has any child defined in DDM [",this.getClassName(),"]"),Promise.resolve().then(()=>this.onupdated())}}class BondViewGroup extends ViewGroup{getDDMContainer(){if(!this[DDMCONTAINER]){let e=this.getElement().querySelector("."+this.getElementClassName("ddmcontainer"));e||((e=this.context.document.createElement("div")).setAttribute("class",this.getElementClassName("ddmcontainer")),this.getElement().appendChild(e)),setProp(this,DDMCONTAINER,e)}return this[DDMCONTAINER]}addChild(e=null,{name:t="",parameter:s={},container:r=null,attrs:i={}}={}){return addChild(e,arguments[1],this,!0)}removeChild(e){if(!this.isRemoved()){if(-1!==this.getChildren().indexOf(e)&&!e.isRemoved()){if(this.getDDMContainer().contains(e.getElement()))throw Error("[ada] BondViewGroup can not remove child in the DDM container");e.getElement().parentNode.removeChild(e.getElement())}}return this}removeAllChild(){let e=this.getChildren().filter(e=>{if(!e.isRemoved()&&!this.getDDMContainer().contains(e.getElement()))return e});for(;e&&e.length>0;){let t=e.shift();t.isRemoved()||t.getElement().parentNode.removeChild(t.getElement())}}removeChildByType(e){if(!this.isRemoved()&&e){let t=this.getChildrenByType(e);for(;t.length>0;)this.removeChild(t.shift())}return this}removeChildByName(e){if(!this.isRemoved()&&e){let t=this.getChildByName(e);t&&this.removeChild(t)}return this}}module.exports={View:View,ViewGroup:ViewGroup,StaticViewGroup:StaticViewGroup,BondViewGroup:BondViewGroup,ViewConnector:ViewConnector};},function(module,exports,require){"use strict";let Metadata=require(10),{DATASETACTION:DATASETACTION,DATASETCOMMITCOUNT:DATASETCOMMITCOUNT,DATASETCOMPUTE:DATASETCOMPUTE,DATASETDATA:DATASETDATA,DATASETEDITS:DATASETEDITS,DATASETISCOMMIT:DATASETISCOMMIT,DATASETLISTENER:DATASETLISTENER,DATASETOWNER:DATASETOWNER,DATASETRANSACTION:DATASETRANSACTION,DATASETRANSACTIONSTATE:DATASETRANSACTIONSTATE,DATASETRANSACTIONSTEP:DATASETRANSACTIONSTEP,DATASETSERVICE:DATASETSERVICE,CONTEXT:CONTEXT}=require(12),Collector=require(13),{isChanges:isChanges,protectData:protectData,setProp:setProp}=require(7);class Service{get context(){return this[CONTEXT]}get request(){return this[CONTEXT].request}defaultData(){return{}}onupdate(t,T){return t}}class DataSet{constructor(){setProp(this,DATASETOWNER,null),setProp(this,DATASETDATA,null),setProp(this,DATASETSERVICE,null),setProp(this,DATASETLISTENER,[]),setProp(this,DATASETEDITS,[]),setProp(this,DATASETISCOMMIT,null),setProp(this,DATASETCOMMITCOUNT,0)}get context(){return this[DATASETOWNER].context}commit(t,T){return this.context.logger.log(`COMMIT => [${this[DATASETOWNER].getClassName()}] ${this[DATASETOWNER].getName()?"of "+this[DATASETOWNER].getName():""} -> [${t}]`),this[DATASETCOMMITCOUNT]++,this[DATASETISCOMMIT]?this[DATASETISCOMMIT]=this[DATASETISCOMMIT].then(()=>DataSetHelper.commit(this,t,T)):this[DATASETISCOMMIT]=DataSetHelper.commit(this,t,T),this[DATASETISCOMMIT]}getData(){return this[DATASETDATA]||(this[DATASETDATA]=this[DATASETSERVICE].defaultData()),this[DATASETDATA]}getComputeData(t,T){let e=this[DATASETSERVICE][DATASETCOMPUTE][t];if(e&&this[DATASETSERVICE][e])return this[DATASETSERVICE][e](this.getData(),T);throw Error("[ada] servie")}toggleService(t){if(!(t.prototype instanceof this.defaultService()))throw Error("[ada] toggle service must be a subclass of this dataset default service class");this[DATASETSERVICE]=new t}getChangedProps(){return this[DATASETEDITS]}_addListener(t,T,e){let A={};if(-1!==this[DATASETLISTENER].findIndex(T=>T.view===t))throw Error("ViewConnector can only invoke connect once with the same DataSet filter");{let S=new Collector({data:this[DATASETDATA],fn:T,precise:10});A=S.invoke(),setTimeout(()=>{this[DATASETLISTENER].push({useprops:S.getUsedPros(),view:t,getter:T,setter:e})})}return A}_removeListener(t){let T=this[DATASETLISTENER].findIndex(T=>T.view===t);-1!==T&&this[DATASETLISTENER].splice(T,1)}_remove(){this[DATASETDATA]=null,this[DATASETOWNER]=null,this[DATASETSERVICE]=null,this[DATASETLISTENER]=[]}_setState(t){this[DATASETDATA]=t}}class TransactDataSet extends DataSet{constructor(){super(),setProp(this,DATASETRANSACTION,[]),setProp(this,DATASETRANSACTIONSTATE,[]),setProp(this,DATASETRANSACTIONSTEP,0)}commit(t,T){return this[DATASETRANSACTION].unshift({type:t,data:T}),super.commit(t,T)}getTransactionSize(){return 1/0}getCommitSize(){return this[DATASETRANSACTIONSTATE].length}getCurrentStep(){return this[DATASETRANSACTIONSTEP]}getCurrentCommit(){return this[DATASETRANSACTION][this.getCurrentStep()]}getTransactionList(){return this[DATASETRANSACTION]}rollback(t=1){return this[DATASETRANSACTIONSTATE].length>0?(this[DATASETRANSACTION].splice(0,t),this[DATASETRANSACTIONSTATE].splice(0,t),this[DATASETRANSACTIONSTEP]=this[DATASETRANSACTIONSTATE].length,this[DATASETDATA]=this[DATASETRANSACTIONSTATE][0],this[DATASETOWNER]._updateForceFromDataSet().then(()=>DataSetHelper.dispatchForce(this).then(()=>(this[DATASETEDITS]=[],this[DATASETDATA])))):Promise.resolve(this.getData())}travel(t=0){return t=this[DATASETRANSACTIONSTATE].length-t,this[DATASETRANSACTIONSTATE].length>0&&this[DATASETRANSACTIONSTATE][t]?(this[DATASETRANSACTIONSTEP]=t,this[DATASETDATA]=this[DATASETRANSACTIONSTATE][t],this[DATASETOWNER]._updateForceFromDataSet().then(()=>DataSetHelper.dispatchForce(this).then(()=>(this[DATASETEDITS]=[],this[DATASETDATA])))):Promise.resolve(this.getData())}_setState(t){this[DATASETRANSACTIONSTATE].length>this.getTransactionSize()&&this[DATASETRANSACTIONSTATE].shift(),this[DATASETRANSACTIONSTATE].unshift(t),this[DATASETRANSACTIONSTEP]=this[DATASETRANSACTIONSTATE].length-1,this[DATASETDATA]=t}}class DataSetHelper{static getDataSet({type:t=DataSet,service:T=Service},e){let A=new t;if(A[DATASETOWNER]=e,!(T.prototype instanceof Service))throw Error("[ada] must be a Service class");return A[DATASETSERVICE]=new T,A[DATASETSERVICE][DATASETACTION]=Object.assign({update:"onupdate"},Metadata.getMetadataExtends("action",A[DATASETSERVICE].constructor.prototype)||{}),A[DATASETSERVICE][DATASETCOMPUTE]=Metadata.getMetadataExtends("compute",A[DATASETSERVICE].constructor.prototype)||{},A[DATASETSERVICE][CONTEXT]=e.context,A}static commit(t,T,e){return Promise.resolve().then(()=>t[DATASETOWNER].onbeforecommit(T)).then(()=>DataSetHelper.trigger(t,T,e).then(e=>(t[DATASETCOMMITCOUNT]--,0===t[DATASETCOMMITCOUNT]&&(t[DATASETISCOMMIT]=null),Promise.resolve().then(()=>t[DATASETOWNER]&&t[DATASETOWNER].oncommited(T)).then(()=>e)),e=>(console.error(e),t[DATASETCOMMITCOUNT]--,0===t[DATASETCOMMITCOUNT]&&(t[DATASETISCOMMIT]=null),Promise.resolve().then(()=>t[DATASETOWNER]&&t[DATASETOWNER].oncommited(T)).then(()=>e))))}static trigger(t,T,e){let A=t[DATASETSERVICE][DATASETACTION][T];if(A&&t[DATASETSERVICE][A]){let T=new Collector({data:t.getData(),fn:t[DATASETSERVICE][A]});return Promise.resolve().then(()=>T.invoke(protectData(e),t[DATASETSERVICE])).then(e=>{if(t[DATASETOWNER])return t._setState(e||{}),t[DATASETEDITS]=T.getChangedProps(),t[DATASETOWNER]._updateFromDataSet().then(()=>DataSetHelper.dispatch(t).then(()=>(t[DATASETEDITS]=[],e)))})}return Promise.reject(`[ada] service action is undefined name is ${T}`)}static dispatch(t){return DataSetHelper.dispatchDatasetListeners(t,t[DATASETLISTENER].filter(T=>isChanges(t.getChangedProps(),T.useprops)))}static dispatchForce(t){return DataSetHelper.dispatchDatasetListeners(t,t[DATASETLISTENER])}static dispatchDatasetListeners(t,T){return T.reduce((T,e)=>T.then(()=>{if(e.view.isRemoved())return Promise.resolve();{let T=new Collector({data:t.getData(),fn:e.getter,precise:10}),A=T.invoke();return e.useprops=T.getUsedPros(),e.view._updateFromConnect({data:A,setter:e.setter})}}),Promise.resolve())}}module.exports={Service:Service,DataSet:DataSet,TransactDataSet:TransactDataSet,DataSetHelper:DataSetHelper};},function(module,exports,require){"use strict";let Metadata=require(10),{ROOTELEMENTNAME:ROOTELEMENTNAME,VIEWTAG:VIEWTAG,DATASET:DATASET,DATASETDATA:DATASETDATA,DDMTAG:DDMTAG,CHILDRENTAG:CHILDRENTAG}=require(12),{parseTemplate:parseTemplate,parseStyle:parseStyle,excuteStyle:excuteStyle,setProp:setProp}=require(7),env=require(9),factory={cleanView:e=>e.querySelectorAll&&!e.parentNode?[e,...e.querySelectorAll("[data-module]")].reverse().reduce((e,t)=>e.then(()=>t[VIEWTAG]&&t[VIEWTAG]._remove&&!t._sorted?t[VIEWTAG]._remove():Promise.resolve()),Promise.resolve()):Promise.resolve(),getViewInstance({viewClass:e,parent:t,dom:o,name:r="",tag:n="view",useProps:a=[],context:l=null,id:s}){let d=Metadata.getMetadataExtends(n,e.prototype);d.scope||(d.scope="local"),void 0===d.precise&&(d.precise=3);let i=Promise.resolve();return d.template&&(i=i.then(()=>l.loader.loadSource(d.template).then(e=>{d.template="local"===d.scope?parseTemplate(e,d.className):e}))),d.style&&(i=i.then(()=>l.loader.loadSource(d.style).then(e=>{excuteStyle("local"===d.scope?parseStyle(e,d.className):e,`${d.style.replace(/\//g,"-")}:${d.className}`,l)}))),i.then(()=>{d.className&&o.classList.add(d.className);let n=new e({parent:t,info:d,name:r,dom:o,useProps:a,context:l,id:s});return setProp(o,VIEWTAG,n),n})},getRootView(e,t={},o=null){let r=()=>{if(o.document.getElementById("ada-root"))return Promise.resolve(null);{let r=o.document.createElement("div");r.setAttribute("id",ROOTELEMENTNAME),r.setAttribute("class",ROOTELEMENTNAME),r.setAttribute("data-module","ada-root"),o.document.body.appendChild(r);let n=r[VIEWTAG];return n?Promise.resolve(n):factory.getViewInstance({viewClass:e,parent:null,dom:r,tag:"root",name:"root",useProps:[],context:o}).then(e=>(e.oncreated(),e.update(t).then(()=>(e.onready(),e))))}};return new Promise((e,t)=>{/complete|loaded|interactive/.test(o.document.readyState)?r().then(t=>e(t)):o.document.addEventListener("DOMContentLoaded",()=>r().then(t=>e(t)),!1)})},init(e,t){e._steps.push("init"),t&&(e._bootFlow=e._bootFlow.then(()=>t.call({context:e})).then(t=>e._invokeHook("initdone",t)))},boot({root:e="",basePath:t="",parameter:o={},map:r={},develop:n=!0,context:a}={}){a._steps.push("boot"),a.config={root:e,basePath:t,develop:n,parameter:o,sourceMap:r},env.develop=n,0===e.indexOf("./")&&(e=e.substring(2)),0===e.indexOf("/")&&(e=e.substring(1)),a._bootFlow=a._bootFlow.then(()=>a.loader.loadModule(e).then(()=>{let e=null;return a.loader.moduleLoader.scanClass((t,o)=>{if(Metadata.getMetadata("root",o.prototype))return e=o,!1}),e?factory.getRootView(e,o,a).then(e=>{let t=a.window.MutationObserver||a.window.WebKitMutationObserver||a.window.MozMutationObserver;return t?new t(e=>{e.forEach(e=>[...e.removedNodes].reduce((e,t)=>e.then(()=>factory.cleanView(t)),Promise.resolve()))}).observe(a.document,{childList:!0,subtree:!0}):a.document.addEventListener("DOMNodeRemoved",e=>factory.cleanView(e.target)),e}):(console.error("root class can not find"),Promise.reject())})).then(()=>a._invokeHook("bootdone"))},recover(e,t){let o=(t,r)=>{let{id:n,module:a,name:l,useProps:s}=t;return e.loader.loadModule(a).then(a=>this.getViewInstance({viewClass:a,parent:r,dom:e.document.querySelectorAll("[data-module-id='"+n+"']")[0],name:l,tag:r?"view":"root",useProps:s,context:e,id:n}).then(e=>{let r=Promise.resolve();if(e[DATASET]&&(e[DATASET][DATASETDATA]=t.state),e[DDMTAG]&&e[DDMTAG].render(t.state),e.oncreated){let t=e.oncreated();t&&t.then&&(r=r.then(()=>t))}if(e.onrecover){let t=e.onrecover();t&&t.then&&(r=r.then(()=>t))}return t.children&&(r=r.then(()=>t.children.reduce((t,r)=>t.then(()=>o(r,e).then(t=>{e[CHILDRENTAG].push(t)})),Promise.resolve()).then(()=>e))),r.then(()=>e)}))};e._steps.push("recover"),e._bootFlow=e._bootFlow.then(()=>new Promise(r=>{/complete|loaded|interactive/.test(e.document.readyState)?o(t,null).then(r):e.document.addEventListener("DOMContentLoaded",()=>{o(t,null).then(r)})})).then(()=>e._invokeHook("recoverdone"))}};module.exports=factory;},function(module,exports,require){"use strict";let{View:View}=require(1),{SUBSCRIBE:SUBSCRIBE}=require(12);class Dispatcher{constructor(){this._listener=[]}observe(e){return e instanceof View&&-1===this._listener.indexOf(e)&&this._listener.push(e),this}unobserve(e){let i=this._listener.indexOf(e);return-1!==i&&this._listener.splice(i,1),this}dispatch(e,i){this._listener.forEach(s=>{if(!s.isRemoved()){let t=s[SUBSCRIBE][e];try{t&&s[t]&&s[t](i)}catch(e){console.error("[ada] dispatcher subscriber call error ",e)}}}),this._listener=this._listener.filter(e=>!e.isRemoved())}}module.exports={Dispatcher:Dispatcher};},function(module,exports,require){"use strict";let Collector=require(13),{BASEDATA:BASEDATA}=require(12);class Passable{constructor(e){Reflect.defineProperty(this,BASEDATA,{enumerable:!1,configurable:!1,writable:!0,value:e})}pass(e,t={},l={}){return e||(e=(e=>e)),new Collector({data:this[BASEDATA],fn:e,collect:!1}).invoke(t,l)}static get(e){return new Passable(e)}}module.exports=Passable;},function(module,exports,require){"use strict";let{isObject:isObject,isFunction:isFunction}=require(7),Metadata=require(10),{DataSet:DataSet,Service:Service}=require(2),{setSourcePaths:setSourcePaths}=require(15);function checkDataSetMetaInfo(t){isFunction(t)&&(t={service:t});let e=!0,n="",a=Object.assign({type:DataSet,service:null},t);return isFunction(a.type)&&a.type.prototype instanceof DataSet||a.type===DataSet||(e=!1,n="[ada] dataset must be a class or subclass of  DataSet"),isFunction(a.service)&&(a.service.prototype instanceof Service||a.service===Service)||(e=!1,n="[ada] service must be a class or subclass of  Service"),{checked:e,errorInfo:n,info:a}}function setViewAnnotation(t,e){if(null===e||isObject(e))return function(n){let a=e||{};if(a.dataset){let{checked:t,errorInfo:e,info:n}=checkDataSetMetaInfo(a.dataset);if(!t)throw Error(`[data] view dataset error ${e}`);a.dataset=n}setSourcePaths(a),Metadata.defineMetadata(t,a,n.prototype)};Metadata.defineMetadata(t,{},e.prototype)}function setMethodAnnotation(t,e){if(e)return function(n,a){let o=Metadata.getMetadata(t,n)||{};e.split(",").forEach(t=>o[t]=a),Metadata.defineMetadata(t,o,n)};throw Error(`[ada] annotation ${e} name can not be empty`)}exports.view=function(t=null){return setViewAnnotation("view",t)},exports.root=function(t=null){return setViewAnnotation("root",t)},exports.action=function(t){return setMethodAnnotation("action",t)},exports.compute=function(t){return setMethodAnnotation("compute",t)},exports.handler=function(t){return setMethodAnnotation("handler",t)},exports.binder=function(t){return setMethodAnnotation("binder",t)},exports.subscribe=function(t){return setMethodAnnotation("subscribe",t)};},function(module,exports,require){"use strict";let{DATASET:DATASET,DATASETSERVICE:DATASETSERVICE}=require(12),Passable=require(5),env=require(9);const QUREYREG=/(^|&).*=([^&]*)(&|$)/,TEMPLATEREG=/class=(["'])(?:(?=(\\?))\2.)*?\1/g,STYLEREG=/\{|\}/,STYLEREG_B=/\.[0-9a-zA-Z-]+/g,ISHTMLREG=/^\s*<(\w+|!)[^>]*>/;function isString(e){return"string"==typeof e&&e.constructor===String}function isFunction(e){return"function"==typeof e&&e.constructor===Function}function isEqual(e,t){if(null===e||void 0===e||null===t||void 0===t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;let n=Object.keys(e);return Object.keys(t).every(function(e){return-1!==n.indexOf(e)})&&n.every(function(n){return isEqual(e[n],t[n])})}function isObject(e){return"object"==typeof e&&"[object object]"===Object.prototype.toString.call(e).toLowerCase()&&!e.length}function isPlainObject(e){return isObject(e)&&e.constructor.prototype===Object.prototype}function isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}function isQueryString(e){return isString(e)&&QUREYREG.test(e)}function queue(e){let t=null,n=[];return e.forEach(e=>{t=t?t.then(t=>(n.push(t),e())):e()}),t?t.then(e=>(n.push(e),n)):Promise.resolve([])}function randomid(e=7){return e<=2&&(e=7),Math.random().toString(36).slice(2,e+2)}function setProp(e,t,n){Reflect.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!0,value:n})}function queryString(e){let t=[];if(e){for(let n in e){let r=e[n];isString(r)?t.push(`${n}=${encodeURIComponent(r)}`):isObject(r)||isArray(r)?t.push(`${n}=${encodeURIComponent(JSON.stringify(r))}`):t.push(`${n}=${void 0!==r&&null!==r?encodeURIComponent(r.toString()):""}`)}return t.join("&")}return""}function postData(e,t){if(e){if(e instanceof FormData||e instanceof Blob||e instanceof ArrayBuffer)return e;if(isObject(e)){let n=!1;for(let t in e)if(e[t]instanceof Blob||e[t]instanceof ArrayBuffer||e[t]instanceof File){n=!0;break}if(n){let t=new FormData;for(let n in e)e[n]instanceof Blob?t.append(n,e[n]):e[n]instanceof File?t.append(n,e[n]):isArray(e[n])||isObject(e[n])?t.append(n,encodeURIComponent(JSON.stringify(e[n]))):e[n]instanceof FormData||t.append(n,encodeURIComponent(e[n].toString()));return t}return t?queryString(e):JSON.stringify(e)}return isArray(e)?encodeURIComponent(JSON.stringify(e)):e}return null}function parseTemplate(e,t){return t?e.replace(TEMPLATEREG,function(e){if(-1===e.indexOf("{{")){let n=e.substring(7,e.length-1).trim().split(" ").map(e=>":"===e[0]?e.substring(1):t+"-"+e),r=e.substr(6,1);return`class=${r}${n.join(" ")}${r}`}return`class="{{(${e.substring(9,e.length-3).trim()}).split(' ').map(key=>key?(key[0]!==':'?('${t}-'+key):key.substring(1)):'').join(' ')}}"`}):e}function parseStyle(e,t){let n="",r=[],i=[];return e.split(STYLEREG).forEach(e=>{let t=e.trim();-1!==t.indexOf("@")&&(i.push([].concat(r)),r=[]),r.push(t)}),i.push(r),i.forEach(e=>{let r=!1,i=[];-1!==e[0].indexOf("@")&&(r=!0,n+=e[0]+"{",e.shift()),e.forEach((e,n)=>{e=e.trim(),(n+1)%2!=0?i.push(e.replace(STYLEREG_B,e=>e.substring(1).trim()!==t?`.${t}-${e.substring(1)}`:e)):e&&i.push("{"+e+"}")}),n+=r?i.join("")+"}":i.join("")}),n}function excuteStyle(e,t,n){if(!n.document.getElementById(t)){let r=n.document.createElement("style");r.setAttribute("media","screen"),r.setAttribute("type","text/css"),r.setAttribute("id",t),r.appendChild(n.document.createTextNode(e)),n.document.getElementsByTagName("head")[0].appendChild(r)}}function hashCode(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return t}function encodeHTML(e,t){if(ISHTMLREG.test(e)){let n=t.document.createElement("div");return void 0!=n.textContent?n.textContent=e:n.innerText=e,n.innerHTML}return e}function getMappedPath(e){return`P${Math.abs(hashCode(e))}`}function extend(){let e,t,n,r,i,o,s=arguments[0]||{},a=1,u=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||isFunction(s)||(s={}),a===u&&(s=this,a--);a<u;a++)if(null!=(e=arguments[a]))for(t in e)n=s[t],s!==(r=e[t])&&(c&&r&&(isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,o=n&&Array.isArray(n)?n:[]):o=n&&isPlainObject(n)?n:{},s[t]=extend(c,o,r)):void 0!==r&&(s[t]=r));return s}function clone(e){return isArray(e)?extend(!0,[],e):isObject(e)?extend(!0,{},e):e}function isTargetDataSet(e,t){let n=!0;return e[DATASETSERVICE]instanceof t.service||(n=!1),n&&t.type&&(e instanceof t.type||(n=!1)),n}function getDataSetFromParent(e,t){let n=null,r=e.getParent();for(;r;){let e=r[DATASET];if(e&&isTargetDataSet(e,t)){n=e;break}r=r.getParent()}return n}function isChanges(e,t){return e&&t&&e.length>0&&t.length>0?t.some(t=>-1!==e.indexOf(t)):!(0===e.length||0===t.length)}function isSubModuleChange(e,t){return e&&t&&e.length>0&&t.length>0?t.some(t=>e.some(e=>0===e.indexOf(t)||e===t)):!(0===e.length||0===t.length)}function protectData(e){let t=e;return!Object.isFrozen(e)&&env.develop&&(t=Passable.get(e).pass()),t}function isBrowser(){return"undefined"!=typeof window}module.exports={isString:isString,isFunction:isFunction,isEqual:isEqual,isObject:isObject,isPlainObject:isPlainObject,isArray:isArray,isQueryString:isQueryString,queue:queue,randomid:randomid,setProp:setProp,queryString:queryString,postData:postData,parseTemplate:parseTemplate,parseStyle:parseStyle,hashCode:hashCode,encodeHTML:encodeHTML,getMappedPath:getMappedPath,extend:extend,clone:clone,excuteStyle:excuteStyle,isTargetDataSet:isTargetDataSet,getDataSetFromParent:getDataSetFromParent,isChanges:isChanges,isSubModuleChange:isSubModuleChange,protectData:protectData,isBrowser:isBrowser};},function(module,exports,require){"use strict";let BaseContext=require(18),{isBrowser:isBrowser}=require(7),Loader=require(19),BrowserLogger=require(20),BrowserRequest=require(21),RequestManager=require(22);class BrowserContext extends BaseContext{constructor(){super(),this._window={},isBrowser()&&(this._window=window),this._loader=new Loader(this),this._logger=new BrowserLogger(this),this._request=new RequestManager(this,BrowserRequest)}get window(){return this._window}get document(){return this._window.document}get logger(){return this._logger}get request(){return this._request}}module.exports=BrowserContext;},function(module,exports,require){"use strict";let env={develop:!1};module.exports=env;},function(module,exports,require){"use strict";const METADATAKEY="[[metadata]]",Metadata={defineMetadata(e,t,a){-1===Reflect.ownKeys(a).indexOf(METADATAKEY)&&Reflect.defineProperty(a,METADATAKEY,{enumerable:!1,configurable:!1,writable:!1,value:{}}),a[METADATAKEY][e]=t},getMetadata(e,t){let a=t,A=void 0;for(;a;){if(-1!==Reflect.ownKeys(a).indexOf(METADATAKEY)){A=a[METADATAKEY][e];break}a=Reflect.getPrototypeOf(a)}return A},getMetadataExtends(e,t){let a=t,A=[];for(;a;)-1!==Reflect.ownKeys(a).indexOf(METADATAKEY)&&A.push(a[METADATAKEY][e]),a=Reflect.getPrototypeOf(a);return Object.assign({},...A.reverse())}};module.exports=Metadata;},function(module,exports,require){"use strict";let eventHelper=require(14),Collector=require(13),{encodeHTML:encodeHTML,isFunction:isFunction,isPlainObject:isPlainObject,randomid:randomid}=require(7),{PROXYSTATE:PROXYSTATE}=require(12);const REGS={k:/\r/g,l:/\n/g,a:/&lt;/g,b:/&gt;/g,d:/<%|%>/g,e:/^=.*;$/,i:/\r\n/g,f:/>[\s]+</g,g:/<%[\s\S]*%>/,h:/\<\!\-\-[\s\S]*?\-\-\>/g,startdot:/&lt;/g,enddot:/&gt;/g,isDoctype:/\<\!DOCTYPE[\s\S]*?\>/g,isNote:/\<\!\-\-[\s\S]*?\-\-\>/g,isXmlTag:/\<\?[\s\S]*?\?\>/g,propcode:/\@\[\[[0-9]+\]\]\@/g,eventcode:/\$\[\[[0-9]+\]\]\$/g,assigncode:/\(\(\[[0-9]+\]\)\)/g,assigncodex:/\(\(\[[0-9]+\]\)\)/,assigncodeonly:/^\(\(\[[0-9]+\]\)\)$/,expresscode:/\[\[[0-9]+\]\]/g,nodecode:/\{\{node\}\}/g,prop:/[0-9a-z]+((\.)([0-9a-z_]+))+/g,customA:/<[\s\S]+?>/g,customB:/<[0-9a-z_-]+?>/,customC:/<[0-9a-z_-]+ .*?>/,customD:/<\/[0-9a-z_-]+?>/,customE:/<[0-9a-z_-]+\/?>/},SINGLETAG=["br","hr","img","input","param","link","meta","area","base","basefont","param","col","frame","embed","keygen","source"],TEMPLATECACHE=new Map,IDNAME="$$ID";let SelfCloseTags=[...SINGLETAG],Parser={beautySyntax:{syntaxs:{defaults:e=>`<%=${e.substring(2,e.length-2)};%>`,log:e=>`<%window.Ada.log?window.Ada.log(${e.join(" ")}):console.log(${e.join(" ")});%>`,html:e=>`<%=assign(html,${e.filter(e=>!!e).join(",")});%>`,map(e){let t=e.shift();e.shift();let r=e.shift()||"$value",s=e.shift()||"$key",n="_"+randomid(8);return`<%for(var ${n} in ${t}){var ${r}=${t}[${n}];var ${s}=${n};%>`},"/map":()=>"<%}%>",list(e){var t=e.shift();e.shift();let r=e.shift()||"$item",s=e.shift()||"$index",n="_"+randomid(8),a="_"+randomid(6);return`<%if(${t}&&${t}.length>=0)for(var ${n}=0,${s}=0,${a}=${t}.length;${n}<${a};${n}++){var ${r}=${t}[${n}];${s}=${n};%>`},"/list":e=>"<%}%>",if:e=>`<%if(${e.join(" ")}){%>`,elseif:e=>`<%}else if(${e.join(" ")}){%>`,else:()=>"<%}else{%>","/if":()=>"<%}%>",break:()=>"<%break;%>",set:e=>`<%var ${e.join(" ")};%>`},parse:(e="")=>e.replace(/\{\{[\s\S]+?\}\}/g,e=>{let t=e.substring(2,e.length-2).split(" "),r=t.shift();try{return Parser.beautySyntax.syntaxs[r]?Parser.beautySyntax.syntaxs[r](t):Parser.beautySyntax.syntaxs.defaults(e)}catch(e){console.log(e)}})},nodeParser:{getNodeStr(e){let t={},r={},s={},n=[];return Reflect.ownKeys(e.props).forEach(function(a){if(a.startsWith("on")){let r=a.substring(2);t[r]=e.props[a],n.push(r)}else if(a.startsWith("@")){let t=a.substring(1);s[t]=e.props[a]}else"data-find"===a?r["data-find"]=`${IDNAME}+":${e.props["data-find"]}"`:"data-group"===a?r["data-group"]=`${IDNAME}+":${e.props["data-group"]}"`:"data-module"===a?r["data-module"]=`${IDNAME}`:r[a]=`"${e.props[a]}"`}),n.length>0&&(r["data-bind"]=`${IDNAME}+":${n.join(",")}"`),`{tag:"${e.tag}",attrs:{${Reflect.ownKeys(r).map(e=>`"${e}":${r[e]}`).join(",")}},events:{${Reflect.ownKeys(t).map(e=>`${e}:$${t[e]}$`).join(",")}},props:{${Reflect.ownKeys(s).map(e=>'"'===s[e][0]?`${e}:${s[e]}`:`${e}:@${s[e]}@`).join(",")}},children:[]}`},code(e,t){if(e.isTextNode){let t="";return t=/\(\[[0-9]+\]\)/.test(e.content)?e.content:`{content:"${e.content||""}"}`}{let r="",s="",n=Parser.nodeParser.getNodeStr(e);return s=e.parent?`${n};$$CURRENT=${r="$$NODE"+t};`:`var ${r="$$NODE"+t}=${n};$$CURRENT=${r};`,e.children.forEach(e=>{if(e.isTextNode&&/\(\[[0-9]+\]\)/.test(e.content))s+=e.content;else{let n=t.split("_"),a=`$$NODE${t=`${n[0]}_${n[1]/1+1}`}`,i=Parser.nodeParser.code(e,t);s+=`var ${a}=${i}; ${r}.children.push(${a}); $$CURRENT=${r};`}}),s}}},getHTMLString(e,t){let r="",s=t=>{let r="",n=-1!==SINGLETAG.indexOf(t.tag);if(void 0!==t.content)if(void 0===t.type)r=encodeHTML(t.content,e)||"";else{let s=t.type,n=t.content;e.ddm.defaultAssignDirectives[s]&&(n=e.ddm.defaultAssignDirectives[s](t.content)),r='<div class="ada-assign-directive" data-assign-directive-type="'+s+'">'+(n||"")+"</div>"}else{let e=[];if(t.attrs&&Reflect.ownKeys(t.attrs).forEach(function(r,s){t.attrs[r]&&e.push(r+'="'+t.attrs[r]+'"')}),n)r="<"+t.tag+" "+e.join(" ")+"/>";else{let n=[];t.children.forEach(function(e){e&&n.push(s(e))}),r="<"+t.tag+" "+e.join(" ")+">"+n.join("")+"</"+t.tag+">"}}return r};return t.forEach(function(e){r+=s(e)}),r},preparse(e,t="",r={}){return t=this.parseCustomTag(e,t.trim(),r).replace(REGS.isNote,"").replace(REGS.isDoctype,"").replace(REGS.isXmlTag,"").replace(REGS.a,"<").replace(REGS.b,">").replace(REGS.h,"").replace(REGS.f,"><").replace(REGS.i,"").replace(REGS.k,"").replace(REGS.l,""),[...SelfCloseTags,...Reflect.ownKeys(r).filter(e=>{let t=r[e];if(!isFunction(t))return!0===t.selfClose})].forEach(e=>{let r=new RegExp(`<${e} .*?>`,"g");t=t.replace(r,function(e){return e.substring(0,e.length-1)+"/>"})}),t},parseCustomTag:(e,t,r={})=>t.replace(REGS.customA,t=>t.replace(REGS.customB,t=>{let s=t.substring(1,t.length-1);return e.tags.has(s)||void 0!==r[s]?`<@custom @customTagName="${s}">`:(e.tags.isRegularTag(s)||console.warn(`[ada] tag [${s}] seemed not supported`),t)}).replace(REGS.customE,t=>{let s=t.substring(1,t.length-2);return e.tags.has(s)||void 0!==r[s]?`<@custom @customTagName="${s}"/>`:(e.tags.isRegularTag(s)||console.warn(`[ada] tag [${s}] seemed not supported`),t)}).replace(REGS.customC,t=>{let s=t.split(" "),n=s.shift().substring(1);return e.tags.has(n)||void 0!==r[n]?(s.unshift(`<@custom @customTagName="${n}"`),s.join(" ")):(e.tags.isRegularTag(n)||console.warn(`[ada] tag [${n}] seemed not supported`),t)}).replace(REGS.customD,t=>{let s=t.substring(2,t.length-1);return e.tags.has(s)||void 0!==r[s]?"</@custom>":(e.tags.isRegularTag(s)||console.warn(`[ada] tag [${s}] seemed not supported`),t)})),parseMacro(e=""){if(-1!==e.indexOf("<@")){let t,r=-1,s="",n="start",a="",i="",o="",l=!0,p="",d={},h=0,c=0,u=0,f=0,g=[];for(;r<e.length;)s=e[++r],"start"!==n||"<"!==s||"@"!==e[r+1]?"tagstart"!==n||"@"!==s?"start"!==n||"<"!==s||"/"!==e[r+1]||"@"!==e[r+2]?"endtag"!==n||">"!==s?"tagname"!==n||" "!==s?"tagname"!==n||"/"!==s&&">"!==s?"propname"!==n||"="!==s?"propvalue"!==n||"'"!==s&&'"'!==s?"propvalueing"!==n||s!==t?("endtag"===n&&(p+=s),"tagname"===n&&(a+=s),"propname"===n&&(i+=s),"propvalueing"===n&&(o+=s)):(n="tagname",d[i]=o):(n="propvalueing",t=s,o=""):n="propvalue":(">"===s?(c=r+1,n="start",l=!0):"/"===s&&(c=r+2,n="start",l=!1),""!==a&&g.push({type:"tag",tagname:a,props:d,body:l,start:h,end:c})):(n="propname",i=""):(n="start",f=r+1,g.push({type:"endtag",tagname:p,start:u,end:f})):(u=r,n="endtag",p="",r+=2):(n="tagname",a="",d={}):(n="tagstart",h=r);let m=0,$=0,E=0,_=!1,b=null,S=[],v="",R=0;return Reflect.ownKeys(g).forEach(t=>{let r=g[t];"tag"===r.type&&!1===r.body&&!1===_&&(r.bodystr="",r.from=r.start,r.to=r.end,S.push(r)),"tag"===r.type&&!0===r.body&&(_=!0,null===b&&((b=r).from=r.start),0===m&&($=r.start,E=r.end),m++),"endtag"===r.type&&0===--m&&(b.to=r.end,b.bodystr=e.substring(E,r.start),S.push(b),b=null,_=!1)}),S.forEach(t=>{let r=t.props,s=[],n=[],a=[],i=[],o=[];Reflect.ownKeys(r).forEach(e=>{let t=r[e],l="";if(REGS.g.test(t)){let e="";t.split(REGS.d).forEach((t,r)=>{(r+1)%2==0?""!==t&&(e+=`${t}+`):e+=""!==t?`'${t}'+`:t});let r=e.length>0?e.substring(0,e.length-1):"''";l=r.substring(1,r.length-1)}else l=`"${t}"`;if(e.startsWith("on")){let t=e.substring(2);s.push({name:t,value:l})}else if(e.startsWith("@")){if(n.push(`"${e.substring(1)}":${l}`),"parameter"===e.substring(1).trim()){let e=l.match(REGS.prop);e&&e.forEach(e=>{i.push(e);let t=e.split(".");t.pop(),o.push(`"${e}":${e}`),o.push(`"${t.join(".")}":${t.join(".")}`)})}}else a.push(`"${e}":${l}`)});let l=s.map(e=>{let t=e.value.split(/\(|\)/),r=t.shift();t.pop();let s=[],n=t.map(e=>{if(-1!==e.indexOf(" as ")){let t=e.split("as");return s.push(`${t[1].trim()}`),t[0].trim()}return s.push(`${e.split(".").pop()}`),e});return`"${e.name}":{method:"${r}",parameters:[${n.join(",")}],paranames:"${s.join(",")}"}`});v+=`${e.substring(R,t.from)}<%var $$MACRORESULT=this._macro({tag:"${t.tagname}",props:{${n.join(",")}},attrs:{${a.join(",")}},events:{${l.join(",")}},bodyStr:"${t.bodystr}",uses:[${i.map(e=>"'"+e+"'").join(",")}],usesmap:{${o.join(",")}}});if({{node}}){if($$MACRORESULT&&$$MACRORESULT.length){for(var $$INDEX=0;$$INDEX<$$MACRORESULT.length;$$INDEX++){{{node}}.children.push($$MACRORESULT[$$INDEX]);}}else{{{node}}.children.push({content:$$MACRORESULT||''});}}else{if($$MACRORESULT&&$$MACRORESULT.length){$$RESULT=$$RESULT.concat($$MACRORESULT);}else{$$RESULT.push({content:$$MACRORESULT||''});}}%>`,R=t.to}),v+=e.substring(R,e.length)}return e},parseNode(e=""){if(e&&""!==e){let t=[],r=[],s=null,n="",a="",i="",o="",l="",p=!1,d=!1,h=!1,c=!1,u=!1;for(let f=0,g=e.length;f<g;f++){let g=e[f];if("\r"!==g&&"\n"!==g){if("<"===g){u=!0,""!==l.trim()&&(s={content:l.trim()||"",parent:t[t.length-1]||null,isTextNode:!0},t[t.length-1]?t[t.length-1].children.push(s):r.push(s),l=""),e[f+1]&&"/"===e[f+1]?c=!0:(s={tag:"",props:{},children:[],parent:null,hasProp:!1,isTextNode:!1},t.push(s),t.length-2>=0&&(t[t.length-2].children.push(s),s.parent=t[t.length-2]),p=!0);continue}if(" "===g){if(u&&(p&&(p=!1,s.tag=n.trim(),n=""),!d&&!h)){d=!0;continue}}else if("="===g)u&&(d=!1);else if("'"===g||'"'===g){if(!h&&u){h=g;continue}h===g&&(h=!1,s.hasProp=!0,s.props[i.trim()]=o.trim(),i="",o="")}else{if(">"===g){u=!1,d=!1,h=!1,p=!1,c&&(c=!1,a="",1===t.length&&r.push(t[0]),t.pop()),s.hasProp||(""===s.tag&&(s.tag=n.trim()),n=""),!u&&l&&(l+=g);continue}if("/"===g){e[f+1]&&">"===e[f+1]?(u=!1,h=!1,d=!1,c=!1,p=!1,a="",1===t.length&&r.push(t[0]),s.hasProp||(""===s.tag&&(s.tag=n.trim()),n=""),t.pop()):u?h&&(o+=g):l+=g;continue}}p&&(n+=g),d&&(i+=g),h&&(o+=g),c&&(a+=g),!u&&(l+=g)}}return l&&r.push({content:l||"",parent:null,isTextNode:!0}),r}return[]},reparseNode(e){return e.forEach(e=>{if(e.isTextNode){if(e.parent&&REGS.assigncodex.test(e.content)&&!REGS.assigncodeonly.test(e.content)){let t=[],r=[];e.content.replace(REGS.assigncode,r=>(t.push({content:r,isTextNode:!0,parent:e.parent}),r)).split(REGS.assigncodex).forEach(s=>{s.trim()&&r.push({content:s,isTextNode:!0,parent:e.parent});let n=t.shift();n&&r.push(n)}),e.parent.children.splice(e.parent.children.indexOf(e),1,...r)}}else this.reparseNode(e.children)}),e},code(e=""){let t="",r=[],s=[],n='"use strict";\nvar $$RESULT=[],$$CURRENT=null;\n';return e.split(REGS.d).forEach((e,n)=>{n%2!=0?REGS.e.test(e)?(t+=""+`[[${r.length}]]`,r.push(e)):(t+=`(([${s.length}]))`,s.push(e)):t+=""+e}),Parser.reparseNode(Parser.parseNode(t)).forEach((e,t)=>{let r=t+"_0",s=Parser.nodeParser.code(e,r);n+=s+"\r\n",-1!==s.indexOf("$$NODE"+r)&&-1===s.indexOf("$$RESULT.push($$NODE"+r+")")&&(n+="$$RESULT.push($$NODE"+r+");$$CURRENT=null;\r\n")}),n=n.replace(REGS.assigncode,(e,t,r)=>s[e.substring(3,e.length-3)]).replace(REGS.propcode,(e,t,s)=>{let n=r[e.substring(3,e.length-3)];return n&&"="===n[0]?n.substring(1,n.length-1):n}).replace(REGS.eventcode,(e,t,s)=>{let n=r[e.substring(3,e.length-3)];if(n&&"="===n[0]){let e=n.substring(1,n.length-1).split(/\(|\)/),t=[],r=[];return e[1]&&(t=e[1].split(",").map(e=>-1!==e.indexOf(" as ")?e.split("as").pop().trim():-1!==e.indexOf(".")?e.split(".").pop():e),r=e[1].split(",").map(e=>-1!==e.indexOf(" as ")?e.split("as").shift().trim():e)),`{method:"${e[0].trim()}",parameters:[${r.join(",")||""}],paranames:"${t.join(",")}"}`}return n}).replace(REGS.expresscode,(e,t,s)=>{let n=r[e.substring(2,e.length-2)];if(n&&"="===n[0]){let e=n.substring(1,n.length-1);if(0===e.indexOf("assign(")){let t=(e=e.substring(7,e.length-1)).split(","),r=t.shift(),s=t.join(",");return`"+((${s})!==undefined?(${s}):''),"type":"${r}`}return`"+((${e})!==undefined?(${e}):'')+"`}return n}).replace(REGS.nodecode,(e,t,r)=>"$$CURRENT"),n+="return $$RESULT;"},parse(e,t="",r={}){let s="";return TEMPLATECACHE.has(t)?s=TEMPLATECACHE.get(t):(s=Parser.code(Parser.parseMacro(Parser.beautySyntax.parse(Parser.preparse(e,t,r)))),TEMPLATECACHE.set(t,s)),s}},Differ={childrenEvents(e=[]){let t=new Set,r={};return e.forEach(e=>(function e(s){s.events&&(Reflect.ownKeys(s.events).forEach(e=>{if(eventHelper.canBubbleUp(e))t.add(e);else{let t=s.attrs["data-bind"];r[t]||(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)}}),s.attrs&&s.attrs["data-module"]||s.children&&s.children.forEach(t=>e(t)))})(e)),{bubbleEvents:Array.from(t),unBubbleEvents:r}},diffNode(e,t,r,s){if(e&&t){let n=e.length;if(0===e.length)0!==t.length&&s.removeAll.push({path:r.join(",")});else{if(e[0].attrs&&e[0].attrs.uid&&t[0]&&t[0].attrs&&t[0].attrs.uid){let n=[],a=[],i=[],o=[],l=[];e.length<t.length?(o=e.map(e=>e.attrs.uid),t=t.filter((e,t)=>{if(-1!==o.indexOf(e.attrs.uid))return!0;n.push(t)})):e.length>t.length?(t=t.map(e=>(l.push(e.attrs.uid),e)),e.forEach((e,r)=>{let s=e.attrs.uid;o.push(s),-1===l.indexOf(s)&&(l.push(e.attrs.uid),a.push({node:e,index:r}),t.push(e))})):o=e.map(e=>e.attrs.uid);let p=[];t.forEach((e,t)=>{let r=e.attrs.uid,s=o.indexOf(r);-1!==s&&s!==t?(i.push({node:e,from:t,to:s}),p[s]=e):p[t]=e}),t=p,n.forEach(e=>{s.bremove.push({path:r.join(",")+(r.length>0?",":"")+e})}),a.forEach(e=>{s.badd.push({path:r.join(","),node:e.node})}),i.map(e=>{s.sort.push({path:r.join(",")+(r.length>0?",":"")+e.from,to:e.to,from:e.from});let n=t[e.from];t[e.from]=t[e.to],t[e.to]=n})}else e.length<t.length&&(n=t.length);t.length>e.length&&(n=t.length);for(let a=0;a<n;a++){if(r.push(a),e[a])if(t[a])if(e[a].attrs&&void 0!==e[a].attrs["data-module"]){if(void 0!==e[a].attrs["data-module"]){let n=Differ.checkNode(e[a],t[a]);"replace"===n?s.replace.push({path:r.join(","),node:e[a]}):!0!==n&&s.edit.push({path:r.join(","),attrs:n})}}else{let n=Differ.checkNode(e[a],t[a]);t[a].attrs&&void 0!==t[a].attrs["data-module"]?s.replace.push({path:r.join(","),node:e[a]}):!0===n?Differ.diffNode(e[a].children,t[a].children,r,s):"replace"===n?s.replace.push({path:r.join(","),node:e[a]}):(s.edit.push({path:r.join(","),attrs:n}),Differ.diffNode(e[a].children,t[a].children,r,s))}else s.add.push({path:r.join(","),node:e[a]});else s.remove.push({path:r.join(","),node:t[a]});r.pop()}}}},checkNode(e,t){let r=!0;if(void 0!==e.content)r=e.content===t.content||"replace";else{if(e.tag===t.tag){return(e.attrs&&e.attrs["data-module"])!==(t.attrs&&t.attrs["data-module"])?"replace":Differ.checkProps(e.attrs,t.attrs)}r="replace"}return r},checkProps(e,t){let r=Object.keys(e),s=Object.keys(t),n={final:e},a=r.length,i=!1;r.length<s.length&&(a=s.length);for(let s=0;s<a;s++){let n=r[s];if(!n){i=!0;break}if(void 0===t[n]){i=!0;break}if(e[n]!==t[n]){i=!0;break}}return!i||n},diff(e,t){let r={add:[],replace:[],remove:[],edit:[],removeAll:[],bremove:[],badd:[],sort:[]};Differ.diffNode(e,t,[],r);return t=[],r}},Effecter={element(e,t,r){if("svg"===t.tag&&!r&&(r=!0),void 0!==t.content){if(r)return e.document.createElementNS("http://www.w3.org/2000/svg","text");if(void 0===t.type)return e.document.createTextNode(t.content);{let r=t.type,s=t.content;e.ddm.defaultAssignDirectives[r]&&(s=e.ddm.defaultAssignDirectives[r](t.content));let n=e.document.createElement("div");return n.setAttribute("class","ada-assign-directive"),n.setAttribute("data-assign-directive",r),n.innerHTML=s||"",n}}{let s=null;s=r?e.document.createElementNS("http://www.w3.org/2000/svg",t.tag):e.document.createElement(t.tag);for(let e in t.attrs)if(r){let r=e.split(":");r.length>1?s.setAttributeNS("http://www.w3.org/1999/"+r[0],r[1],t.attrs[e]):s.setAttributeNS(null,r[0],t.attrs[e])}else s.setAttribute(e,t.attrs[e]);for(let n=0;n<t.children.length;n++)s.appendChild(Effecter.element(e,t.children[n],r));return s}},effect(e,t,r){e.logger.log(`Badd:${r.badd.length} Add:${r.add.length} Replace:${r.replace.length} Remove:${r.remove.length} Edit:${r.edit.length} RemoveAll:${r.removeAll.length} Bremove:${r.bremove.length} Sort:${r.sort.length}`);let s={};if(r.badd.forEach(r=>{let s=t;r.path.trim()&&r.path.split(",").forEach(e=>{s=s.childNodes[e/1]}),s.appendChild(Effecter.element(e,r.node))}),r.bremove.map(e=>{let r=t;return e.path.trim()&&e.path.split(",").forEach(e=>{r=r.childNodes[e/1]}),r}).forEach(e=>e.parentNode.removeChild(e)),r.sort.length>0){let s=r.sort.map(e=>{let r=t;return e.path.trim()&&e.path.split(",").forEach(e=>{r=r.childNodes[e/1]}),{node:r,to:e.to,from:e.from}}),n=[...s[0].node.parentNode.childNodes];s.forEach(e=>{n[e.to];n[e.to]=e.node});let a=n[0].parentNode,i=e.document.createDocumentFragment();for(let e=0;e<n.length;e++)i.appendChild(n[e]);a.appendChild(i)}r.replace.forEach(r=>{let s=t,n=!1;r.path.trim()&&r.path.split(",").forEach(t=>{let a=s.childNodes[t/1];a?(s=a,n=!0):(n=!1,s.appendChild(Effecter.element(e,r.node)))}),n&&s.parentNode.replaceChild(Effecter.element(e,r.node),s)}),r.add.forEach(e=>{let r=t,n=e.path.split(",");n.pop();let a=n.join("");n.forEach(e=>{r=r.childNodes[e/1]}),s[a]?s[a].push({p:r,n:e.node}):s[a]=[{p:r,n:e.node}]}),r.edit.forEach(e=>{let r=t;e.path.trim()&&e.path.split(",").forEach(e=>r=r.childNodes[e/1]);let s=e.attrs,n=[];if(r.attributes.getNamedItem)n=[...r.attributes].map(e=>e.nodeName);else for(let e in r.attributes)n.push(e);Reflect.ownKeys(s.final).forEach(e=>{if(-1===e.indexOf(":")){if(r.getAttribute(e)!==s.final[e]){r.setAttribute(e,s.final[e]);try{r[e]=s.final[e]}catch(e){}}let t=n.indexOf(e);-1!==t&&n.splice(t,1)}else{let t=e.split(":"),a=t[1],i=t[0];r.getAttributeNS("http://www.w3.org/1999/"+i,a)!==s.final[e]&&r.setAttributeNS("http://www.w3.org/1999/"+i,a,s.final[e]);let o=n.indexOf(a);-1!==o&&n.splice(o,1),-1!==(o=n.indexOf(e))&&n.splice(o,1)}}),n.forEach(e=>{if(-1===e.indexOf(":"))r.removeAttribute(e);else{let t=e.split(":"),n=t[1],a=t[0];r.removeAttributeNS("http://www.w3.org/1999/"+a,n,s.final[tp])}})}),r.remove.map(e=>{let r=t,s=e.path.split(","),n=s.pop();return s.forEach(e=>r=r.childNodes[e/1]),r.childNodes[n]}).forEach(e=>e.parentNode.removeChild(e)),r.removeAll.forEach(e=>{let r=t;e.path.trim()&&e.path.split(",").forEach(e=>{r&&(r=r.childNodes[e/1])}),r&&(r.innerHTML="")}),Reflect.ownKeys(s).forEach(t=>{let r=s[t];if(r.length>0){let t=e.document.createDocumentFragment();r.forEach(r=>t.appendChild(Effecter.element(e,r.n))),r[0].p.appendChild(t)}else r.p.appendChild(Effecter.element(e,r.n))})}};class ClassList{static getClassName(e,t){return e?`${e}-${t}`:t}constructor(e,t){this._mapDom=e,this._className=t}add(e){return this._mapDom._dom.classList.add(ClassList.getClassName(this._className,e)),this}remove(e){return this._mapDom._dom.classList.remove(ClassList.getClassName(this._className,e)),this}has(e){return this._mapDom._dom.classList.contains(ClassList.getClassName(this._className,e))}toggle(e){return this._mapDom._dom.classList.toggle(ClassList.getClassName(this._className,e)),this}}class MapDom{static getElementPath(e=null,t=null){let r=[],s=t;for(;s&&s!==e;)r.push([...s.parentNode.childNodes].indexOf(s)),s=s.parentNode;return r.reverse()}constructor(e=null,t=null,r=""){this._container=e,this._dom=t,this.classList=new ClassList(this,r)}getAttributes(){return this._container._cross.getAttributeByPath(MapDom.getElementPath(this._container._container,this._dom))}getAttribute(e){return this.getAttributes()[e]}getEventInfo(){return this._container._cross.getEventsByPath(MapDom.getElementPath(this._container._container,this._dom))}isListenedEvent(e){return void 0!==this.getEventInfo()[e]}element(){return this._dom}getElement(){return this._dom}groupi(e=""){return[...this._dom.querySelectorAll(`[data-groupi="${e}"]`)].map(e=>new MapDom(this._container,e))}}class Template{constructor(e,t="",r={},s,n={},a=3){this._id=s,this._currentState=null,this._beforeState=null,this._macrofn=Object.assign({},e.ddm.defaultMacros,r),this._templateStr=t,this._code=Parser.parse(e,t,n&&n.tags||{}),this._option=n,this._useprops=[],this._precise=a,this._context=e}_macro({tag:e,bodyStr:t,props:r,events:s,attrs:n,uses:a,usesmap:i}){if(this._macrofn[e]){let o=new Set;if(r.parameter){let e=r.parameter[PROXYSTATE];e?e._parent&&o.add(e._prop):Array.isArray(e)?e.forEach(e=>{e[PROXYSTATE]&&e[PROXYSTATE]._parent&&o.add(e[PROXYSTATE]._prop)}):isPlainObject(e)&&Reflect.ownKeys(e).forEach(t=>{let r=e[t];r[PROXYSTATE]&&r[PROXYSTATE]._parent&&o.add(r[PROXYSTATE]._prop)})}a.map(e=>{let t=i[e];if(t&&t[PROXYSTATE]&&t[PROXYSTATE]._prop)o.add(t[PROXYSTATE]._prop);else{let t=e.split("."),r=t.pop(),s=t.join("."),n=i[s];n&&n[PROXYSTATE]&&o.add(n[PROXYSTATE]._prop+"."+r)}}),r.useProps=[...o];let l=this._macrofn[e]({attrs:n,events:s,props:r,bodyStr:t,parseBody:function(e){if(""!==t){return new Template(this._context,t,this._macrofn,this._id,null,null).render(e)}return""}.bind(this),context:this,id:this._id,option:this._option,env:this._context});if(l&&l.template){let e=new Template(this._context,l.template,this._macrofn,this._id,null,null).getCurrentState(l.data);if(1===e.length){let t=e[0],a=Reflect.ownKeys(s);return a.length>0&&(t.attrs["data-bind"]=`${this._id}:${a.map(e=>e).join(",")}`),Object.assign(t.props,r),Object.assign(t.events,s),Object.assign(t.attrs,n),[t]}throw new Error("[ada] macro must return only one node")}return l||""}return console.error("[ada] macro can not found ["+e+"] template is "+this._templateStr),""}getAttributeByPath(e=[]){let t={children:this._currentState};return e.forEach(e=>t=t.children[e]),t.props||null}getEventsByPath(e=[]){let t={children:this._currentState};return e.forEach(e=>t=t.children[e]),t.events||null}getAllInfoByPath(e=[]){let t={children:this._currentState};return e.forEach(e=>t=t.children[e]),{events:t.events,props:t.props}}getCurrentEventMap(){return this._currentState?Differ.childrenEvents(this._currentState):{bubbleEvents:[],unBubbleEvents:{}}}getCurrentState(e){let t=[IDNAME,"data",...this._context.ddm.defaultFunctionNames,this._code],r=[this._id,e,...this._context.ddm.defaultFunctionFns];return new Function(...t).call(this,...r)}render(e={},t=!0){this._currentState&&(this._beforeState=this._currentState);let r=new Collector({data:e,fn:this.getCurrentState,precise:this._precise,freeze:!1});return this._currentState=r.invoke({},this),this._useprops=r.getUsedPros(),t&&this._beforeState?Differ.diff(this._currentState,this._beforeState):Parser.getHTMLString(this._context,this._currentState)}isRendered(){return!this._templateStr||null!=this._beforeState}}class DDM{constructor({id:e,container:t=null,templateStr:r="",binders:s={},macro:n={},option:a={},precise:i=3,context:o=null,className:l}){this._context=o,this._id=e,this._container=t,this._cross=new Template(o,r,n,e,a,i),this._binders=s,this._isrender=!1,this._className=l||""}_agentEvent({bubbleEvents:e,unBubbleEvents:t}){let r=this._container;eventHelper.unbind(r),e.forEach(e=>{eventHelper.bind(r,e,e=>{let t=e.target,r=e.type,s=t,n=[];for(;s&&s!==this._container&&s!==this._context.document;){let t=s.dataset.bind;if(t){let a=t.split(":"),i=a[0],o=a[1]?a[1].split(","):[];if(i===this.getId()&&-1!==o.indexOf(r)){let{events:t,props:r}=this._cross.getAllInfoByPath(MapDom.getElementPath(this._container,s)),a=t[e.type];a&&n.push({info:a,props:r})}}s=s.parentNode}n.forEach(({info:t,props:r})=>{let{method:s,parameters:n,paranames:a}=t;if(this._binders){let t={e:e,props:r};a.split(",").forEach((e,r)=>t[e]=n[r]),this._binders({method:s,parameters:t})}})})}),Reflect.ownKeys(t).forEach(e=>{[...r.querySelectorAll('[data-bind="'+e+'"]')].forEach(r=>{t[e].forEach(e=>{eventHelper.unbind(r,e),eventHelper.bind(r,e,e=>{let t=e.target,r=e.type,s=t.dataset.bind;if(s){let n=s.split(":"),a=n[0],i=n[1]?n[1].split(","):[];if(a===this.getId()&&-1!==i.indexOf(r)){let{events:r,props:s}=this._cross.getAllInfoByPath(MapDom.getElementPath(this._container,t)),n=r[e.type];if(n){let{method:t,parameters:r,paranames:a}=n;if(this._binders){let t={e:e,props:s};a.split(",").forEach((e,s)=>t[e]=r[s]),this._binders({method:n.method,parameters:t})}}}}})})})})}getId(){return this._id}finder(e){return this.finders(e)[0]}finders(e){let t=`[data-find="${`${this._id}:${e}`}"]`;return[...this._container.querySelectorAll(t)].map(e=>new MapDom(this,e,this._className))}group(e){return this.groups(e)}groups(e){let t=`[data-group="${`${this._id}:${e}`}"]`;return[...this._container.querySelectorAll(t)].map(e=>new MapDom(this,e))}modules(){let e=`[data-module="${this._id}"]`;return[...this._container.querySelectorAll(e)].map(e=>new MapDom(this,e))}render(e,t=!0){let r=this._cross.render(e,t);return t&&this._cross.isRendered()?r&&Effecter.effect(this._context,this._container,r):r&&!this._container.innerHTML&&(this._container.innerHTML=r),this._agentEvent(this._cross.getCurrentEventMap()),this._isrender=!0,this}getUseProps(){return this._cross._useprops}isRendered(){return this._isrender}}module.exports={Parser:Parser,DDM:DDM,MapDom:MapDom};},function(module,exports,require){"use strict";exports.DDMTAG=Symbol("ddm"),exports.CONTEXT=Symbol("context"),exports.VIEWTAG=Symbol("view"),exports.PARENTVIEWTAG=Symbol("parent"),exports.ELEMENTTAG=Symbol("node"),exports.CHILDRENTAG=Symbol("children"),exports.IDNAME=Symbol("viewid"),exports.DDMCONTAINER=Symbol("ddmbody"),exports.CLASSNAME=Symbol("class"),exports.ISREMOVED=Symbol("isremove"),exports.PREREMOVED=Symbol("preremoved"),exports.ROOTELEMENTNAME="ada-root",exports.OUTERVIEW=Symbol("outview"),exports.DATASET=Symbol("dataset"),exports.BINDERS=Symbol("binders"),exports.SUBSCRIBE=Symbol("subscribe"),exports.HANDLERS=Symbol("handler"),exports.VIEWINFO=Symbol("viewinfo"),exports.CONNECTS=Symbol("connects"),exports.VIEWNAME=Symbol("name"),exports.DATASETOWNER=Symbol("owner"),exports.DATASETDATA=Symbol("data"),exports.DATASETSERVICE=Symbol("service"),exports.DATASETLISTENER=Symbol("listener"),exports.DATASETRANSACTION=Symbol("transaction"),exports.DATASETRANSACTIONSTATE=Symbol("transactionstate"),exports.DATASETRANSACTIONSTEP=Symbol("transactionstep"),exports.DATASETISCOMMIT=Symbol("commits"),exports.DATASETCOMMITCOUNT=Symbol("commitcount"),exports.PROXYSTATE=Symbol("proxy"),exports.DATASETEDITS=Symbol("setprops"),exports.USEPROPS=Symbol("useprops"),exports.CHANGEPROPS=Symbol("changeprops"),exports.DATASETACTION=Symbol("action"),exports.DATASETCOMPUTE=Symbol("compute"),exports.CONNECTSTATE=Symbol("connectstate"),exports.BASEDATA=Symbol("data"),exports.MODULEPATH=Symbol("[[path]]");},function(module,exports,require){"use strict";let{PROXYSTATE:PROXYSTATE}=require(12),issupportproxy="undefined"!=typeof Proxy,env=require(9);const util={is:(e,t)=>e===t?0!==e||1/e==1/t:e!=e&&t!=t,isProxy:e=>!!e&&!!e[PROXYSTATE],isProxyable(e){if(!e)return!1;if("object"!=typeof e)return!1;if(Array.isArray(e))return!0;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype},isProxyProp:e=>"string"==typeof e||"number"==typeof e,has:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),shallowCopy(e){if(Array.isArray(e))return e.slice();{let t=void 0===e.__proto__?Object.create(null):{};return Object.assign(t,e)}},setPropName(e,t){e._parent?e._prop=[e._parent._prop,t].join("."):e._prop=t},finalize(e){if(this.isProxy(e)){let t=e[PROXYSTATE];return!0===t._modified?!0===t._finalized?t._copy:(t._finalized=!0,Array.isArray(t._copy)&&t._copy.forEach((e,r)=>{e!==t._data[r]&&(t._copy[r]=this.finalize(e))}),Reflect.ownKeys(t._copy).forEach(e=>{let r=t._copy[e];r!==t._data[e]&&(t._copy[e]=this.finalize(r))}),this.freeze(t._copy)):this.finalize(t._data)}return this.finalizeNonProxiedObject(e),e},finalizeNonProxiedObject(e){this.isProxyable(e)&&(Object.isFrozen(e)||(this.each(e,(t,r)=>{this.isProxy(r)?e[t]=this.finalize(r):this.finalizeNonProxiedObject(r)}),this.freeze(e)))},freeze:e=>(env.develop&&Object.freeze(e),e),cleanCollector(e){if(e._revokes.forEach(e=>e()),e._getprops=[...e._getprops],e._setprops=[...e._setprops],e._states.length>0){this.each(e._states,(e,t)=>{t.finalizing=!0});for(let t=e._states.length-1;t>=0;t--){const r=e._states[t];!1===r._modified&&(Array.isArray(r._data)?esprop.hasArrayChanges(r)&&esprop.markChanged(r):esprop.hasObjectChanges(r)&&esprop.markChanged(r))}}},each(e,t){if(Array.isArray(e))for(let r=0;r<e.length;r++)t(r,e[r]);else for(let r in e)t(r,e[r])}};class State{constructor(e,t,r){this._data=t,this._parent=e,this._children={},this._modified=!1,this._copy=null,this._prop="",this._finalized=!1,this._collector=r}}class Esstate{constructor(e,t,r,o){this._modified=!1,this._hasCopy=!1,this._parent=e,this._data=r,this._proxy=t,this._copy=void 0,this._collector=o,this._finished=!1,this._finalizing=!1,this._finalized=!1,this._prop=""}}const proxy={markChanged(e){e._modified||(e._modified=!0,e._copy=util.shallowCopy(e._data),Object.assign(e._copy,e._children),e._parent&&this.markChanged(e._parent))},createProxy(e,t,r){const{proxy:o,revoke:i}=Proxy.revocable(new State(t,r,e),handler);return e._revokes.push(i),o}},esprop={createProxy(e,t,r){const o=util.shallowCopy(r);util.each(r,e=>{Object.defineProperty(o,""+e,this.createPropertyProxy(""+e))});const i=new Esstate(t,o,r,e);return this.createHiddenProperty(o,PROXYSTATE,i),e._states.push(i),o},createPropertyProxy:e=>({configurable:!0,enumerable:!0,get(){return eshandler.get(this[PROXYSTATE],e)},set(t){eshandler.set(this[PROXYSTATE],e,t)}}),createHiddenProperty(e,t,r){e&&Object.defineProperty(e,t,{value:r,enumerable:!1,writable:!0})},hasObjectChanges(e){const t=Object.keys(e._data),r=Object.keys(e._proxy);return!this.shallowEqual(t,r)},hasArrayChanges(e){const{_proxy:t}=e;if(t.length!==e._data.length)return!0;const r=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!r||r.get)},prepareCopy(e){e._hasCopy||(e._hasCopy=!0,e._copy=util.shallowCopy(e._data))},shallowEqual(e,t){if(util.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(let o=0;o<r.length;o++)if(!hasOwnProperty.call(t,r[o])||!util.is(e[r[o]],t[r[o]]))return!1;return!0},source:e=>e._hasCopy?e._copy:e._data,markChanged(e){e._modified||(e._modified=!0,e._parent&&this.markChanged(e._parent))}},handler={get(e,t){if(t===PROXYSTATE)return e;{let r=e._data[t],o=!1;if(e._modified)(r=e._copy[t])===e._data[t]&&util.isProxyable(r)&&(r=e._copy[t]=proxy.createProxy(e._collector,e,r),util.setPropName(r[PROXYSTATE],t),e._collector._addUseProp(r[PROXYSTATE]._prop),o=!0);else if(e._children[t])r=e._children[t],o=!0;else{let i=e._data[t];!util.isProxy(i)&&util.isProxyable(i)&&(r=e._children[t]=proxy.createProxy(e._collector,e,i),util.setPropName(r[PROXYSTATE],t),e._collector._addUseProp(r[PROXYSTATE]._prop),o=!0)}return o||util.isProxyProp(t)&&e._collector._addUseProp(e._prop+"."+t),r}},set(e,t,r){if(e._data[t]!==r&&e._collector._addSetProp(e._prop+"."+t),!e._modified){if(t in e._data&&util.is(e._data[t],r)||util.has(e._children,t)&&e._children[t]===r)return e._collector._removeSetProp(e._prop+"."+t),!0;e._collector._immutable&&proxy.markChanged(e)}return e._collector._immutable?e._copy[t]=r:e._data[t]=r,!0},has:(e,t)=>t in e._data,ownKeys:e=>Reflect.ownKeys(e._data),deleteProperty:(e,t)=>!0,getOwnPropertyDescriptor(e,t){const r=e._modified?e._copy:util.has(e._children,t)?e._children:e._data,o=Reflect.getOwnPropertyDescriptor(r,t);return o&&(o.configurable=!0),o},defineProperty(){throw new Error("[ada] can not define property on this object")}},eshandler={get(e,t){if(!0===e._finished)throw new Error("Cannot use a proxy that has been revoked."+JSON.stringify(e._copy||e._data));const r=esprop.source(e)[t],o=!1;return!e._finalizing&&r===e._data[t]&&util.isProxyable(r)?(esprop.prepareCopy(e),e._copy[t]=esprop.createProxy(e._collector,e,r)):(o||util.isProxyProp(t)&&e._collector._addUseProp(e._prop+"."+t),r)},set(e,t,r){if(!0===e._finished)throw new Error("Cannot use a proxy that has been revoked."+JSON.stringify(e._copy||e._data));if(e._data[t]!==r&&e._collector._addSetProp(e._prop+"."+t),!e._modified){if(util.is(esprop.source(e)[t],r))return void e._collector._removeSetProp(e._prop+"."+t);esprop.markChanged(e),esprop.prepareCopy(e)}e._collector._immutable?e._copy[t]=r:e._data[t]=r}};class Collector{constructor({data:e,fn:t,precise:r=3,immutable:o=!0,collect:i=!0}){this.fn=t,this._revokes=[],this._states=[],this._precise=r+1,this._root=issupportproxy?proxy.createProxy(this,null,e):esprop.createProxy(this,null,e),this._getprops=new Set,this._setprops=new Set,this._immutable=o,this._collect=i}getUsedPros(){return this._getprops}getChangedProps(){return this._setprops}invoke(e,t){let r=null,o=null,i=!1;return e instanceof Collector?(i=!0,r=this.fn.call(t||{},this._root,e._root)):r=this.fn.call(t||{},this._root,e),void 0!==r&&r!==this._root?r.then?r.then(t=>(o=util.finalize(t||this._root),util.cleanCollector(this),i&&(util.finalize(e._root),util.cleanCollector(e)),o)):(o=util.finalize(r),util.cleanCollector(this),i&&(util.finalize(e._root),util.cleanCollector(e)),o):(o=util.finalize(this._root),util.cleanCollector(this),i&&(util.finalize(e._root),util.cleanCollector(e)),o)}_addUseProp(e){this._collect&&this._getprops.add(e.split(".").splice(0,this._precise).join("."))}_addSetProp(e){this._collect&&this._setprops.add(e)}_removeSetProp(e){this._collect&&this._setprops.delete(e)}}module.exports=Collector;},function(module,exports,require){"use strict";const EVENTTYPES={HTMLEvents:"load,unload,abort,error,select,change,submit,reset,focus,blur,resize,scroll",MouseEvent:"click,mousedown,mouseup,mouseover,mousemove,mouseout",UIEvent:"DOMFocusIn,DOMFocusOut,DOMActivate",MutationEvent:"DOMSubtreeModified,DOMNodeInserted,DOMNodeRemoved,DOMNodeRemovedFromDocument,DOMNodeInsertedIntoDocument,DOMAttrModified,DOMCharacterDataModified"},UNBUBBLINGEVENT=["load","unload","focus","blur","pointerenter","pointerleave","beforeunload","stop","start","finish","bounce","beforeprint","afterprint","propertychange","filterchange","readystatechange","losecapture","dragenter","dragexit","draggesture","dragover","CheckboxStateChange","RadioStateChange","close","command","contextmenu","overflow","overflowchanged","popuphidden","popuphiding","popupshowing","popupshown","broadcast","commandupdate"];function eventHandler(e){let t=e.currentTarget.events[e.type];for(let n in t)t[n].call(e.currentTarget,e)}let helper={isEvent(e){let t={type:e,interfaceName:null};for(let n in EVENTTYPES)if(-1!==EVENTTYPES[n].indexOf(e)){t.interfaceName=n;break}return t},trigger(e,t,n){let o=this.isEvent(t);if(o.interfaceName){let n=document.createEvent(o.interfaceName);switch(o.interfaceName){case"MouseEvent":n.initMouseEvent(t,!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null);break;case"HTMLEvents":n.initEvent(t,!0,!1,window);break;case"UIEvents":n.initUIEvents(t,!0,!1,window,null);break;case"MutationEvent ":n.initMutationEvent(t,!0,!1,window,null,null,null,null)}e.dispatchEvent(n)}else{let o=document.createEvent("CustomEvent");o.initCustomEvent(t,!0,!0,n),e.dispatchEvent(o)}return e},canBubbleUp:e=>-1===UNBUBBLINGEVENT.indexOf(e),bind:(e,t,n,o=!1)=>(e.events||(e.events={}),e.events[t]?e.events[t].push(n):(e.events[t]=[],e.events[t].push(n)),e.addEventListener(t,eventHandler,o),e),unbind(e,t,n){if(e.events)if(t&&""!==t){let o=e.events[t];o&&(e.removeEventListener(t,eventHandler,!1),n?o.splice(o.indexOf(n),1):o.length=0)}else{e.events;Reflect.ownKeys(e.events).forEach(t=>{e.removeEventListener(t,eventHandler,!1),e.events[t].length=0})}return e}};module.exports=helper;},function(module,exports,require){"use strict";let serverUtil=require(16),browserUtil=require(17),{isBrowser:isBrowser}=require(7);module.exports=isBrowser()?browserUtil:serverUtil;},function(module,exports,require){module.exports={}},function(module,exports,require){"use strict";let{isBrowser:isBrowser}=require(7),util={isServer:!1,setSourcePaths(e){},isRegularTag(e){if(isBrowser()){let r=window.document.createElement(e);return r instanceof window.HTMLElement||r instanceof window.SVGElement}return!0}};module.exports=util;},function(module,exports,require){"use strict";let Tag=require(23),DDMVariables=require(24);class BaseContext{constructor(){this._tags=new Tag,this._ddm=new DDMVariables,this._config={root:"",basePath:"",parameter:{},sourceMap:{}},this._loader=null,this._onsnapshoot=null,this._snapshootalways=null,this._hooks={initdone:[],bootdone:[],recoverdone:[],sourceexcute:[],sourceready:[],sourcepersistence:[]},this._bootFlow=Promise.resolve(),this._steps=[]}_invokeHook(s,o){let e=this._hooks[s];if(e)return e.reduce((s,e)=>s.then(s=>new Promise(t=>{e(o,s=>t(s),s)})),Promise.resolve(o))}_invokeSyncHook(s,o){let e=this._hooks[s];if(e)return e.reduce((s,e)=>e(o,s),o)}hook(s,o){let e=this._hooks[s];e&&-1===e.indexOf(o)&&e.push(o)}unhook(s,o){let e=this._hooks[s],t=e.indexOf(o);-1!==t&&e.splice(t,1)}get loader(){return this._loader}get config(){return this._config}set config(s){Object.assign(this._config,s)}get tags(){return this._tags}get ddm(){return this._ddm}get window(){}get document(){}set onsnapshoot(s){this._onsnapshoot=s}get isBrowser(){return!0}snapshot(){this._snapshootalways&&this._snapshootalways(),this._onsnapshoot&&this._onsnapshoot()}}module.exports=BaseContext;},function(module,exports,require){"use strict";let{getMappedPath:getMappedPath,isFunction:isFunction,setProp:setProp}=require(7),{MODULEPATH:MODULEPATH}=require(12);class EmptyPersistence{constructor(e){this.context=e}getAll(){return Promise.resolve({}).then(e=>(this.context._invokeHook("sourceready",e),e))}saveAll(e){return this.context._invokeHook("sourcepersistence",e),Promise.resolve()}clean(){return Promise.resolve()}}class StoragePersistence{constructor(e){this.context=e}getAll(){let e={};try{e=this.context.window.localStorage.getItem("ada-local-source")}catch(e){}return this.context._invokeHook("sourceready",e),Promise.resolve(e)}saveAll(e){try{this.context._invokeHook("sourcepersistence",e),this.context.window.localStorage.setItem("ada-local-source",JSON.stringify(e))}catch(e){}return Promise.resolve()}clean(){try{this.context.window.localStorage.removeItem("ada-local-source")}catch(e){}return Promise.resolve()}}class DatabasePersistence{constructor(e){this.context=e,this.db=null,this.info={name:"ada",version:1,store:"ada-local-source",key:"name",value:"local"}}ready(){return this.db?Promise.resolve():(this.context.window.indexedDB||(this.context.window.indexedDB=this.context.window.mozIndexedDB||this.context.window.webkitIndexedDB),new Promise(e=>{let t=this.context.window.indexedDB.open(this.info.name,this.info.version);t.onupgradeneeded=(()=>{let e=t.result;e.objectStoreNames.contains(this.info.store)&&e.deleteObjectStore(this.info.store),e.createObjectStore(this.info.store,{keyPath:this.info.key}).put({name:this.info.value,data:{}})}),t.onsuccess=(()=>{this.db=t.result,e()}),t.onerror=(()=>{e()})}))}getAll(){return new Promise(e=>{this.ready().then(()=>{let t=this.db.transaction([this.info.store],"readwrite");t.onerror=function(t){e({})};let s=t.objectStore(this.info.store).get(this.info.value);s.onerror=(()=>{e({})}),s.onsuccess=(()=>{e(s.result?s.result.data:{})})})}).then(e=>(this.context._invokeHook("sourceready",e),e))}saveAll(e){return new Promise(t=>{this.ready().then(()=>{let s=this.db.transaction([this.info.store],"readwrite");s.oncomplete=(()=>{t()}),s.onerror=(()=>{t()}),this.context._invokeHook("sourcepersistence",e),s.objectStore(this.info.store).put({name:this.info.value,data:e})})})}clean(){return new Promise(e=>{this.ready().then(()=>{let t=this.db.transaction([this.info.store],"readwrite");t.oncomplete=(()=>{e()}),t.onerror=(()=>{e()}),t.objectStore(this.info.store).delete(this.info.value)})})}}class ModuleLoader{constructor(e,t){this.installed={},this.moduleFnsLoaded={},this._loader=t,this._context=e}getExcutor(e,t){let s=e.split("/").pop().split(".").pop(),o=t,r={path:e,code:o="js"===s?t:"css"===s||"scss"===s||"less"===s?`var styles={_linkElement:null,active:function(){var et=document.getElementById("${e}");if(!et){var _a = document.createElement("style");_a.setAttribute("media", "screen");_a.setAttribute("type", "text/css");_a.setAttribute("id","${e.replace(/\//g,"-")}");_a.appendChild(document.createTextNode(${JSON.stringify(t)}));styles._linkElement=_a;document.getElementsByTagName("head")[0].appendChild(_a);}else{et.innerText="";et.appendChild(document.createTextNode(${JSON.stringify(t)}));}}};if (/complete|loaded|interactive/.test(window.document.readyState)) {styles.active();} else {window.document.addEventListener('DOMContentLoaded', function () {styles.active();}, false);}module.exports={isReady:function(){return styles._linkElement!==null;},getElement:function(){return styles._linkElement;},remove:function(){if(styles._linkElement){styles._linkElement.parentNode.removeChild(styles._linkElement);}}};`:"json"===s?`module.exports=${t}`:"html"===s||"text"===s?`module.exports=JSON.stringify(${t})`:t};return this._context._invokeSyncHook("sourceexcute",r),new Function("module","exports","require","imports","babelHelpers","window","document",r.code)}getModuleDependenceInfo(e,t){let s=[];return{code:t=t.replace(/require\(.*?\)/g,e=>{let t=e.substring(8,e.length-1).replace(/['|"|`]/g,"").trim();return s.push(t),`require("${t}")`}),paths:s}}getModuleDependenceMap(e){return this._loader.get(e).then(t=>{let{paths:s,code:o}=this.getModuleDependenceInfo(e,t),r={[e]:o},i=[];return s.map(e=>{this.installed[e]||i.push(this.getModuleDependenceMap(e))}),Promise.all(i).then(e=>(Object.assign(r,...e),r))})}excute(e){if(this.installed[e])return this.installed[e].exports;let t=this.installed[e]={path:e,exports:{}};return this.moduleFnsLoaded[e].call(t.exports,t,t.exports,e=>this.excute(e),e=>this.load(e).then(e=>e.__esModule?e.default:e).then(t=>(isFunction(t)&&setProp(t,MODULEPATH,e),t)),this._loader._context.window.babelHelpers||{},this._loader._context.window,this._loader._context.document),t.exports}load(e){let t=this.installed[e];return t?Promise.resolve(t.exports):this.getModuleDependenceMap(e).then(t=>{for(let e in t)this.moduleFnsLoaded[e]=this.getExcutor(e,t[e]);return this.excute(e)})}excuteScript(e){return this.load(e)}scan(e){if(e)for(let t in this.installed){if(!1===e(t,this.installed[t].exports))break}}scanClass(e){if(e)for(let t in this.installed){let s=this.installed[t];if(!s.exports.__esModule&&isFunction(s.exports)&&!1===e(t,s.exports))break;for(let o in s.exports){let r=s.exports[o];if(isFunction(r)&&!1===e(t,r))break}}}filter(e){let t=[];if(e)for(let s in this.installed){let o=this.installed[s],r=e(s,o.exports.__esModule?o.exports.default:o.exports);void 0!==r&&t.push(r)}return t}get(e){let t=this.installed[e];return t?t.exports.__esModule?t.exports.default:t.exports:null}has(e){return void 0!==this.installed[e]}set(e,t){return this.installed[e]={exports:t},this}}class SourceQueue{constructor(e){this.tasks=[],this.isRunning=!1,this._loader=e}add(e,t,s){this.tasks.push({path:e,fn:t,error:s}),this.run()}run(){if(!this.isRunning){let e=this.tasks.shift();e&&(this.isRunning=!0,this._loader.getSource(e.path).then(t=>{this.isRunning=!1,e.fn(t),this.run()},t=>{this.isRunning=!1,e.error(t),this.run()}))}}}class ActiveSource{constructor(e){this.cache=[],this._loader=e}excute(e){return this.cache[e]?Promise.resolve(this.cache[e]):this._loader.get(e).then(t=>(this.cache[e]=t,t))}has(e){return void 0!==this.cache[e]}}class Loader{constructor(e){this._moduleLoader=new ModuleLoader(e,this),this._sourceQueue=new SourceQueue(this),this._activeSource=new ActiveSource(this),this._source={},this._context=e,this._isinit=!1;let t=null;t=e.window.indexedDB||e.window.mozIndexedDB||e.window.webkitIndexedDB?new DatabasePersistence(e):e.window.localStorage?new StoragePersistence(e):new EmptyPersistence(e),this.persistence=t}get source(){return this._source}get moduleLoader(){return this._moduleLoader}get sourceQueue(){return this._sourceQueue}get activeSource(){return this._activeSource}get context(){return this._context}ready(){return this._isinit?Promise.resolve():this.persistence.getAll().then(e=>(this._isinit=!0,this._source=Object.assign({},e,this.source),this.persistence.saveAll(this.source)))}get(e){return new Promise((t,s)=>{this.sourceQueue.add(e,e=>{t(e)},e=>{s(e)})})}getSourceCode(e){return this.context.request.origin({url:e,method:"get"}).promise.then(e=>e.data)}getRealPath(e,t=!1){let s=e,o="",r=this.context.config;if(o=t?r.sourceMap[e.split(".").shift()]:r.sourceMap[getMappedPath(e)],r.develop)s=`${e}?h=${(new Date).getTime()}`;else{let t=e.split("/"),r=t.pop().split(".");t.push(`${o}.${r[1]}`),s=t.join("/")}return`${"/"===r.basePath[r.basePath.length-1]?r.basePath:r.basePath+"/"}${s}`}getSourceByHash(e,t,s){let o=0,r=this.context.config,i=Reflect.ownKeys(r.sourceMap.packages).filter(e=>-1!==r.sourceMap.packages[e].indexOf(s))[0];return i?(r.sourceMap.packages[i].split("|").forEach(e=>{let t=Reflect.ownKeys(r.sourceMap).filter(t=>r.sourceMap[t]===e)[0];this.source[t]&&this.source[t].hash===e||(o+=1)}),o>1?this.getSourceCode(`${this.getRealPath(i+".js",!0)}`).then(e=>{let s=JSON.parse(e.substring(11,e.length-1));return Object.assign(this.source,s),this.persistence.saveAll(this.source).then(()=>this.source[t].code)}):this.getSourceCode(`${this.getRealPath(e)}`).then(e=>(this.source[t]={code:e,hash:s},this.persistence.saveAll(this.source).then(()=>e)))):s?this.getSourceCode(`${this.getRealPath(e)}`).then(e=>(this.source[t]={code:e,hash:s},this.persistence.saveAll(this.source).then(()=>e))):this.getSourceCode(`${this.getRealPath(e)}`)}getSource(e){return this.ready().then(()=>{let t=getMappedPath(e),s=this.context.config;if(this.source[t]){let o=this.source[t].hash,r=s.sourceMap[t];return o&&r?r===o?this.source[t].code:this.getSourceByHash(e,t,r):this.getSourceCode(`${this.getRealPath(e)}`)}return s.sourceMap?this.getSourceByHash(e,t,s.sourceMap[t]):this.getSourceCode(`${this.getRealPath(e)}`)})}loadModule(e){return this.moduleLoader.excuteScript(e).then(e=>{if(!0===e.__esModule)return e.default})}loadSource(e){return this.activeSource.excute(e)}decompress(e={}){this.source||(this.source={}),Object.assign(this.source,e)}}module.exports=Loader;},function(module,exports,require){"use strict";let BaseLogger=require(25);class BrowserLogger extends BaseLogger{log(...e){this.isOn()&&console.log(...e)}error(...e){this.isOn()&&console.error(...e)}warn(...e){console.warn(...e)}info(...e){console.info(...e)}}module.exports=BrowserLogger;},function(module,exports,require){"use strict";let{postData:postData,queryString:queryString}=require(7),util={parseHeaders(e){let t={};return e.split("\n").forEach(e=>{let s=e.split(":");s[0]&&(t[s[0]]=s[1])}),t}};module.exports=function(e,t){let s=null,r=null;return{promise:new Promise((e,o)=>{s=o,r=new XMLHttpRequest,t.mimeType&&r.overrideMimeType(t.mimeType);let a=t.url,n=t.data;if(!t.body)if("get"===t.method){let e=queryString(t.data);a+=-1!==a.indexOf("?")?""===e?"":"&"+e:""===e?"":"?"+e}else n=postData(n,t.encodeURI);r.open(t.method,a),r.responseType=t.responseType,r.timeout=t.timeout,null!==t.credentials&&(r.withCredentials=t.credentials),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),Reflect.ownKeys(t.headers).forEach(e=>{r.setRequestHeader(e,t.headers[e])}),"get"!==t.method&&(t.encodeURI?r.setRequestHeader("Content-type","application/x-www-form-urlencoded"):r.setRequestHeader("Content-type","application/json")),r.addEventListener("readystatechange",s=>{if(4===r.readyState){let a=r.status,n="getAllResponseHeaders"in r?r.getAllResponseHeaders():null;if(a>=200&&a<300||304===a||0===a){let s=t.responseType&&"text"!==t.responseType?r.response:r.responseText,o=r.statusText||"";e({status:a,statusText:o,data:s,headers:util.parseHeaders(n),option:t})}else r=null,o({status:a,headers:util.parseHeaders(n),option:t,error:s})}}),r.addEventListener("onabort",e=>o({status:r.status,option:t,error:e})),r.addEventListener("onerror",e=>o({status:r.status,option:t,error:e})),r.addEventListener("ontimeout",e=>o({status:r.status,option:t,error:e})),t.ondownloadprogress&&r.addEventListener("progress",t.ondownloadprogress),t.onuploadprogress&&r.upload.addEventListener("progress",t.onuploadprogress),r.send(t.body?t.body:n)}),cancel:()=>{r&&(r.abort(),r=null,s("[ada] request abort"))}}};},function(module,exports,require){"use strict";let{randomid:randomid}=require(7);class RequestMananger{constructor(e,r){this._context=e,this._worker=r,this._requestTransformer=[],this._responseTransformer=[],this.addResponseTransformer(e=>{let r=e.data;if("["===r[0]||"{"===r[0])try{r=JSON.parse(r)}catch(e){}return r})}static getOption(e){return Object.assign({url:"",id:randomid(),method:"post",responseType:"text",timeout:3e6,headers:{},events:{},mimeType:"",data:{},body:"",credentials:null,encodeURI:!1,ondownloadprogress:null,onuploadprogress:null},e)}addRequestTransformer(e){-1===this._requestTransformer.indexOf(e)&&this._requestTransformer.push(e)}addResponseTransformer(e){-1===this._responseTransformer.indexOf(e)&&this._responseTransformer.push(e)}removeRequestTransformer(e){let r=this._requestTransformer.indexOf(e);-1!==r&&this._requestTransformer.splice(r,1)}removeResponseTransformer(e){let r=this._responseTransformer.indexOf(e);-1!==r&&this._responseTransformer.splice(r,1)}cleanRequestTransformer(){this._requestTransformer=[]}cleanResponseTransformer(){this._responseTransformer=[]}fetch(e){return this.invoke(e).promise}origin(e){return this._worker(this._context,RequestMananger.getOption(e))}invoke(e){let r=RequestMananger.getOption(e);this._requestTransformer.forEach(e=>e(r));let{promise:s,cancel:t}=this._worker(this._context,r);return{promise:s.then(e=>this._responseTransformer.reduce((r,s)=>s(e,r),null)),cancel:t}}get(e,r={}){return this.fetch(Object.assign({url:e,data:r},{method:"get"}))}post(e,r={}){return this.fetch(Object.assign({url:e,data:r},{method:"post"}))}put(e,r={}){return this.fetch(Object.assign({url:e,data:r},{method:"put"}))}patch(e,r={}){return this.fetch(Object.assign({url:e,data:r},{method:"patch"}))}head(e,r={}){return this.fetch(Object.assign({url:e,data:r},{method:"head"}))}options(e,r={}){return this.fetch(Object.assign({url:e,data:r},{method:"options"}))}}module.exports=RequestMananger;},function(module,exports,require){"use strict";let{isFunction:isFunction}=require(7),{isRegularTag:isRegularTag}=require(15);class Tag{constructor(){this.regularTags=[],this.selfCloseTags=["br","hr","img","input","param","link","meta","area","base","basefont","param","col","frame","embed","keygen","source"],this.tags={icon:{template:({attrs:s,props:e})=>`<svg class="${s.class||"ada-icon"}"><use xlink:href="#${e.id}"></use></svg>`,selfClose:!0}}}get(s){return this.tags[s]}set(s,e){this.tags[s]=e,isFunction(e)||e.selfClose&&this.selfCloseTags.push(s)}has(s){return void 0!==this.get(s)}remove(s){Reflect.ownKeys(this.tags).filter(e=>this.tags[e]===s).forEach(s=>delete this.tags[s])}isRegularTag(s){let e=!0;return-1===this.regularTags.indexOf(s)&&(isRegularTag(s)?this.regularTags.push(s):e=!1),e}}module.exports=Tag;},function(module,exports,require){"use strict";let{Parser:Parser}=require(11);class DDMVariables{constructor(){this._defaultMacros={self:({props:t,context:e})=>({template:e._templateStr,data:t.data}),custom({bodyStr:t,props:e,events:s,attrs:a,option:n,env:r}){let i="",u=e.customTagName,o=n.tags?n.tags[u]:null;if(o||(o=r.tags.get(u)),!o.template)throw Error(`[ada] tag [${u}] can not defined with function of generate template`);return{template:i=o.template({bodyStr:t,props:e,events:s,attrs:a,option:n,generateOption:o.option}),data:e}}},this._defaultAssignDirectives={html:t=>t},this._defaultFunctionNames=["classname"],this._defaultFunctionFns=[(t,e)=>{if(Array.isArray(e)){let s=[e.shift()];return e.forEach(e=>{!0===t[e]&&s.push(e)}),s.join(" ")}{let s=[];return e.def&&s.push(e.def),Reflect.ownKeys(e).forEach(e=>{!0===t[e]&&s.push(e)}),s.join(" ")}}]}get defaultMacros(){return this._defaultMacros}get defaultAssignDirectives(){return this._defaultAssignDirectives}get defaultFunctionNames(){return this._defaultFunctionNames}get defaultFunctionFns(){return this._defaultFunctionFns}setDefaultMacro(t,e){return this._defaultMacros[t]=e,null}setDefaultAssignDirective(t,e){return this._defaultAssignDirectives[t]=e,function(t){Parser.beautySyntax.syntaxs[t]=function(e){return`<%=assign(${t},${e.filter(t=>!!t).join(",")});%>`}}(t),null}setDefaultFunctions(t,e){let s=this._defaultFunctionNames.indexOf(t);-1===s?(this._defaultFunctionNames.push(t),this._defaultFunctionFns.push(e)):this._defaultFunctionFns[s]=e}}module.exports=DDMVariables;},function(module,exports,require){"use strict";class BaseLogger{constructor(o){this._context=o,this._on=!1}get on(){return this._on}set on(o){this._on=o}log(){}error(){}warn(){}info(){}isOn(){return!0===this._on}}module.exports=BaseLogger;},function(module,exports,require){"use strict";let{BondViewGroup:BondViewGroup,StaticViewGroup:StaticViewGroup,View:View,ViewConnector:ViewConnector,ViewGroup:ViewGroup}=require(1),{DataSet:DataSet,Service:Service,TransactDataSet:TransactDataSet}=require(2),factory=require(3),{Dispatcher:Dispatcher}=require(4),Passable=require(5),{view:view,root:root,action:action,handler:handler,subscribe:subscribe,compute:compute,binder:binder}=require(6),{clone:clone,encodeHTML:encodeHTML,excuteStyle:excuteStyle,extend:extend,hashCode:hashCode,isArray:isArray,isEqual:isEqual,isFunction:isFunction,isObject:isObject,isPlainObject:isPlainObject,isQueryString:isQueryString,isString:isString,randomid:randomid,isBrowser:isBrowser}=require(7),BrowserContext=require(8),env=require(9);if(isBrowser()){let e=new BrowserContext;e.window.Ada={modules:e.loader.moduleLoader,init(r){factory.init(e,r)},boot:function(r){r.context=e,factory.boot(r)},unpack(r){e.loader.decompress(r)},installModule(r,i){e.loader.moduleLoader.set(r,i)},recover(r){factory.recover(e,r)}}}module.exports={View:View,ViewGroup:ViewGroup,StaticViewGroup:StaticViewGroup,BondViewGroup:BondViewGroup,ViewConnector:ViewConnector,Service:Service,DataSet:DataSet,TransactDataSet:TransactDataSet,Dispatcher:Dispatcher,Passable:Passable,util:{randomid:randomid,hashCode:hashCode,isString:isString,isFunction:isFunction,isEqual:isEqual,isObject:isObject,isPlainObject:isPlainObject,isArray:isArray,isQueryString:isQueryString,excuteStyle:excuteStyle,encodeHTML:encodeHTML,extend:extend,clone:clone},view:view,root:root,action:action,handler:handler,subscribe:subscribe,compute:compute,binder:binder,env:env};}],"adajs");